<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>DANL 200 Lecture 12</title>
    <meta charset="utf-8" />
    <meta name="author" content="Byeong-Hak Choe" />
    <meta name="date" content="2023-03-07" />
    <script src="libs/header-attrs-2.20/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script src="libs/xaringanExtra-webcam-0.0.1/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <script src="libs/js-cookie-3.0.0/js.cookie.js"></script>
    <script src="libs/peerjs-1.3.1/peerjs.min.js"></script>
    <script src="libs/tiny.toast-1.0.0/toast.min.js"></script>
    <link href="libs/xaringanExtra-broadcast-0.2.6/broadcast.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-broadcast-0.2.6/broadcast.js"></script>
    <link href="libs/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon-1.4.1/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain-0.2.6/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain-0.2.6/shareagain.js"></script>
    <link href="libs/xaringanExtra-extra-styles-0.2.6/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/nhsr.css" type="text/css" />
    <link rel="stylesheet" href="css/nhsr-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: title-slide, left, bottom

# DANL 200 Lecture 12
----
## **DANL 200: Introduction to Data Analytics**
### Byeong-Hak Choe
### March 7, 2023


---
class: inverse, center, middle

# Workflow
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;


---
# Workflow
### &lt;p style="color:#00449E"&gt; Shortcuts for Presentation Slides &lt;/p&gt;
 
- Use `o` to see the tile view of all the slide pages.

- Use <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg> and <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/></svg> to turn over the slide pages.

- When you can't turn over slide pages, use **Ctrl + R** (**cmd + R** for mac users) to refresh the webpage.

---
# Workflow
### &lt;p style="color:#00449E"&gt; Shortcuts for RStudio and RScript &lt;/p&gt;

.pull-left[
**Mac**

- **command + return** runs a current line or selected lines.
- **command + shift + C** is the shortcut for # (commenting).
- **command + shift + R** is the shortcut for #--- (sectioning).
- **option + - ** is the shortcut for `&lt;-`.
]

.pull-right[
**Windows**

- **Ctrl + return** runs a current line or selected lines.
- **Ctrl + Shift + C** is the shortcut for # (commenting).
- **Ctrl + Shift + R** is the shortcut for #--- (sectioning).
- **Alt + - ** is the shortcut for `&lt;-`.
]


---
# Workflow
### &lt;p style="color:#00449E"&gt; Shortcuts for RStudio and RScript &lt;/p&gt;

- **Shift +** <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>/<svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"/></svg>/<svg aria-hidden="true" role="img" viewBox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2V448c0 17.7 14.3 32 32 32s32-14.3 32-32V141.2L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z"/></svg>/<svg aria-hidden="true" role="img" viewBox="0 0 384 512" style="height:1em;width:0.75em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 306.7L54.6 265.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"/></svg> to select a part of code as a block.


- When correcting an object's name, double click it.


---
# Workflow
### &lt;p style="color:#00449E"&gt; Shortcuts for RStudio and RScript &lt;/p&gt;


- **Ctrl + L** on Console when we want to clear everything printed in Console.


---
# Workflow
### &lt;p style="color:#00449E"&gt; Shortcuts for Switching Apps&lt;/p&gt;

.pull-left[
**Mac**
- **command + Tab** allows us to switch between apps quickly.

- If we use the full-screen mode of an app, the trackpad gesture of "three finger drag" switches across the screens.

]

.pull-right[
**Windows**

- **Alt + Tab** allows us to switch between apps quickly.

- Trackpad gestures might be supported depending on laptops or versions of Windows.

]

---
# `ggplot` workflow
### &lt;p style="color:#00449E"&gt; `gridExtra::grid.arrange()` &lt;/p&gt;

- `gridExtra` package provides `grid.arrange()` function.
  - `grid.arrange()` arranges multiple `ggplot` objects on a page, and draw tables of figures. 


```r
library(gridExtra) 
p1 &lt;- ggplot(mpg) +
  geom_boxplot(aes(x = class, y = cty, fill = class))

p2 &lt;- ggplot(mpg) +
  geom_boxplot(aes(x = class, y = hwy, fill = class))

grid.arrange(p1, p2, nrow = 1)   # sub-figures
```


---
# `ggplot` workflow
### &lt;p style="color:#00449E"&gt; `xlim(c(x1,x2))` and `ylim(c(y1,y2))` &lt;/p&gt;

- For continuous variables `x` and `y`, we can set the limits or ranges of `x` and `y` axes using `xlim(c(x1,x2))` and `ylim(c(y1,y2))`.


```r
p1 &lt;- ggplot(mpg) +
  geom_boxplot(aes(x = class, y = hwy, fill = class)) +
  ylim( c(0, 45) )

p2 &lt;- ggplot(mpg) +
  geom_boxplot(aes(x = class, y = cty, fill = class))  +
  ylim( c(0, 45) )

grid.arrange(p1, p2, nrow = 1)   # sub-figures
```

---
# `ggplot` workflow
### &lt;p style="color:#00449E"&gt; `ggforce` &lt;/p&gt;
- The `ggforce` package allows us to see a part of faceted plots:
  - Instead of `facet_grid()`, use `facet_grid_paginate()` in `ggplot`.
  - Set values for `ncol`, `nrow`, and `page` in `facet_*_paginate()`.

```r
bikeshare &lt;- read_csv(
  'https://bcdanl.github.io/data/bikeshare_cleaned.csv')
# install.packages("ggforce")
library(ggforce)
ggplot(data = bikeshare) +
  geom_histogram( mapping = aes(x = cnt, fill = month),
                  binwidth = 10, color = NA, show.legend = F) +
  facet_grid_paginate(month~year, nrow = 3, ncol = 2, page = 1) 
```


---
# `ggplot` workflow
### &lt;p style="color:#00449E"&gt; `ggsave()` &lt;/p&gt;
- In `ggsave()`, we can set the `width`, `height`, and `dpi` (dots per inch) of the picture file.

```r
p &lt;- ggplot(data = bikeshare) +
  geom_histogram( mapping = aes(x = cnt, fill = month),
                  binwidth = 10, color = NA,
                  show.legend = F) +
  facet_grid(month ~ year) 
ggsave(file = "ABSOLUTE_PATH_NAME_OF_THE_FILE_faceted_hist.png", 
       plot = p, 
       height = 16, width = 8)  # using the absolute path to save the file
```


---
# `R` workflow
### &lt;p style="color:#00449E"&gt;  &lt;/p&gt;
- When we want to *remove* the object from R Environment, we can use `rm(NAME_OF_OBJECT)`

```r
bikeshare &lt;- read_csv(
  'https://bcdanl.github.io/data/bikeshare_cleaned.csv')
rm(bikeshare)
```


- When we want to *remove* all the objects from R Environment, we can use `rm(list = ls())`

```r
rm(list = ls())
```


---
class: inverse, center, middle

# Data Transformation
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;
  


---
# Data Transformation

- It is rare that we get the data in exactly the right form we need.

- We'll need to create some new variables, summaries, rename the variables or reorder the observations in order to make the data a little easier to work with.

- We'll discuss how to transform data using the `dplyr` package and a dataset on flights departing New York City in 2013.



```r
library(tidyverse)
library(nycflights13)
library(skimr)
flights &lt;- flights
View(flights) 
?flights
skim(flights)
```



---
# Data Transformation
### &lt;p style="color:#00449E"&gt; `dplyr` basics &lt;/p&gt;

- We are going to discuss the five key `dplyr` functions to solve various data manipulation challenges:
  - Filter observations by logical conditions about values of variables (`filter()`).
  - Arrange/sort rows (`arrange()`).
  - Select variables by their names (`select()`).
  - Create new variables with functions of existing variables (`mutate()`).
  - Collapse a data.frame down to a summarized version of it (`summarize()`).
  - Group a data.frame by a categorical variable (`group_by()`).



---
# Data Transformation
### &lt;p style="color:#00449E"&gt; `dplyr` basics &lt;/p&gt;

- `filter(&lt;DATA.FRAME&gt;, LOGICAL_STATEMENT)`
- `arrange(&lt;DATA.FRAME&gt;, VARIABLES)`
- `select(&lt;DATA.FRAME&gt;, VARIABLES)`
- `group_by(&lt;DATA.FRAME&gt;, VARIABLES)`
- `mutate(&lt;DATA.FRAME&gt;, NEW_VARIABLE = ... )`
- `summarize(&lt;DATA.FRAME&gt;, NEW_VARIABLE = ...)`


- The first argument is a **data.frame**.
- The subsequent arguments describe what to do with the data.frame, mostly using the variable names.
- The result is also a **data.frame**.



---
# Data Transformation
&lt;!-- ### &lt;p style="color:#00449E"&gt; `dplyr` basics &lt;/p&gt; --&gt;

- Because the first argument is a `data.frame` and the output is a `data.frame`, `dplyr` verbs work well with the **pipe**, `%&gt;%` 
  - **Ctrl + Shift + M** for Windows; **command + Shift + M** for Mac. 


- The **pipe** (`%&gt;%`) takes the thing on its left and passes it along to the function on its right so that
  - `f(x, y)` is equivalent to `x %&gt;% f(y)`. 
  - e.g., `filter(&lt;DATA.FRAME&gt;, LOGICAL_STATEMENT)` is equivalent to `&lt;DATA.FRAME&gt; %&gt;%  filter(LOGICAL_STATEMENT)`.


- The easiest way to pronounce the **pipe** (`%&gt;%`) is “**then**”. 
  - The **pipe** (`%&gt;%`) is super useful when we have a chain of data transforming operations to do.


---
class: inverse, center, middle

# `filter()`
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;
  


---
# Filter rows with `filter()`

- `filter()` allows us to subset observations based on the value of logical conditions, which are either `TRUE` or `FALSE`.


```r
filter(flights, month == 1, day == 1)
flights %&gt;% filter(month == 1, day == 1) # equilvant to the above

jan1 &lt;- flights %&gt;% 
  filter(month == 1, day == 1)

dec25 &lt;- flights %&gt;% 
  filter(month == 12, day == 25)

class(flights$month == 1)
```



---
# Filter rows with `filter()`
### &lt;p style="color:#00449E"&gt; `logical` conditions &lt;/p&gt;

Conditions are expressions that evaluate as `logical` 

&lt;table class=" lightable-paper table table-hover table-condensed" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; font-family: sans-serif, helvetica, arial; margin-left: auto; margin-right: auto;'&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Operator &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Description &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x == y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Is x equal to y? &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x != y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Is x not equal to y? &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &amp;gt; y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Is x greater than y? &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &amp;gt;= y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Is x greater than or equal to y? &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &amp;lt; y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Is x less than y? &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;font-weight: bold;border-right:1px solid;"&gt; x &amp;lt;= y &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Is x less than or equal to y? &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---
# Filter rows with `filter()`
### &lt;p style="color:#00449E"&gt; `logical` conditions &lt;/p&gt;

- The `==` is an operator that compares the objects on either side and returns `TRUE` if they have the same values.


```r
df &lt;- tibble( var = c(9, 10, 11) ) 
df %&gt;% filter(var == 10)

cond &lt;- num_vec == 10
df %&gt;% filter(cond)
```

**Q**. What does `! (!F)` evaluate to?


---
# Filter rows with `filter()`
### &lt;p style="color:#00449E"&gt; De Morgan’s law

- `!(x &amp; y)` is the same as `!x | !y`. 
- `!(x | y)` is the same as `!x &amp; !y`.


- Comparison and logical operators can be used with `filter()`:


```r
filter(flights, month == 11 | month == 12)
nov_dec &lt;- flights %&gt;% 
  filter(month %in% c(11, 12))

flights %&gt;% 
  filter(!(arr_delay &gt; 120 | dep_delay &gt; 120))

flights %&gt;% 
  filter(arr_delay &lt;= 120 &amp; dep_delay &lt;= 120)
```



---
# Filter rows with `filter()`
### &lt;p style="color:#00449E"&gt; Missing values (`NA`)

.panelset[

.panel[.panel-name[(1)]
- Almost any operation involving an unknown value (`NA`) will also be unknown.



```r
NA &gt; 5
10 == NA
NA + 10
NA / 2

NA == NA
```
]

.panel[.panel-name[(2)]
- Let `x` be Mary's age. We don't know how old she is.
- Let `y` be John's age. We don't know how old he is.
- Are John and Mary the same age?



```r
x &lt;- NA
y &lt;- NA
x == y
```
]

.panel[.panel-name[(3)]

- If we want to determine if a value is missing, use `is.na()`.
- If we want to preserve missing values, ask `filter()` for them explicitly.

.pull-left[

```r
x &lt;- NA
is.na(x) # is x NA?

y &lt;- "missing"
is.na(y) # is y NA?
```
]

.pull-right[

```r
df &lt;- tibble(y = c(1, NA, 3))

df %&gt;% 
  filter(y &gt; 1)

df %&gt;% 
  filter(is.na(y) | y &gt; 1)
```
]

]

]



---
# Filter rows with `filter()`
### &lt;p style="color:#00449E"&gt; Exercises

- Find all flights that
  - Had an arrival delay of two or more hours
  - Flew to Houston (`IAH` or `HOU`)
  - Were operated by United, American, or Delta
  - Departed in summer (July, August, and September)
  - Arrived more than two hours late, but didn’t leave late
  - Were delayed by at least an hour, but made up over 30 minutes in flight
  - Departed between midnight and 6am (inclusive)


---
# Filter rows with `filter()`
### &lt;p style="color:#00449E"&gt; Exercises

&lt;!-- - Another useful `dplyr` filtering helper is `between()`. What does it do? Can you use it to simplify the code needed to answer the previous challenges? --&gt;

- How many flights have a missing `dep_time`? What other variables are missing? What might these rows represent?

- Why is `NA^0` not missing? Why is `NA | TRUE` not missing? Why is `FALSE &amp; NA` not missing? Can you figure out the general rule? (`NA * 0` is a tricky counterexample!)


---
class:  center, middle

# Attendance Time

Let's have an attendance quiz.



---
class: inverse, center, middle

# `select()`
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;


---
# Select columns with `select()`

- It’s not uncommon to get datasets with hundreds or thousands of variables.
- `select()` allows us to narrow in on the variables we're actually interested in. 



```r
flights %&gt;% 
  select(year, month, day)

flights %&gt;% 
  select(year:day)

flights %&gt;% 
  select(-(year:day))
```



---
# Select columns with `select()`

- There are a number of helper functions we can use within `select()`:

- `starts_with("abc")`: matches names that begin with "abc".

- `ends_with("xyz")`: matches names that end with "xyz".

- `contains("ijk")`: matches names that contain "ijk".

- `num_range("x", 1:3)`: matches x1, x2 and x3.


---
# Select columns with `select()`
### &lt;p style="color:#00449E"&gt; Rename variables with `rename()`


- `rename()` can be used to rename variables:

  - `rename(&lt;DATA&gt;, &lt;NEW_VARIABLE&gt; = &lt;EXISTING_VARIABLE&gt;)`



```r
flights %&gt;% 
  rename( tail_num = tailnum )
```



---
# Change the Order of Variables
### &lt;p style="color:#00449E"&gt; 

.panelset[
.panel[.panel-name[select( , everything())]
- The function, `everything()`, can be used to move variables to the start of the data frame:



```r
flights %&gt;% 
  select(time_hour, air_time, [?])
```

]

.panel[.panel-name[relocate()]

- We can also use `relocate()` to move variables around. 
  - We can specify `.before` and `.after` arguments to choose where to put variables:


```r
flights %&gt;% 
  relocate(time_hour, air_time)

flights %&gt;% 
  relocate(year:dep_time, .after = time_hour)

flights %&gt;% 
  relocate(starts_with("arr"), .before = dep_time)
```

]


]

---
# Select columns with `select()`
### &lt;p style="color:#00449E"&gt; Exercises

- Brainstorm as many ways as possible to select `dep_time`, `dep_delay`, `arr_time`, and `arr_delay` from flights.

- What happens if we include the name of a variable multiple times in a `select()` call?

- What does the `any_of()` function do? Why might it be helpful in conjunction with this vector?


```r
vars &lt;- c("year", "month", "day", "dep_delay", "arr_delay")
```



---
# Select columns with `select()`
### &lt;p style="color:#00449E"&gt; Exercises

- Does the result of running the following code surprise us? How do the select helpers deal with case by default? How can we change that default?


```r
select(flights, contains("TIME"))
```

- Rename `air_time` to `air_time_min` to indicate units of measurement and move it to the beginning of the data frame.



---
class: inverse, center, middle

# `mutate()`
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;

---
# Add new variables with `mutate()`

- `mutate()` is useful to add new columns that are functions of existing columns.



```r
flights_sml &lt;- flights %&gt;% 
  select(year:day, 
         ends_with("delay"), 
         distance, 
         air_time )
flights_sml %&gt;% 
  mutate(gain = dep_delay - arr_delay,
         speed = distance / air_time * 60 )

flights_sml %&gt;% 
  mutate(gain = dep_delay - arr_delay,
         hours = air_time / 60,
         gain_per_hour = gain / hours )
```



---
# Add new variables with `mutate()`

.panelset[
.panel[.panel-name[.before]
- We can use the `.before` argument to add the variables to the position of a column:


```r
flights %&gt;% 
  mutate(
    gain = dep_delay - arr_delay,
    speed = distance / air_time * 60,
    .before = 1  # try different position numbers.
  )
```

- The `.` is a sign that `.before` is an **argument** to the function, not the name of variable.
]


.panel[.panel-name[.after]
- In both `.before` and `.after`, we can use the variable name instead of a position number.


```r
flights %&gt;% 
  mutate(
    gain = dep_delay - arr_delay,
    speed = distance / air_time * 60,
    .after = day  
  )
```
]

]


---
# Add new variables with `mutate()`
### &lt;p style="color:#00449E"&gt; Useful creation functions

- There are many functions for creating new variables that we can use with `mutate()`.

- Arithmetic operators: `+`, `-`, `*`, `/`, `^`
- Modular arithmetic: `%/%` (integer division) and `%%` (remainder).



```r
mutate(flights,
  dep_time,
  hour = dep_time %/% 100,
  minute = dep_time %% 100,
  .before = 1
)
```


---
# Add new variables with `mutate()`

- There are many functions for creating new variables that we can use with `mutate()`.

- Offsets: `lead()` and `lag()` allow us to refer to leading or lagging values. 

- Cumulative and rolling aggregates: R provides functions for running sums, products, mins and maxes: `cumsum()`, `cummean()`, `cummin()`, `cummax()`, and `cumprod()`. 



```r
(x &lt;- 1:10)
lag(x)
lead(x)
cumsum(x)
cummean(x)
```




---
# Add new variables with `mutate()`
### &lt;p style="color:#00449E"&gt; Useful creation functions

- There are many functions for creating new variables that we can use with `mutate()`.


- Ranking: `min_rank()`, `dense_rank()`, `row_number()`, `percent_rank()`, and `cume_dist()`.




```r
rank_me &lt;- tibble( x = c(10, 5, 1, 5, 5, NA) )
rank_me &lt;- mutate(rank_me,
                  id_x = row_number(x),
                  x_min_rank = min_rank(x),
                  x_dense_rank = dense_rank(x) )
```





---
# Add new variables with `mutate()`
### &lt;p style="color:#00449E"&gt; Useful creation functions (cont.)

- To create new variables based on a condition, we can use the `if_else()` and `ifelse()` functions. 
  - `if_else(&lt;condition&gt;, &lt;if TRUE&gt;, &lt;else&gt;)`
  - `ifelse(&lt;condition&gt;, &lt;if TRUE&gt;, &lt;else&gt;)`



```r
flight_season &lt;-mutate(flights,
    summer_month = if_else(month %in% c(6, 7, 8), TRUE, FALSE))

flight_season &lt;-mutate(flights,
    summer_month = if_else(month %in% c(6, 7, 8), TRUE, 0))

flight_season &lt;-mutate(flights,   # ifelse() is less restrictive
    summer_month = ifelse(month %in% c(6, 7, 8), TRUE, 0))
```



---
# Add new variables with `mutate()`
### &lt;p style="color:#00449E"&gt; Exercises
 
- Currently `dep_time` and `sched_dep_time` are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.

- Compare `air_time` with `arr_time - dep_time`. What do you expect to see? What do you see? What do you need to do to fix it?

- Compare `dep_time`, `sched_dep_time`, and `dep_delay.` How would you expect those three numbers to be related?

- Find the 10 most delayed flights using a ranking function. How do you want to handle ties? 


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"highlightLanguage": "r",
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<!--Hat-tip: https://www.garrickadenbuie.com/blog/xaringan-tip-logo-all-slides/-->
<style>
.logo {
  background-image: url(img/logo-blue.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  width: 55px;
  height: 66px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
