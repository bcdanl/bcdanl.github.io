---
title: "R Lab 2 - Data Transformation"
author: "Byeong-Hak Choe"
editor: visual
---

```{r setup, include = FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
library(ggthemes)
library(ggtech)
library(ggthemr)
library(hrbrthemes)
library(hexbin)
library(ggforce)
library(skimr)

knitr::opts_chunk$set(fig.width=8, fig.height=5)  

theme_set(theme_ipsum() +
          theme(strip.background =element_rect(fill="lightgray")))


url <- 'https://bcdanl.github.io/data/bikeshare_cleaned.csv'
bikeshare <- read_csv(url)

url2 <- 'https://bcdanl.github.io/data/NY_school_enrollment_socioecon.csv'
ny_school_enrollment_socio <- read_csv(url2)
```

### Loading R packages

```{r, eval = F, echo = T}
library(tidyverse)
library(skimr)
```

# Question 1 - Tweets with #climatechange

The following data is for Question 1:

```{r, echo = T, eval = T, message=F}
NY_CC_tweets <- read_csv(
  'https://bcdanl.github.io/data/NY_tweets_cc_no_contents.csv')
```


```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(NY_CC_tweets) 
```

<br><br>

## Variable Description

- `id_user`: a unique identification number for a Twitter user whom retweeted to a tweet with *#climatechange* or *#globalwarming*.
- `id_city`: a unique identification number for a city.
- `FIPS`: a unique identification number for a county.

Each row represents an observation of a retweet to a tweet with *#climatechange* or *#globalwarming*.

Each row includes a Twitter user's geographic information at city or county levels (variables `FIPS`, `county`, `city`) as well as information about timing when a Twitter user retweeted (variables `year`, `month`, `day`, `hour`, `minute`, `second`). 


## Q1a
How many Twitter users retweeted on the date, January 1, 2017?

```{r, echo = T, eval = F}

```

<br><br>

## Q1b
Which city is with the third highest number of retweets on the date, December 1, 2017?

```{r, echo = T, eval = F}

```

<br><br>

## Q1c
For each year, find the top 5 Twitter users in NY state in terms of the number of retweets they made in NY state. In which city and county do these users live in?

```{r, echo = T, eval = F}

```

<br><br>

## Q1d
Summarize the data set into the data frame with county and month levels of retweets with the following variables:

- `FIPS`, `county`, `year`, `month`;
- `n_retweets`: the number of retweets in `year` *YYYY* and `month` *MM* from `county` `C`.

The `unique()` or `distinct()` functions can be used to keep only unique/distinct rows from a data frame.

```{r, echo = T, eval = F}

```


<br><br>


## Q1e
Describe the relationship between the number of retweets and `county` using ggplot. Make a simple comment on your plot.

```{r, echo = T, eval = F}

```





<br><br>

# Question 2 - Beer Markets

The following data is for Question 2:

```{r, echo = T, eval = T, message=F}
beer_markets <- read_csv(
  'https://bcdanl.github.io/data/beer_markets.csv'
)
```


```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(beer_markets) 
```

<br><br>


## Variable Description

Each observation in `beer_markets.csv` is a household-level record for one transaction of beer.

<br>

- `hh`: an identifier of the household;
- `X_purchase_desc`: details on the purchased item;
- `quantity`: the number of items purchased;
- `brand`: Bud Light, Busch Light, Coors Light, Miller Lite, or Natural Light;
- `spent`: total dollar value of purchase;
- `beer_floz`: total volume of beer, in fluid ounces;
- `price_per_floz`: price per fl.oz. (i.e., beer spent/beer floz);
- `container`: the type of container;
- `promo`: Whether the item was promoted (coupon or otherwise);
- `market`: Scan-track market (or state if rural);
- demographic data, including gender, marital status, household income, class of work, race, education, age, the size of household, and whether or not the household has a microwave or a dishwasher.



<br><br>


## Q2a
- Find the top 5 markets in terms of the total volume of beer.
- Find the top 5 markets in terms of the total volume of *BUD LIGHT*.
- Find the top 5 markets in terms of the total volume of *BUSCH LIGHT*.
- Find the top 5 markets in terms of the total volume of *COORS LIGHT*.
- Find the top 5 markets in terms of the total volume of *MILLER LITE*.
- Find the top 5 markets in terms of the total volume of *NATURAL LIGHT*.




<br><br>



## Q2b
- For households that purchased *BUD LIGHT*, what fraction of households did purchase only *BUD LIGHT*?

- For households that purchased *BUSCH LIGHT*, what fraction of households did purchase only *BUSCH LIGHT*?

- For households that purchased *COORS LIGHT*, what fraction of households did purchase only *COORS LIGHT*?

- For households that purchased *MILLER LITE*, what fraction of households did purchase only *MILLER LITE*?

- For households that purchased *NATURAL LIGHT*, what fraction of households did purchase only *NATURAL LIGHT*?

- Which beer brand does have the largest base of loyal consumers?



<br><br>

## Q2c
- Calculate the number of beer transactions for each household. 
- Calculate the fraction of each beer brand for each household.

