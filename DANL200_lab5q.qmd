---
title: "R Lab 5 - Linear Regression 1"
author: "Byeong-Hak Choe"
---

```{r setup, include = FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
library(ggthemes)
library(ggtech)
library(ggthemr)
library(hrbrthemes)
library(hexbin)
library(ggforce)
library(skimr)

knitr::opts_chunk$set(fig.width=8, fig.height=5)  

theme_set(theme_ipsum() +
          theme(strip.background =element_rect(fill="lightgray")))


```

## Loading R packages

```{r, eval = T, echo = T}
library(tidyverse)
library(skimr)
```


# Question 1

Read the data file, `bikeshare_cleaned.csv`, as the data.frame object with the name, `bikeshare`, using (1) the `read_csv()` function and (2) its URL, `https://bcdanl.github.io/data/bikeshare_cleaned.csv`.

```{r, message=F, warning=F}
url <- 'https://bcdanl.github.io/data/bikeshare_cleaned.csv'
bikeshare <- read_csv(url)
```

- `bikeshare` data.frame
```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(bikeshare, 
                       options = list(cols.print = 5))
```

<br>

## Variable Description
- `cnt`: count of total rental bikes
- `year`: year
- `month`: month
- `date`: date
- `hr`: hours 
- `wkday`: week day
- `holiday`: holiday if `holiday == 1`; non-holiday otherwise
- `seasons`: season
- `weather_cond`: weather condition
- `temp`: temperature, measured in standard deviations from average.
- `hum`: humidity, measured in standard deviations from average.
- `windspeed`: wind speed, measured in standard deviations from average.

<br>

## Q1a
- From the `bikeshare` data.frame, convert variables `year`, `month`, `wkday`, `hr`, `seasons`, and `weather_cond` into factor variables.
  - Set `wkday` in order of '`sunday`', '`monday`', '`tuesday`', and so on.
  - Set `seasons` in order of '`spring`', '`summer`', '`fall`', and '`winter`'



<br>

## Q1b
- Randomly divide the `bikeshare` data.frame into training and test data.frames, `dtrain` and `dtest`, respectively.
  - Make sure that you can replicate the randomization.
  - Approximately 70% of observations in `bikeshare` go to `dtrain`.
  - The rest of observations in `bikeshare` go to `dtest`.



<br>

## Q1c
- Use `dtrain` to train the five different linear regression models with `formula_1`, `formula_2`, `formula_3`, `formula_4`, and `formula_5`, respectively.

```{r}
formula_1 <- 
  cnt ~ temp + windspeed + weather_cond + hr

formula_2 <- 
  cnt ~ hum + windspeed + weather_cond + hr

formula_3 <- 
  cnt ~ temp + hum + windspeed + weather_cond + hr + year 

formula_4 <- 
  cnt ~ temp + hum + windspeed + weather_cond + hr + month + year

formula_5 <- 
  log(cnt) ~ temp + hum + windspeed + weather_cond + hr + month + year
```

- Provide the summary of the regression results.



<br>

## Q1d
- In each model, which `hr` is most strongly associated with changes in `cnt`?
- Interpret the beta estimate of that `hr`.


<br>

## Q1e
- For each model, make a prediction on the outcome variable using the `dtest`.



<br>

## Q1f
- Draw a residual plot for each model.
- Using the residual plots to answer the following questions:
  - On average, are the predictions correct in the models in Q1c?
  - Are there systematic errors?


<br>

## Q1g
- Compare the prediction accuracy across the models in Q1c.
  - Which model do you prefer most and why?