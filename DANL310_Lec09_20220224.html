<!DOCTYPE html>
<html>
<head>
  <title>DANL 310 Lecture 09</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />



  <meta name="date" content="2022-02-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'DANL 310 Lecture 09',
                        useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                      },

      // Author information
      presenters: [
            {
        name:  'Byeong-Hak Choe' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <link href="site_libs/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-r.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    summary {
      display: list-item;
    }

    slides > slide {
      -webkit-transition: all 0s ease-in-out;
      -moz-transition: all 0s ease-in-out;
      -o-transition: all 0s ease-in-out;
      transition: all 0s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0s;
      -moz-transition: opacity 0.6s ease-in 0s;
      -o-transition: opacity 0.6s ease-in 0s;
      transition: opacity 0.6s ease-in 0s;
      opacity: 0;
    }
/* https://github.com/ropensci/plotly/pull/524#issuecomment-468142578 */
slide:not(.current) .plotly.html-widget{
  display: block;
}

    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        
  </style>


</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      
      <p data-config-presenter><!-- populated from slide_config.json --></p>
            <p style="margin-top: 6px; margin-left: -2px;">February 24, 2022</p>
          </hgroup>
  </slide>

<slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Work with models; Draw maps</h2></hgroup><article  id="work-with-models-draw-maps">

</article></slide><slide class=""><hgroup><h2>R packages</h2></hgroup><article  id="r-packages">

<pre class = 'prettyprint lang-r'>library(tidyverse)
library(socviz)
library(gapminder)
library(skimr)
library(ggrepel)
library(ggthemes)
library(broom)
theme_set(theme_minimal())</pre>

</article></slide><slide class=""><hgroup><h2>Work with models</h2></hgroup><article  class="build faster" id="work-with-models">

<ul>
<li>Let us consider the linear regression of <code>lifeExp</code> on <code>gdpPercap</code>, <code>pop</code>, and <code>continent</code>.</li>
</ul>

<pre class = 'prettyprint lang-r'>out &lt;- lm(formula = lifeExp ~ log(gdpPercap) + pop + continent,
          data = gapminder)

summary(out)</pre>

<pre >## 
## Call:
## lm(formula = lifeExp ~ log(gdpPercap) + pop + continent, data = gapminder)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -26.7090  -3.4832   0.4396   4.4062  18.6914 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       1.476e+00  1.352e+00   1.091    0.275    
## log(gdpPercap)    6.524e+00  1.824e-01  35.778  &lt; 2e-16 ***
## pop               9.990e-09  1.650e-09   6.056 1.72e-09 ***
## continentAmericas 6.729e+00  5.507e-01  12.218  &lt; 2e-16 ***
## continentAsia     5.157e+00  4.880e-01  10.567  &lt; 2e-16 ***
## continentEurope   9.290e+00  5.997e-01  15.491  &lt; 2e-16 ***
## continentOceania  8.965e+00  1.521e+00   5.896 4.49e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.965 on 1697 degrees of freedom
## Multiple R-squared:  0.7102, Adjusted R-squared:  0.7092 
## F-statistic: 693.3 on 6 and 1697 DF,  p-value: &lt; 2.2e-16</pre>

<pre class = 'prettyprint lang-r'>str(out)</pre>

<pre >## List of 13
##  $ coefficients : Named num [1:7] 1.48 6.52 9.99e-09 6.73 5.16 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:7] &quot;(Intercept)&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continentAmericas&quot; ...
##  $ residuals    : Named num [1:1704] -21.4 -20.2 -18.8 -16.6 -13.8 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:1704] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ effects      : Named num [1:1704] -2455.1 430.5 58.4 26.9 -24 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:1704] &quot;(Intercept)&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continentAmericas&quot; ...
##  $ rank         : int 7
##  $ fitted.values: Named num [1:1704] 50.2 50.5 50.8 50.6 49.9 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:1704] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ assign       : int [1:7] 0 1 2 3 3 3 3
##  $ qr           :List of 5
##   ..$ qr   : num [1:1704, 1:7] -41.2795 0.0242 0.0242 0.0242 0.0242 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:1704] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:7] &quot;(Intercept)&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continentAmericas&quot; ...
##   .. ..- attr(*, &quot;assign&quot;)= int [1:7] 0 1 2 3 3 3 3
##   .. ..- attr(*, &quot;contrasts&quot;)=List of 1
##   .. .. ..$ continent: chr &quot;contr.treatment&quot;
##   ..$ qraux: num [1:7] 1.02 1.03 1.01 1.01 1.04 ...
##   ..$ pivot: int [1:7] 1 2 3 4 5 6 7
##   ..$ tol  : num 1e-07
##   ..$ rank : int 7
##   ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot;
##  $ df.residual  : int 1697
##  $ contrasts    :List of 1
##   ..$ continent: chr &quot;contr.treatment&quot;
##  $ xlevels      :List of 1
##   ..$ continent: chr [1:5] &quot;Africa&quot; &quot;Americas&quot; &quot;Asia&quot; &quot;Europe&quot; ...
##  $ call         : language lm(formula = lifeExp ~ log(gdpPercap) + pop + continent, data = gapminder)
##  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language lifeExp ~ log(gdpPercap) + pop + continent
##   .. ..- attr(*, &quot;variables&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. .. ..$ : chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. ..- attr(*, &quot;order&quot;)= int [1:3] 1 1 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:4] &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;factor&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##  $ model        :&#39;data.frame&#39;:   1704 obs. of  4 variables:
##   ..$ lifeExp       : num [1:1704] 28.8 30.3 32 34 36.1 ...
##   ..$ log(gdpPercap): num [1:1704] 6.66 6.71 6.75 6.73 6.61 ...
##   ..$ pop           : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
##   ..$ continent     : Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##   ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39;  language lifeExp ~ log(gdpPercap) + pop + continent
##   .. .. ..- attr(*, &quot;variables&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. .. ..- attr(*, &quot;factors&quot;)= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. .. .. ..$ : chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. ..- attr(*, &quot;term.labels&quot;)= chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. ..- attr(*, &quot;order&quot;)= int [1:3] 1 1 1
##   .. .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. .. ..- attr(*, &quot;response&quot;)= int 1
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. .. ..- attr(*, &quot;predvars&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:4] &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;factor&quot;
##   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;lm&quot;</pre>

<ul>
<li>Try <code>out$coefficients</code>, <code>out$residuals</code>, and <code>out$fitted.values</code>.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Tidy model objects with <code>broom</code></h2></hgroup><article  class="build faster" id="tidy-model-objects-with-broom">

<ul>
<li><p>The <code>broom</code> package to help us do a lot of things with our model output.</p></li>
<li><p><code>broom</code> can tidily extract three kinds of information.</p>

<ul>
<li>We can see <em>component-level</em> information about aspects of the model itself, such as <strong>coefficients</strong> and <strong>t-statistics</strong>.</li>
<li>We can obtain <em>observation-level</em> information about the model’s connection to the underlying data, such as <strong>fitted values</strong> and <strong>residuals</strong>.</li>
<li>We can get <em>model-level</em> information that summarizes the fit as a whole, such as <strong>F-statistic</strong>, <strong>model deviance</strong>, or <strong>r-squared</strong>.</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>library(broom)</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy">

<ul>
<li>The <code>tidy()</code> function takes a model object and returns a data frame of component-level information.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_comp &lt;- tidy(out)
out_comp %&gt;% round_df()</pre>

<pre >## # A tibble: 7 × 5
##   term              estimate std.error statistic p.value
##   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)           1.48      1.35      1.09    0.28
## 2 log(gdpPercap)        6.52      0.18     35.8     0   
## 3 pop                   0         0         6.06    0   
## 4 continentAmericas     6.73      0.55     12.2     0   
## 5 continentAsia         5.16      0.49     10.6     0   
## 6 continentEurope       9.29      0.6      15.5     0   
## 7 continentOceania      8.96      1.52      5.9     0</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-1">

<ul>
<li>We can work with <code>tidy()</code> to make plots in a familiar way, and much more easily.</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(out_comp, mapping = aes(x = term,
                                    y = estimate))

p + geom_point() + coord_flip() </pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code>tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-2">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-6-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-3">

<ul>
<li>We can tell <code>tidy()</code> to calculate confidence intervals for the estimates, using R’s <code>conf.int = TRUE</code> option.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_conf &lt;- tidy(out, conf.int = TRUE)
out_conf %&gt;% round_df()</pre>

<pre >## # A tibble: 7 × 7
##   term              estimate std.error statistic p.value conf.low conf.high
##   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)           1.48      1.35      1.09    0.28    -1.18      4.13
## 2 log(gdpPercap)        6.52      0.18     35.8     0        6.17      6.88
## 3 pop                   0         0         6.06    0        0         0   
## 4 continentAmericas     6.73      0.55     12.2     0        5.65      7.81
## 5 continentAsia         5.16      0.49     10.6     0        4.2       6.11
## 6 continentEurope       9.29      0.6      15.5     0        8.11     10.5 
## 7 continentOceania      8.96      1.52      5.9     0        5.98     12.0</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-4">

<ul>
<li>We can tell <code>tidy()</code> to calculate confidence intervals for the estimates, using R’s <code>conf.int = TRUE</code> option.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_conf &lt;- subset(out_conf, term != &quot;(Intercept)&quot;)
out_conf$nicelabs &lt;- prefix_strip(out_conf$term, &quot;continent&quot;)</pre>

<ul>
<li>The <code>socviz::prefix_strip()</code> strips a series of characters from the beginning of a character vector.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code>tidy()</code></h2></hgroup><article  class="build faster" id="get-component-level-statistics-with-tidy-5">

<ul>
<li>We can use <code>geom_pointrange()</code> to make a figure that displays some information about our confidence in the variable estimates</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(out_conf, mapping = aes(x = reorder(nicelabs, estimate),
                                    y = estimate, ymin = conf.low, ymax = conf.high))
p + geom_pointrange() + coord_flip() + labs(x=&quot;&quot;, y=&quot;OLS Estimate&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code>tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-6">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-10-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  id="get-observation-level-statistics-with-augment">

<ul>
<li><p>The values returned by <code>augment()</code> are all statistics calculated at the level of the original observations.</p></li>
<li><p>Working from a call to <code>augment()</code> will return a data frame with all the original observations used in the estimation of the model, together with columns like the following:</p>

<ul>
<li><code>.fitted</code> — The fitted values of the model.</li>
<li><code>.se.fit</code> — The standard errors of the fitted values.</li>
<li><code>.resid</code> — The residuals; <code>.std.resid</code> — The standardized residuals.</li>
<li><code>.hat</code> — The diagonal of the hat matrix.</li>
<li><code>.sigma</code> — An estimate of residual standard deviation when the corresponding observation is dropped from the model.</li>
<li><code>.cooksd</code> — Cook’s distance, a common regression diagnostic on how the observation is influential in the estimation;</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  class="build faster" id="get-observation-level-statistics-with-augment-1">

<pre class = 'prettyprint lang-r'>out_aug &lt;- augment(out)
head(out_aug) </pre>

<pre >## # A tibble: 6 × 9
##   lifeExp `log(gdpPercap)`      pop continent .fitted    .hat .sigma .cooksd
##     &lt;dbl&gt;            &lt;dbl&gt;    &lt;int&gt; &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1    28.8             6.66  8425333 Asia         50.2 0.00427   6.95 0.00578
## 2    30.3             6.71  9240934 Asia         50.5 0.00416   6.95 0.00503
## 3    32.0             6.75 10267083 Asia         50.8 0.00408   6.95 0.00426
## 4    34.0             6.73 11537966 Asia         50.6 0.00410   6.96 0.00337
## 5    36.1             6.61 13079460 Asia         49.9 0.00433   6.96 0.00244
## 6    38.4             6.67 14880372 Asia         50.3 0.00419   6.96 0.00175
## # … with 1 more variable: .std.resid &lt;dbl&gt;</pre>

<pre class = 'prettyprint lang-r'>head(out_aug) %&gt;% round_df()</pre>

<pre >## # A tibble: 6 × 9
##   lifeExp `log(gdpPercap)`    pop continent .fitted  .hat .sigma .cooksd .std.resid
##     &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
## 1    28.8             6.66 8.43e6 Asia         50.2     0   6.95    0.01      -3.07
## 2    30.3             6.71 9.24e6 Asia         50.5     0   6.95    0.01      -2.9 
## 3    32               6.75 1.03e7 Asia         50.8     0   6.95    0         -2.7 
## 4    34.0             6.73 1.15e7 Asia         50.6     0   6.96    0         -2.39
## 5    36.1             6.61 1.31e7 Asia         49.9     0   6.96    0         -1.98
## 6    38.4             6.67 1.49e7 Asia         50.3     0   6.96    0         -1.7</pre>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  class="build faster" id="get-observation-level-statistics-with-augment-2">

<ul>
<li>The new columns created by <code>augment()</code> can be used to create some standard regression plots.

<ul>
<li>We can draw the residual plot (the residuals versus the fitted values).</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = out_aug,
            mapping = aes(x = .fitted, y = lifeExp - .fitted))
p + geom_point()</pre>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  class="build faster" id="get-observation-level-statistics-with-augment-3">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-13-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Get model-level statistics with <code>glance()</code></h2></hgroup><article  class="build faster" id="get-model-level-statistics-with-glance">

<ul>
<li><code>glance()</code> returns the information typically presented at the bottom of a model’s <code>summary()</code> output.</li>
</ul>

<pre class = 'prettyprint lang-r'>glance(out) %&gt;% round_df()</pre>

<pre >## # A tibble: 1 × 12
##   r.squared adj.r.squared sigma statistic p.value    df logLik    AIC    BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1      0.71          0.71  6.97      693.       0     6 -5722. 11460. 11503.
## # … with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;dbl&gt;, nobs &lt;dbl&gt;</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  class="build faster" id="grouped-analysis-and-list-columns">

<ul>
<li>Consider the linear regression model for the relationship between life expectancy and GDP by continent, for each year in the data.</li>
</ul>

<pre class = 'prettyprint lang-r'>eu77 &lt;- gapminder %&gt;% filter(continent == &quot;Europe&quot;, year == 1977)
fit &lt;- lm(lifeExp ~ log(gdpPercap), data = eu77)
summary(fit)</pre>

<pre >## 
## Call:
## lm(formula = lifeExp ~ log(gdpPercap), data = eu77)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.4956 -1.0306  0.0935  1.1755  3.7125 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      29.489      7.161   4.118 0.000306 ***
## log(gdpPercap)    4.488      0.756   5.936 2.17e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.114 on 28 degrees of freedom
## Multiple R-squared:  0.5572, Adjusted R-squared:  0.5414 
## F-statistic: 35.24 on 1 and 28 DF,  p-value: 2.173e-06</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  class="build faster" id="grouped-analysis-and-list-columns-1">

<ul>
<li>With <code>dplyr</code> and <code>broom</code> we can do the grouped analysis for every continent-year slice of the data in a compact and tidy way.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_le &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest()
out_le</pre>

<pre >## # A tibble: 60 × 3
## # Groups:   continent, year [60]
##    continent  year data             
##    &lt;fct&gt;     &lt;int&gt; &lt;list&gt;           
##  1 Asia       1952 &lt;tibble [33 × 4]&gt;
##  2 Asia       1957 &lt;tibble [33 × 4]&gt;
##  3 Asia       1962 &lt;tibble [33 × 4]&gt;
##  4 Asia       1967 &lt;tibble [33 × 4]&gt;
##  5 Asia       1972 &lt;tibble [33 × 4]&gt;
##  6 Asia       1977 &lt;tibble [33 × 4]&gt;
##  7 Asia       1982 &lt;tibble [33 × 4]&gt;
##  8 Asia       1987 &lt;tibble [33 × 4]&gt;
##  9 Asia       1992 &lt;tibble [33 × 4]&gt;
## 10 Asia       1997 &lt;tibble [33 × 4]&gt;
## # … with 50 more rows</pre>

<ul>
<li><code>nest()</code> creates a list-column of data frames.

<ul>
<li>The list column, <code>data</code>, contains a small table of data corresponding to each continent-year group.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  class="build faster" id="grouped-analysis-and-list-columns-2">

<ul>
<li>We can look at specific group, for example, &ldquo;Europe 1977&rdquo;, if we like, by filtering the data and then unnesting the list column.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_le %&gt;% filter(continent == &quot;Europe&quot; &amp; year == 1977) %&gt;% 
  unnest()</pre>

<pre >## # A tibble: 30 × 6
## # Groups:   continent, year [1]
##    continent  year country                lifeExp      pop gdpPercap
##    &lt;fct&gt;     &lt;int&gt; &lt;fct&gt;                    &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Europe     1977 Albania                   68.9  2509048     3533.
##  2 Europe     1977 Austria                   72.2  7568430    19749.
##  3 Europe     1977 Belgium                   72.8  9821800    19118.
##  4 Europe     1977 Bosnia and Herzegovina    69.9  4086000     3528.
##  5 Europe     1977 Bulgaria                  70.8  8797022     7612.
##  6 Europe     1977 Croatia                   70.6  4318673    11305.
##  7 Europe     1977 Czech Republic            70.7 10161915    14800.
##  8 Europe     1977 Denmark                   74.7  5088419    20423.
##  9 Europe     1977 Finland                   72.5  4738902    15605.
## 10 Europe     1977 France                    73.8 53165019    18293.
## # … with 20 more rows</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  class="build faster" id="grouped-analysis-and-list-columns-3">

<ul>
<li>List columns are useful because we can act on them in a compact and tidy way.</li>
</ul>

<pre class = 'prettyprint lang-r'>fit_ols &lt;- function(df) {
    lm(lifeExp ~ log(gdpPercap), data = df)
}

out_le &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest() %&gt;% 
    mutate(model = map(data, fit_ols)) 

out_le</pre>

<pre >## # A tibble: 60 × 4
## # Groups:   continent, year [60]
##    continent  year data              model 
##    &lt;fct&gt;     &lt;int&gt; &lt;list&gt;            &lt;list&gt;
##  1 Asia       1952 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  2 Asia       1957 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  3 Asia       1962 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  4 Asia       1967 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  5 Asia       1972 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  6 Asia       1977 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  7 Asia       1982 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  8 Asia       1987 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  9 Asia       1992 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
## 10 Asia       1997 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
## # … with 50 more rows</pre>

<ul>
<li><code>map()</code> function applies a function to each element of a vector.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  class="build faster" id="grouped-analysis-and-list-columns-4">

<pre class = 'prettyprint lang-r'>fit_ols &lt;- function(df) {
    lm(lifeExp ~ log(gdpPercap), data = df)
}

out_tidy &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest() %&gt;% 
    mutate(model = map(data, fit_ols),
           tidied = map(model, tidy)) %&gt;%
    unnest(tidied) %&gt;%
    filter(term != &quot;(Intercept)&quot; &amp;
           continent != &quot;Oceania&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  class="build faster" id="grouped-analysis-and-list-columns-5">

<ul>
<li>We now have tidy regression output with an estimate of the association between log GDP per capita and life expectancy <em>for each year</em>, <em>within continents</em>.</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = out_tidy,
            mapping = aes(x = year, y = estimate,
                          ymin = estimate - 2*std.error,
                          ymax = estimate + 2*std.error,
                          group = continent, color = continent))

p + geom_pointrange(position = position_dodge(width = 1)) +
    scale_x_continuous(breaks = unique(gapminder$year)) + 
    theme(legend.position = &quot;top&quot;) +
    labs(x = &quot;Year&quot;, y = &quot;Estimate&quot;, color = &quot;Continent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns-6">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-21-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data">

<ul>
<li>The <code>socviz::election</code> dataset has various measures of the vote and vote shares by state.</li>
</ul>

<pre class = 'prettyprint lang-r'>election %&gt;% select(state, total_vote,
                    r_points, pct_trump, party, census) %&gt;%
    sample_n(5)</pre>

<pre >## # A tibble: 5 × 6
##   state          total_vote r_points pct_trump party      census   
##   &lt;chr&gt;               &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    
## 1 Tennessee         2508027   26          60.7 Republican South    
## 2 Montana            501822   20.2        55.6 Republican West     
## 3 South Carolina    2103027   14.3        54.9 Republican South    
## 4 Texas             8993166    8.98       52.1 Republican South    
## 5 Pennsylvania      6166729    0.710      48.2 Republican Northeast</pre>

<ul>
<li>We don’t have to represent spatial data spatially.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-1">

<pre class = 'prettyprint lang-r'>party_colors &lt;- c(&quot;#2E74C0&quot;, &quot;#CB454A&quot;)  # Hex color codes for Dem Blue and Rep Red
p0 &lt;- ggplot(data = subset(election, st %nin% &quot;DC&quot;),
             mapping = aes(x = r_points,
                           y = reorder(state, r_points),
                           color = party))

p1 &lt;- p0 + geom_vline(xintercept = 0, color = &quot;gray30&quot;) +
    geom_point(size = 2)

p2 &lt;- p1 + scale_color_manual(values = party_colors)

p3 &lt;- p2 + scale_x_continuous(breaks = c(-30, -20, -10, 0, 10, 20, 30, 40),
                              labels = c(&quot;30\n (Clinton)&quot;, &quot;20&quot;, &quot;10&quot;, &quot;0&quot;,
                                         &quot;10&quot;, &quot;20&quot;, &quot;30&quot;, &quot;40\n(Trump)&quot;))

p3 + facet_wrap(~ census, ncol=1, scales=&quot;free_y&quot;) +
     guides(color = &quot;none&quot;) + labs(x = &quot;Point Margin&quot;, y = &quot;&quot;) +
     theme(axis.text=element_text(size=8))</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-2">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-24-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-3">

<ul>
<li>Let us get a data frame of the US state map</li>
</ul>

<pre class = 'prettyprint lang-r'>us_states &lt;- map_data(&quot;state&quot;)
head(us_states)</pre>

<pre >##        long      lat group order  region subregion
## 1 -87.46201 30.38968     1     1 alabama      &lt;NA&gt;
## 2 -87.48493 30.37249     1     2 alabama      &lt;NA&gt;
## 3 -87.52503 30.37249     1     3 alabama      &lt;NA&gt;
## 4 -87.53076 30.33239     1     4 alabama      &lt;NA&gt;
## 5 -87.57087 30.32665     1     5 alabama      &lt;NA&gt;
## 6 -87.58806 30.32665     1     6 alabama      &lt;NA&gt;</pre>

<pre class = 'prettyprint lang-r'>dim(us_states)</pre>

<pre >## [1] 15537     6</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-4">

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = us_states,
            mapping = aes(x = long, y = lat,
                          group = group))

p + geom_polygon(fill = &quot;white&quot;, color = &quot;black&quot;)</pre>

<ul>
<li>A map is a set of lines drawn in the right order on a grid.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-5">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-27-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-6">

<ul>
<li>Let’s <code>fill</code> the map.</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = us_states,
            aes(x = long, y = lat,
                group = group, fill = region))

p + geom_polygon(color = &quot;gray90&quot;, size = 0.1) + guides(fill = FALSE)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-7">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-29-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-8">

<ul>
<li>Let’s deal with the projection.

<ul>
<li>By default, the map is plotted using the venerable <em>Mercator</em> projection.</li>
<li>The <em>Albers</em> projection is nicer.</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = us_states,
            mapping = aes(x = long, y = lat,
                          group = group, fill = region))

p + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) +
    guides(fill = FALSE)</pre>

<ul>
<li><p>We can transform the default projection used by <code>geom_polygon()</code>, via the <code>coord_map()</code> function.</p>

<ul>
<li>The <em>Albers</em> projection requires two latitude parameters, <code>lat0</code> and <code>lat1</code>.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-9">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-31-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-10">

<ul>
<li>Let’s get the <code>election</code> data on to the map</li>
</ul>

<pre class = 'prettyprint lang-r'>election$region &lt;- tolower(election$state)
us_states_elec &lt;- left_join(us_states, election)</pre>

<ul>
<li><p>In the map data, <code>us_states</code>, the state names (in a variable named <code>region</code>) are in lower case.</p></li>
<li><p>Here we can create a variable in the <code>election</code> data frame to correspond to this, using the <code>tolower()</code> function to convert the state names.</p></li>
<li><p>It is important to know your data and variables well enough to check that they have merged properly.</p>

<ul>
<li>FIPS code is useful in joining the data.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-11">

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = us_states_elec,
            aes(x = long, y = lat,
                group = group, fill = party))

p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) </pre>

<ul>
<li>We use our <code>party</code> colors for the <code>fill</code>.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-12">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-34-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-13">

<pre class = 'prettyprint lang-r'>p1 &lt;- p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) 

p2 &lt;- p1 + scale_fill_manual(values = party_colors) +
    labs(title = &quot;Election Results 2016&quot;, fill = NULL)

p2 + theme_map() </pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-14">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-36-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-15">

<ul>
<li>To the <code>fill</code> aethetic, let’s try a continuous measure, such as the percentage of the vote received by Donald Trump (<code>pct_trump</code>).</li>
</ul>

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = us_states_elec,
             mapping = aes(x = long, y = lat, group = group, fill = pct_trump))

p1 &lt;- p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) 

p1 + labs(title = &quot;Trump vote&quot;) + theme_map() + labs(fill = &quot;Percent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-16">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-38-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-17">

<ul>
<li><p>Blue is not the color we want here.</p></li>
<li><p>The color gradient runs in the wrong direction.</p></li>
<li><p>Let’s fix these problems using <code>scale_fill_gradient()</code>:</p></li>
</ul>

<pre class = 'prettyprint lang-r'>p2 &lt;- p1 + scale_fill_gradient(low = &quot;white&quot;, high = &quot;#CB454A&quot;) +
        labs(title = &quot;Trump vote&quot;) 
p2 + theme_map() + labs(fill = &quot;Percent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-18">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-40-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-19">

<ul>
<li>For election results, we might prefer a gradient that diverges from a midpoint.

<ul>
<li>The <code>scale_gradient2()</code> function gives us a blue-red spectrum that passes through white by default.</li>
<li>We can also re-specify the mid-level color along with the <code>high</code> and <code>low</code> colors.</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = us_states_elec,
             mapping = aes(x = long, y = lat, group = group, fill = d_points))

p1 &lt;- p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) 

p2 &lt;- p1 + scale_fill_gradient2() + labs(title = &quot;Winning margins&quot;) 
p2 + theme_map() + labs(fill = &quot;Percent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-20">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-42-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-21">

<ul>
<li>From the <code>scale_gradient2()</code> function, we can also re-specify the mid-level color along with the <code>high</code> and <code>low</code> colors.</li>
</ul>

<pre class = 'prettyprint lang-r'>p3 &lt;- p1 + scale_fill_gradient2(low = &quot;red&quot;, 
                                mid = scales::muted(&quot;purple&quot;),
                                high = &quot;blue&quot;, 
                                breaks = c(-25, 0, 25, 50, 75)) 
p3 + theme_map() + labs(fill = &quot;Percent&quot;, title = &quot;Winning margins&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-22">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-44-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  class="build faster" id="map-u.s.-state-level-data-23">

<ul>
<li>If you take a look at the gradient scale for this first &ldquo;purple America&rdquo; map, <code>p3</code>, you’ll see that it extends very high on the Blue side.

<ul>
<li>This is because Washington DC is included in the data.</li>
</ul></li>
<li>If we omit Washington DC, we’ll see that our color scale shifts.</li>
</ul>

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = subset(us_states_elec,
                           region %nin% &quot;district of columbia&quot;),
             aes(x = long, y = lat, group = group, fill = d_points))

p3 &lt;- p1 + scale_fill_gradient2(low = &quot;red&quot;, 
                                mid = scales::muted(&quot;purple&quot;),
                                high = &quot;blue&quot;, 
                                breaks = c(-25, 0, 25, 50, 75)) 
p3 + theme_map() + labs(fill = &quot;Percent&quot;, title = &quot;Winning margins&quot;, caption = &quot;DC is omitted.&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-24">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-46-1.png" width="720" style="display: block; margin: auto;" /></p></article></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>
