<!DOCTYPE html>
<html>
<head>
  <title>DANL 310 Lecture 09</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="generator" content="pandoc" />



  <meta name="date" content="2022-02-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <base target="_blank">

  <script type="text/javascript">
    var SLIDE_CONFIG = {
      // Slide settings
      settings: {
                title: 'DANL 310 Lecture 09',
                        useBuilds: true,
        usePrettify: true,
        enableSlideAreas: true,
        enableTouch: true,
                      },

      // Author information
      presenters: [
            {
        name:  'Byeong-Hak Choe' ,
        company: '',
        gplus: '',
        twitter: '',
        www: '',
        github: ''
      },
            ]
    };
  </script>

  <script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
  <link href="site_libs/ioslides-13.5.1/fonts/fonts.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/default.css" rel="stylesheet" />
  <link href="site_libs/ioslides-13.5.1/theme/css/phone.css" rel="stylesheet" />
  <script src="site_libs/ioslides-13.5.1/js/modernizr.custom.45394.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/prettify.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-r.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/prettify/lang-yaml.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/hammer.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-controller.js"></script>
  <script src="site_libs/ioslides-13.5.1/js/slide-deck.js"></script>

  <style type="text/css">

    b, strong {
      font-weight: bold;
    }

    em {
      font-style: italic;
    }

    summary {
      display: list-item;
    }

    slides > slide {
      -webkit-transition: all 0s ease-in-out;
      -moz-transition: all 0s ease-in-out;
      -o-transition: all 0s ease-in-out;
      transition: all 0s ease-in-out;
    }

    .auto-fadein {
      -webkit-transition: opacity 0.6s ease-in;
      -webkit-transition-delay: 0s;
      -moz-transition: opacity 0.6s ease-in 0s;
      -o-transition: opacity 0.6s ease-in 0s;
      transition: opacity 0.6s ease-in 0s;
      opacity: 0;
    }
/* https://github.com/ropensci/plotly/pull/524#issuecomment-468142578 */
slide:not(.current) .plotly.html-widget{
  display: block;
}

    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
            pre > code.sourceCode { white-space: pre; position: relative; }
            pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
            pre > code.sourceCode > span:empty { height: 1.2em; }
            .sourceCode { overflow: visible; }
            code.sourceCode > span { color: inherit; text-decoration: inherit; }
            div.sourceCode { margin: 1em 0; }
            pre.sourceCode { margin: 0; }
            @media screen {
            div.sourceCode { overflow: auto; }
            }
            @media print {
            pre > code.sourceCode { white-space: pre-wrap; }
            pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
            }
            pre.numberSource code
              { counter-reset: source-line 0; }
            pre.numberSource code > span
              { position: relative; left: -4em; counter-increment: source-line; }
            pre.numberSource code > span > a:first-child::before
              { content: counter(source-line);
                position: relative; left: -1em; text-align: right; vertical-align: baseline;
                border: none; display: inline-block;
                -webkit-touch-callout: none; -webkit-user-select: none;
                -khtml-user-select: none; -moz-user-select: none;
                -ms-user-select: none; user-select: none;
                padding: 0 4px; width: 4em;
                color: #aaaaaa;
              }
            pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
            div.sourceCode
              {   }
            @media screen {
            pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
            }
            code span.al { color: #ff0000; font-weight: bold; } /* Alert */
            code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
            code span.at { color: #7d9029; } /* Attribute */
            code span.bn { color: #40a070; } /* BaseN */
            code span.bu { } /* BuiltIn */
            code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
            code span.ch { color: #4070a0; } /* Char */
            code span.cn { color: #880000; } /* Constant */
            code span.co { color: #60a0b0; font-style: italic; } /* Comment */
            code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
            code span.do { color: #ba2121; font-style: italic; } /* Documentation */
            code span.dt { color: #902000; } /* DataType */
            code span.dv { color: #40a070; } /* DecVal */
            code span.er { color: #ff0000; font-weight: bold; } /* Error */
            code span.ex { } /* Extension */
            code span.fl { color: #40a070; } /* Float */
            code span.fu { color: #06287e; } /* Function */
            code span.im { } /* Import */
            code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
            code span.kw { color: #007020; font-weight: bold; } /* Keyword */
            code span.op { color: #666666; } /* Operator */
            code span.ot { color: #007020; } /* Other */
            code span.pp { color: #bc7a00; } /* Preprocessor */
            code span.sc { color: #4070a0; } /* SpecialChar */
            code span.ss { color: #bb6688; } /* SpecialString */
            code span.st { color: #4070a0; } /* String */
            code span.va { color: #19177c; } /* Variable */
            code span.vs { color: #4070a0; } /* VerbatimString */
            code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
        
  </style>


</head>

<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
        <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      
      <p data-config-presenter><!-- populated from slide_config.json --></p>
            <p style="margin-top: 6px; margin-left: -2px;">February 24, 2022</p>
          </hgroup>
  </slide>

<slide class="segue dark nobackground level1"><hgroup class = 'auto-fadein'><h2>Work with models; Draw maps</h2></hgroup><article  id="work-with-models-draw-maps">

</article></slide><slide class=""><hgroup><h2>R packages</h2></hgroup><article  id="r-packages">

<pre class = 'prettyprint lang-r'>library(tidyverse)
library(socviz)
library(gapminder)
library(skimr)
library(ggrepel)
library(ggthemes)
library(broom)
theme_set(theme_minimal())</pre>

</article></slide><slide class=""><hgroup><h2>Work with models</h2></hgroup><article  id="work-with-models" class="build faster">

<ul>
<li>Let us consider the linear regression of <code>lifeExp</code> on <code>gdpPercap</code>, <code>pop</code>, and <code>continent</code>.</li>
</ul>

<pre class = 'prettyprint lang-r'>out &lt;- lm(formula = lifeExp ~ log(gdpPercap) + pop + continent,
          data = gapminder)

summary(out)</pre>

<pre >## 
## Call:
## lm(formula = lifeExp ~ log(gdpPercap) + pop + continent, data = gapminder)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -26.7090  -3.4832   0.4396   4.4062  18.6914 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       1.476e+00  1.352e+00   1.091    0.275    
## log(gdpPercap)    6.524e+00  1.824e-01  35.778  &lt; 2e-16 ***
## pop               9.990e-09  1.650e-09   6.056 1.72e-09 ***
## continentAmericas 6.729e+00  5.507e-01  12.218  &lt; 2e-16 ***
## continentAsia     5.157e+00  4.880e-01  10.567  &lt; 2e-16 ***
## continentEurope   9.290e+00  5.997e-01  15.491  &lt; 2e-16 ***
## continentOceania  8.965e+00  1.521e+00   5.896 4.49e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.965 on 1697 degrees of freedom
## Multiple R-squared:  0.7102, Adjusted R-squared:  0.7092 
## F-statistic: 693.3 on 6 and 1697 DF,  p-value: &lt; 2.2e-16</pre>

<pre class = 'prettyprint lang-r'>str(out)</pre>

<pre >## List of 13
##  $ coefficients : Named num [1:7] 1.48 6.52 9.99e-09 6.73 5.16 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:7] &quot;(Intercept)&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continentAmericas&quot; ...
##  $ residuals    : Named num [1:1704] -21.4 -20.2 -18.8 -16.6 -13.8 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:1704] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ effects      : Named num [1:1704] -2455.1 430.5 58.4 26.9 -24 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:1704] &quot;(Intercept)&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continentAmericas&quot; ...
##  $ rank         : int 7
##  $ fitted.values: Named num [1:1704] 50.2 50.5 50.8 50.6 49.9 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:1704] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ assign       : int [1:7] 0 1 2 3 3 3 3
##  $ qr           :List of 5
##   ..$ qr   : num [1:1704, 1:7] -41.2795 0.0242 0.0242 0.0242 0.0242 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:1704] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:7] &quot;(Intercept)&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continentAmericas&quot; ...
##   .. ..- attr(*, &quot;assign&quot;)= int [1:7] 0 1 2 3 3 3 3
##   .. ..- attr(*, &quot;contrasts&quot;)=List of 1
##   .. .. ..$ continent: chr &quot;contr.treatment&quot;
##   ..$ qraux: num [1:7] 1.02 1.03 1.01 1.01 1.04 ...
##   ..$ pivot: int [1:7] 1 2 3 4 5 6 7
##   ..$ tol  : num 1e-07
##   ..$ rank : int 7
##   ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot;
##  $ df.residual  : int 1697
##  $ contrasts    :List of 1
##   ..$ continent: chr &quot;contr.treatment&quot;
##  $ xlevels      :List of 1
##   ..$ continent: chr [1:5] &quot;Africa&quot; &quot;Americas&quot; &quot;Asia&quot; &quot;Europe&quot; ...
##  $ call         : language lm(formula = lifeExp ~ log(gdpPercap) + pop + continent, data = gapminder)
##  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language lifeExp ~ log(gdpPercap) + pop + continent
##   .. ..- attr(*, &quot;variables&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. .. ..$ : chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. ..- attr(*, &quot;order&quot;)= int [1:3] 1 1 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:4] &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;factor&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##  $ model        :&#39;data.frame&#39;:   1704 obs. of  4 variables:
##   ..$ lifeExp       : num [1:1704] 28.8 30.3 32 34 36.1 ...
##   ..$ log(gdpPercap): num [1:1704] 6.66 6.71 6.75 6.73 6.61 ...
##   ..$ pop           : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
##   ..$ continent     : Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##   ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39;  language lifeExp ~ log(gdpPercap) + pop + continent
##   .. .. ..- attr(*, &quot;variables&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. .. ..- attr(*, &quot;factors&quot;)= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. .. .. ..$ : chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. ..- attr(*, &quot;term.labels&quot;)= chr [1:3] &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##   .. .. ..- attr(*, &quot;order&quot;)= int [1:3] 1 1 1
##   .. .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. .. ..- attr(*, &quot;response&quot;)= int 1
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. .. ..- attr(*, &quot;predvars&quot;)= language list(lifeExp, log(gdpPercap), pop, continent)
##   .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:4] &quot;numeric&quot; &quot;numeric&quot; &quot;numeric&quot; &quot;factor&quot;
##   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:4] &quot;lifeExp&quot; &quot;log(gdpPercap)&quot; &quot;pop&quot; &quot;continent&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;lm&quot;</pre>

<pre class = 'prettyprint lang-r'>out$coefficients</pre>

<pre >##       (Intercept)    log(gdpPercap)               pop continentAmericas 
##      1.475537e+00      6.524395e+00      9.989516e-09      6.728930e+00 
##     continentAsia   continentEurope  continentOceania 
##      5.156852e+00      9.289969e+00      8.964746e+00</pre>

<pre class = 'prettyprint lang-r'>out$residuals</pre>

<pre >##             1             2             3             4             5 
## -21.358776522 -20.173636769 -18.770295450 -16.629416870 -13.779275274 
##             6             7             8             9            10 
## -11.841837129 -11.830933236  -9.975874265  -7.373109055  -7.200935046 
##            11            12            13            14            15 
##  -7.742179907  -8.023885623  -3.688038444  -0.900495634   3.497618299 
##            16            17            18            19            20 
##   3.741518341   4.016852978   4.835750237   6.144751966   7.530475174 
##            21            22            23            24            25 
##   9.741786737   9.506646021   9.818956179   8.931291484  -9.403949398 
##            26            27            28            29            30 
##  -8.160166825  -4.460887666  -2.948901112  -1.509986087   0.915537292 
##            31            32            33            34            35 
##   3.216434633   7.688117000  10.405997529  12.086531540  13.270956705 
##            36            37            38            39            40 
##  13.494932164 -24.783565203 -23.348897821 -22.062467331 -21.761293366 
##            41            42            43            44            45 
## -19.766033302 -14.309582836 -13.289111993 -12.510633268 -12.288367304 
##            46            47            48            49            50 
## -11.049167096 -12.305108738 -14.168040900  -2.559963416  -1.631375616 
##            51            52            53            54            55 
##  -1.162844056  -1.478633817  -1.105008003  -0.136278066   2.041466731 
##            56            57            58            59            60 
##   2.748696044   3.699977786   4.014573353   6.496510315   5.020944459 
##            61            62            63            64            65 
##  -1.524785535  -0.891114175  -1.016606039  -1.986751804  -2.114211972 
##            66            67            68            69            70 
##  -1.137752191  -0.293350362   0.514243819   1.299559381   1.632492122 
##            71            72            73            74            75 
##   2.326890607   2.431282317  -0.941161696  -2.644461597  -1.860915191 
##            76            77            78            79            80 
##  -2.419324082  -3.633622481  -3.203116281  -2.776681103  -1.619597373 
##            81            82            83            84            85 
##  -1.386984421  -0.396157233   0.367747714   0.509480124 -15.699190299 
##            86            87            88            89            90 
## -13.882127873 -11.389757115  -9.363204443  -7.358205764  -5.437721406 
##            91            92            93            94            95 
##  -1.935877521  -0.001010268   1.671508539   2.577794035   2.516442372 
##            96            97            98            99           100 
##   1.780360253 -12.210070600 -10.171609172  -8.597458897  -6.743321930 
##           101           102           103           104           105 
##  -4.144081231  -2.869552171  -0.076844295   1.940887463   4.335414681 
##           106           107           108           109           110 
##   6.658949713   8.122352138   8.703390831  -1.762725876  -1.518529092 
##           111           112           113           114           115 
##  -1.316116119  -1.799012752  -2.849366120  -2.383614342  -1.860292523 
##           116           117           118           119           120 
##  -0.904241090  -0.624505680  -0.043882810   0.086979430   0.554642750 
##           121           122           123           124           125 
##  -8.735913316  -5.936641942  -3.609858379  -1.913396235  -0.095096201 
##           126           127           128           129           130 
##   2.426351418   2.723273598   4.421521897   6.183216516   6.805536606 
##           131           132           133           134           135 
##   5.723710685   7.717945957 -19.313539364 -16.341621775 -14.968825320 
##           136           137           138           139           140 
## -14.482897668 -13.729865638 -11.563704142  -6.970331158  -2.692725761 
##           141           142           143           144           145 
##  -0.469201517   0.858652753   2.515451621   3.441541421  -1.867304907 
##           146           147           148           149           150 
##   0.607590193   2.563027100   3.858062114   4.721057072   5.758354491 
##           151           152           153           154           155 
##   5.565836983   5.724263500  10.201851434   7.185159288   6.503211480 
##           156           157           158           159           160 
##   5.872955896   2.123938574   3.625358657   5.077945970   5.478983414 
##           161           162           163           164           165 
##   4.143173304   5.147654070   5.042919611   5.155770184   2.657560895 
##           166           167           168           169           170 
##  -8.078423698 -15.573701245 -12.348044240  -7.790244734  -6.588402292 
##           171           172           173           174           175 
##  -6.229544327  -4.562417567  -5.258671021  -5.297480250  -3.950231935 
##           176           177           178           179           180 
##  -2.904119978  -0.423897043   0.898170398   2.262113161   2.835406426 
##           181           182           183           184           185 
##  -2.138302801   3.512526887   4.148597331   3.289393211   2.670387090 
##           186           187           188           189           190 
##   1.644751676   1.409319533   1.656107716   3.257886167   2.747126021 
##           191           192           193           194           195 
##   2.914035096   1.644733577 -10.633084515  -8.536944729  -6.659038828 
##           196           197           198           199           200 
##  -4.400480866  -1.983656439   1.468439125   2.908693886   3.537297934 
##           201           202           203           204           205 
##   4.088044019   4.036272046   3.742053349   4.325932153  -0.485796551 
##           206           207           208           209           210 
##   0.282271660   2.224125108   2.740192019   2.485769212   3.155758434 
##           211           212           213           214           215 
##   4.668372180   4.715115179   1.130428935   3.742733066   6.007535271 
##           216           217           218           219           220 
##   8.457043607  -5.817259673  -4.943076170  -3.784321370  -2.132289507 
##           221           222           223           224           225 
##  -5.824003920 -16.346640447   2.255005577   4.608001079   6.494445954 
##           226           227           228           229           230 
##   6.730091321   5.636385495   4.365820507  -9.110712560  -7.946930965 
##           231           232           233           234           235 
##  -6.152784619  -4.490828679  -2.966496738  -1.043600204   0.699847010 
##           236           237           238           239           240 
##   2.092029205   3.834873667   2.072469867  -1.151060736  -0.949502146 
##           241           242           243           244           245 
##  -0.530124840   0.043082624   0.874130001   0.528009924   0.183428622 
##           246           247           248           249           250 
##   0.504815938   1.806424806   1.908929750   3.049084346   3.074449290 
##           251           252           253           254           255 
##   3.300607477   3.608164083 -11.543783357 -10.233936812  -8.236423182 
##           256           257           258           259           260 
##  -5.916051559  -3.548226021  -0.468320929   2.014239019   5.011953358 
##           261           262           263           264           265 
##   4.714119276   1.444678592  -1.300815231   0.424144830  -9.551758549 
##           266           267           268           269           270 
##  -8.446645830  -7.007583683  -4.150557779  -1.660548549  -0.025661475 
##           271           272           273           274           275 
##   4.396798495   4.769898012   4.747068229   4.920708447   2.945434035 
##           276           277           278           279           280 
##   0.526652544  -7.538189342  -6.810042831  -5.269740293  -3.477202795 
##           281           282           283           284           285 
##  -1.044821399   3.497487848   6.552597137   7.916064666   7.487908172 
##           286           287           288           289           290 
##   7.297217124   8.919532100   8.296612224  -7.287186763  -3.920436050 
##           291           292           293           294           295 
##  -9.165452056   2.338326955   5.352329754   4.795015591   4.081267384 
##           296           297           298           299           300 
##   2.647485915   2.061113364   1.033216345   0.113942892  -2.360357881 
##           301           302           303           304           305 
##  -7.730100418  -3.801508696  -1.538561299   0.063411213   0.405042256 
##           306           307           308           309           310 
##   1.575769243   3.439276747   3.812208612   3.749484365   4.846892515 
##           311           312           313           314           315 
##   6.580520750   6.471780795  -6.470555912  -5.336041053  -4.305563121 
##           316           317           318           319           320 
##  -4.179505493  -1.918445115   3.352640870   4.840530447   6.586108987 
##           321           322           323           324           325 
##   9.950284897  13.065764691  15.946629471  18.691445426  -5.925787862 
##           326           327           328           329           330 
##  -5.403008323  -3.882957036  -1.715710444  -0.133279792   2.485578215 
##           331           332           333           334           335 
##   3.509875075   3.099003410   3.686065508   3.160414080   7.147774433 
##           336           337           338           339           340 
##   7.634775756  -9.361813489  -6.977655487  -4.005610968  -0.943086544 
##           341           342           343           344           345 
##   0.733531475   1.356775799  -0.208644821   1.540005420   0.793306895 
##           346           347           348           349           350 
##  -1.754375158  -1.751456337   0.323514073  -2.378205497  -0.404521596 
##           351           352           353           354           355 
##   1.454878503   2.831406267   3.904297901   5.845402937   9.317649435 
##           356           357           358           359           360 
##  10.175870278  10.545618641  11.563755906  11.473735465  10.680124939 
##           361           362           363           364           365 
##  -8.239108247  -6.757736622  -5.224640280  -3.931852909  -2.456487118 
##           366           367           368           369           370 
##  -0.269345838   1.107442749   2.987751490   2.112312239  -2.484545474 
##           371           372           373           374           375 
##  -3.137330115  -1.233618668  -2.085287171  -0.678634047   0.158677742 
##           376           377           378           379           380 
##  -0.034906783  -0.720083184  -1.061051212  -2.263648655  -1.494269722 
##           381           382           383           384           385 
##   2.725234546   2.859865108   2.989533143   2.368055562  -5.136713106 
##           386           387           388           389           390 
##  -2.804343148   1.167831920   3.590961757   6.473910806   7.189022798 
##           391           392           393           394           395 
##   7.361039317   7.623716062   9.801822170  11.726624218  11.722025154 
##           396           397           398           399           400 
##  10.587729048  -1.634995184  -0.672347778  -1.142199001  -1.430215511 
##           401           402           403           404           405 
##  -2.431895911  -2.806825964  -2.807798625  -2.572280817  -0.892704118 
##           406           407           408           409           410 
##  -0.036546464   0.863213913   0.139644005   0.083152079   0.227077912 
##           411           412           413           414           415 
##  -0.551967008  -0.986577668  -1.578871508  -0.877122449  -1.329558845 
##           416           417           418           419           420 
##  -2.117113131  -1.914475404  -1.925276661  -1.353810290  -0.805244514 
##           421           422           423           424           425 
## -18.139409798 -16.084479986 -14.065628004 -11.682977076 -10.706114052 
##           426           427           428           429           430 
##  -7.370959878  -4.635754219  -3.409242021  -0.593804070   2.437789677 
##           431           432           433           434           435 
##   2.608055852   3.455543719  -9.554908096  -6.310337903  -3.163962000 
##           436           437           438           439           440 
##   0.155199919   1.196835809   2.024938827   3.535521718   5.759888006 
##           441           442           443           444           445 
##   7.846938962   8.220945078   7.582138455   7.150830164 -13.166448479 
##           446           447           448           449           450 
## -10.634519932  -7.863860437  -6.576504159  -5.397651110  -4.426330779 
##           451           452           453           454           455 
##  -1.907130897   1.668198314   3.440404099   5.835251123   9.331966014 
##           456           457           458           459           460 
##   9.006519578  -7.155872291  -4.814515744  -3.270300522  -1.456608966 
##           461           462           463           464           465 
##  -0.355389171  -0.296646895   0.824730639   3.869921880   7.835076803 
##           466           467           468           469           470 
##  10.690624872  12.356909725  12.773687692 -15.303790570 -12.752489717 
##           471           472           473           474           475 
##  -9.663963855  -7.055572970  -4.946742976  -7.299584367  -5.917293184 
##           476           477           478           479           480 
##   0.562361164   3.740085016   5.504263352   6.453186162   7.147422719 
##           481           482           483           484           485 
##  -5.676490507  -4.997893843  -5.539826384  -6.984735322  -3.441808343 
##           486           487           488           489           490 
##  -4.246299272  -2.396558774  -0.664235850   0.187414057  -5.055155094 
##           491           492           493           494           495 
## -10.522101276 -11.266724978  -3.376500694  -1.553669701  -0.107284948 
##           496           497           498           499           500 
##   0.569169901   1.913040661   2.413153498   1.524776523   4.131670271 
##           501           502           503           504           505 
##   6.931832129   7.383481489  10.396203679  14.344331507  -6.047977522 
##           506           507           508           509           510 
##  -3.773635343  -1.068284975  -0.392415513   0.373779075   1.439979882 
##           511           512           513           514           515 
##   1.568945210   3.334796161   6.665124685   6.577808510   7.643321159 
##           516           517           518           519           520 
##   8.051575605  -1.461461734  -1.573036861  -1.728999885  -1.648609525 
##           521           522           523           524           525 
##  -2.394169455  -1.288317995  -0.381021176  -0.961027026   0.062097103 
##           526           527           528           529           530 
##   0.584879791   0.695575979   0.572828889  -1.572193360  -1.433517478 
##           531           532           533           534           535 
##  -1.173953458  -1.514302186  -2.104236374  -1.498667709  -1.128713625 
##           536           537           538           539           540 
##  -0.237004761   0.128975562   0.990557094   1.204041810   1.920188920 
##           541           542           543           544           545 
## -19.052338488 -18.019281379 -18.403025582 -15.804661214 -13.738804969 
##           546           547           548           549           550 
## -13.852805883  -7.705503544  -2.501627547  -2.179983350  -3.641420052 
##           551           552           553           554           555 
##  -6.286615564  -6.661552558 -11.829309396 -10.227831461  -9.315565042 
##           556           557           558           559           560 
##  -8.681163012  -6.417411889  -3.909662800   0.198570493   5.919329724 
##           561           562           563           564           565 
##   8.744918615  12.077457598  14.187177244  14.739748005  -1.854010177 
##           566           567           568           569           570 
##  -2.588260081  -2.956655138  -3.354112006  -4.484565261  -3.825774814 
##           571           572           573           574           575 
##  -2.993488526  -2.670166033  -1.952255342  -1.004920462  -0.185610557 
##           576           577           578           579           580 
##   0.101948439  -2.845198604  -2.107503209  -1.301101825   0.670220997 
##           581           582           583           584           585 
##   2.167043139   5.150628665   7.949172005  10.126365213  11.302149975 
##           586           587           588           589           590 
##  11.793412997  11.010706446  11.400165613   1.717837360   1.554226642 
##           591           592           593           594           595 
##   1.882362852   1.105814360  -0.178382153   0.443840513   1.523698236 
##           596           597           598           599           600 
##   2.597501001   2.402841941   2.806191099   1.997706170   1.909453397 
##           601           602           603           604           605 
## -17.070041375 -15.444804626 -12.962383448 -10.979248770  -8.682594212 
##           606           607           608           609           610 
##  -7.643468848  -5.462347809  -1.999451919   0.290018057   2.875575958 
##           611           612           613           614           615 
##   5.279839740   6.121038409  -8.571422857  -8.419054955  -8.367482327 
##           616           617           618           619           620 
##  -7.135987949  -5.790680495  -4.951132562  -2.695594807   0.361683655 
##           621           622           623           624           625 
##   3.463838148   5.742863526   7.408612662   9.748468290  -6.191811113 
##           626           627           628           629           630 
##  -7.582181659  -7.821733247  -8.875007050  -8.771722370  -7.336816498 
##           631           632           633           634           635 
##  -6.073574068  -3.312516487  -1.373092453  -0.200249040   2.548740974 
##           636           637           638           639           640 
##   3.391497190 -19.706024205 -16.176843883 -13.544728111  -9.507006031 
##           641           642           643           644           645 
##  -8.563179791  -7.498275779  -6.422989412  -3.612740899  -0.700146952 
##           646           647           648           649           650 
##   1.410651492   3.226297634   6.359237578 -16.505691943 -13.830760863 
##           651           652           653           654           655 
## -10.662364591  -8.451730865  -5.474673643  -3.497303687   0.171600518 
##           656           657           658           659           660 
##   3.957114522   5.731815541   6.819265922   7.843763070   8.586852130 
##           661           662           663           664           665 
##   1.952375304   4.611549779   5.828973971   6.359561850   6.437777545 
##           666           667           668           669           670 
##   6.098600439   6.221715543   4.885021214   4.903802167   6.405771863 
##           671           672           673           674           675 
##   7.490078898   6.414262919  -2.735276666  -1.256409843  -1.164640711 
##           676           677           678           679           680 
##  -1.004718047  -1.310357315  -2.023972948  -3.054185731  -3.088400422 
##           681           682           683           684           685 
##  -2.131210813  -0.951219982  -0.945309712  -1.457055446   3.713356716 
##           686           687           688           689           690 
##   3.123829847   2.596227520   1.000237500   0.616883599   0.841553266 
##           691           692           693           694           695 
##   0.619994633  -0.091633026   1.894190382   1.358020442   2.223745207 
##           696           697           698           699           700 
##   2.506577332 -14.103021450 -12.096226032  -9.904206609  -7.243098320 
##           701           702           703           704           705 
##  -4.607517580  -2.478665027  -1.161337726  -0.864982573  -1.182260562 
##           706           707           708           709           710 
##  -1.980040745  -2.792295139  -3.947950663 -13.173251294 -11.691231533 
##           711           712           713           714           715 
##  -9.106763207  -5.059904979  -4.397256233  -2.479291850   0.207469182 
##           716           717           718           719           720 
##   3.099675783   3.467553959   4.926713813   7.890662548   8.466697841 
##           721           722           723           724           725 
## -14.249010562 -12.488357288 -11.948159521 -11.085345028 -11.539152645 
##           726           727           728           729           730 
## -10.505406657  -5.751180360  -1.533906792   0.525428104   1.929467724 
##           731           732           733           734           735 
##   2.573506596   2.574340692 -15.688706059 -15.261609779 -14.156653329 
##           736           737           738           739           740 
## -11.613100398  -9.592152674  -8.938372593  -7.260152204  -2.838358355 
##           741           742           743           744           745 
##  -1.034813074  -0.429367109  -4.547873728  -2.202124303   0.276692990 
##           746           747           748           749           750 
##   1.797882227   2.084150650   1.936627804   0.705940324   0.429126989 
##           751           752           753           754           755 
##   0.690487123   1.331473670   0.901009128  -0.624313181  -1.112318913 
##           756           757           758           759           760 
##  -1.167525264   4.488141365   5.134341629   4.871997378   5.141217998 
##           761           762           763           764           765 
##   3.270837431   4.436923396   4.884032923   5.324858775   6.302797629 
##           766           767           768           769           770 
##   6.680965420   7.795330190   7.843117077  -0.781070383  -0.470817202 
##           771           772           773           774           775 
##  -0.865116535  -0.338123078  -0.544814212  -0.250906190   0.275770635 
##           776           777           778           779           780 
##   0.737407415   0.866529763   1.495526940   2.093726230   2.258663186 
##           781           782           783           784           785 
##  -1.700923832  -0.853633632   1.505879848   2.393659049   2.618397037 
##           786           787           788           789           790 
##   4.453643359   6.149921500   6.412047134   5.406062498   6.154774114 
##           791           792           793           794           795 
##   6.055976337   6.277524709   2.841667295   3.340643701   3.782510313 
##           796           797           798           799           800 
##   3.798588843   3.076474359   4.207425900   4.884113908   5.471323038 
##           801           802           803           804           805 
##   4.955807041   5.802269991   7.149363214   7.087016520 -11.395705096 
##           806           807           808           809           810 
## -10.179505342  -9.153652297  -6.665441810  -0.063765976   2.574826850 
##           811           812           813           814           815 
##   2.711397498   4.401155851   8.230312783   9.586424908  10.721925483 
##           816           817           818           819           820 
##  10.931868224  -3.305818711  -1.559964151   2.027287013   3.647679809 
##           821           822           823           824           825 
##   5.584227343   7.918519642  10.095688988  10.567343679  10.571753757 
##           826           827           828           829           830 
##   5.571719071   2.485195077   4.726237698  -2.285815280  -0.662037177 
##           831           832           833           834           835 
##   1.691270544   3.140065824   3.595090791   6.078749007   8.006184921 
##           836           837           838           839           840 
##   9.539051844   9.487912305  12.383604986  11.484341955  12.324763414 
##           841           842           843           844           845 
##  -4.654172654  -1.837418445   0.525147763   1.096668936   3.341400470 
##           846           847           848           849           850 
##   2.663456256   3.762154514   3.704917492   3.836127816   4.397608541 
##           851           852           853           854           855 
##   5.573957106   5.876533818 -26.709042579 -24.543919763 -20.977570167 
##           856           857           858           859           860 
## -15.745706767 -14.626719376  -9.002461037  -2.886050908   0.685635771 
##           861           862           863           864           865 
##   0.290542253   0.320494550   1.964605599   0.699297011  -6.069099776 
##           866           867           868           869           870 
##  -4.015827320  -0.998295804   0.449105499   0.558746978   0.282482619 
##           871           872           873           874           875 
##   1.983717767   5.218830557   4.965210654   4.373955704   4.730681477 
##           876           877           878           879           880 
##   4.935456298   3.466394574   5.610263311   6.982164426   6.477735010 
##           881           882           883           884           885 
##   7.778508277   7.568394556   9.997671457  12.291062775  13.271093223 
##           886           887           888           889           890 
##   7.879945123  -3.557928469  -6.912782958  -4.469079479  -3.959515233 
##           891           892           893           894           895 
##  -3.082377221  -2.819730716  -2.513860020   0.110987890   1.930348220 
##           896           897           898           899           900 
##   3.902940119  -2.815298904  -1.111619454   1.304395974   4.847436833 
##           901           902           903           904           905 
##  -9.509612724  -9.343861564 -11.216266375 -15.467212753 -13.660514927 
##           906           907           908           909           910 
##  -9.282347394  -3.046197388   3.565005757   7.383081644  10.297070972 
##           911           912           913           914           915 
##  11.426820091  11.103532932 -12.303747156 -10.753535060  -8.994489091 
##           916           917           918           919           920 
##  -6.930609065  -5.410005720  -2.578458060   0.606721011   1.757299872 
##           921           922           923           924           925 
##   5.287431037   8.382065732  11.303384477  12.421315298  -3.815974569 
##           926           927           928           929           930 
##  -3.653085598  -2.632389999  -2.517733175  -1.323492306  -0.154577300 
##           931           932           933           934           935 
##   2.018107365   3.791985422   6.521290173   3.245930600   1.004014090 
##           936           937           938           939           940 
##   3.421525630  -7.252559879  -3.547964374  -0.694879335   2.197462062 
##           941           942           943           944           945 
##   4.363342138   4.668529003   5.758573013   6.816850636   5.858776970 
##           946           947           948           949           950 
##   4.923021761   5.959664179   5.838165231  -7.721818121  -6.630745699 
##           951           952           953           954           955 
##  -5.082837298  -4.149540117  -3.087046414  -2.440168922   0.441456264 
##           956           957           958           959           960 
##   2.219590831   3.732689530   4.800602968   5.492831253   7.530280616 
##           961           962           963           964           965 
##  -4.074561719  -3.127032355  -2.662776562  -2.560837038  -1.133427546 
##           966           967           968           969           970 
##   1.658489868   4.475428768   7.286958315   9.754646965  11.289469201 
##           971           972           973           974           975 
##  12.693909665  13.740507177   0.019394202   6.905976957   7.640872065 
##           976           977           978           979           980 
##   9.090962332  10.218712030   9.821000114  11.641676739  11.973201175 
##           981           982           983           984           985 
##  11.436402301  11.098982319  11.046192544  10.624787067 -10.918133620 
##           986           987           988           989           990 
##  -7.689023739  -5.315631782  -5.060682902  -3.987426001  -2.174771679 
##           991           992           993           994           995 
##  -1.348256060   1.318738877   2.632099489   4.569307403   5.114651005 
##           996           997           998           999          1000 
##   5.635431572  -7.898950397  -5.865867061  -3.818094145  -1.789404887 
##  [ reached getOption(&quot;max.print&quot;) -- omitted 704 entries ]</pre>

<pre class = 'prettyprint lang-r'>out$fitted.values</pre>

<pre >##        1        2        3        4        5        6        7        8 
## 50.15978 50.50564 50.76730 50.64942 49.86728 50.27984 51.68493 50.79787 
##        9       10       11       12       13       14       15       16 
## 49.04711 48.96394 49.87118 51.85189 58.91804 60.18050 61.32238 62.47848 
##       17       18       19       20       21       22       23       24 
## 63.67315 64.09425 64.27525 64.46952 61.83921 63.44335 65.83204 67.49171 
##       25       26       27       28       29       30       31       32 
## 52.48095 53.84517 52.76389 54.35590 56.02799 57.09846 58.15157 58.11088 
##       33       34       35       36       37       38       39       40 
## 57.33800 57.06547 57.72304 58.80607 54.79857 55.34790 56.06247 57.74629 
##       41       42       43       44       45       46       47       48 
## 57.69403 53.79258 53.23111 52.41663 52.93537 52.01217 53.30811 56.89904 
##       49       50       51       52       53       54       55       56 
## 65.04496 66.03038 66.30484 67.11263 68.17001 68.61728 67.90053 68.02530 
##       57       58       59       60       61       62       63       64 
## 68.16802 69.26043 67.84349 70.29906 70.64479 71.22111 71.94661 73.08675 
##       65       66       67       68       69       70       71       72 
## 74.04421 74.62775 75.03335 75.80576 76.26044 77.19751 78.04311 78.80372 
##       73       74       75       76       77       78       79       80 
## 67.74116 70.12446 71.40092 72.55932 74.26362 75.37312 75.95668 76.55960 
##       81       82       83       84       85       86       87       88 
## 77.42698 77.90616 78.61225 79.31952 66.63819 67.71413 68.31276 69.28620 
##       89       90       91       92       93       94       95       96 
## 70.65821 71.03072 70.98788 70.75101 70.92949 71.34721 72.27856 73.85464 
##       97       98       99      100      101      102      103      104 
## 49.69407 49.51961 49.81346 50.19632 49.39608 49.79255 50.08584 50.87811 
##      105      106      107      108      109      110      111      112 
## 51.68259 52.75305 53.89065 55.35861 69.76273 70.75853 71.56612 72.73901 
##      113      114      115      116      117      118      119      120 
## 74.28937 75.18361 75.79029 76.25424 77.08451 77.57388 78.23302 78.88636 
##      121      122      123      124      125      126      127      128 
## 46.95891 46.29464 46.22786 46.79840 47.10910 46.76365 48.18073 47.91548 
##      129      130      131      132      133      134      135      136 
## 47.73578 47.97146 48.68229 49.01005 59.72754 58.23162 58.39683 59.51490 
##      137      138      139      140      141      142      143      144 
## 60.44387 61.58670 60.82933 59.94373 60.42620 61.19135 61.36755 62.11246 
##      145      146      147      148      149      150      151      152 
## 55.68730 57.84241 59.36697 60.93194 62.72894 64.10165 65.12416 65.41574 
##      153      154      155      156      157      158      159      160 
## 61.97615 66.05884 67.58679 68.97904 45.49806 45.99264 46.44205 47.81902 
##      161      162      163      164      165      166      167      168 
## 51.88083 54.17135 56.44108 58.46623 60.08744 60.63442 62.20770 63.07604 
##      169      170      171      172      173      174      175      176 
## 58.70724 59.87340 61.89454 62.19442 64.76267 66.78648 67.28623 68.10912 
##      177      178      179      180      181      182      183      184 
## 67.48090 68.48983 68.74389 69.55459 61.73830 63.09747 65.36140 67.13061 
##      185      186      187      188      189      190      191      192 
## 68.22961 69.16525 69.67068 69.68389 67.93211 67.57287 69.22596 71.36027 
##      193      194      195      196      197      198      199      200 
## 42.60808 43.44294 44.47304 45.09748 45.57466 44.66856 45.21331 46.01970 
##      201      202      203      204      205      206      207      208 
## 46.17196 46.28773 46.90795 47.96907 39.51680 40.25073 39.82087 40.80781 
##      209      210      211      212      213      214      215      216 
## 41.57123 42.75424 42.80263 43.49588 43.60557 41.58327 41.35246 41.12296 
##      217      218      219      220      221      222      223      224 
## 45.23426 46.30908 47.19932 47.54729 46.14100 47.56664 48.70199 49.30600 
##      225      226      227      228      229      230      231      232 
## 49.30855 49.80391 51.11561 55.35718 47.63371 48.37493 48.79578 49.28983 
##      233      234      235      236      237      238      239      240 
## 50.01550 50.39860 52.26115 52.89297 50.47913 50.12653 51.00706 51.37950 
##      241      242      243      244      245      246      247      248 
## 69.28012 69.91692 70.42587 71.60199 72.69657 73.70518 73.95358 74.95107 
##      249      250      251      252      253      254      255      256 
## 74.90092 75.53555 76.46939 77.04484 47.00678 47.69794 47.71142 47.39405 
##      257      258      259      260      261      262      263      264 
## 47.00523 47.24332 46.28076 45.47305 44.68188 44.62132 44.60882 44.31686 
##      265      266      267      268      269      270      271      272 
## 47.64376 48.32765 48.72358 47.75156 47.22955 47.40866 45.12020 46.28110 
##      273      274      275      276      277      278      279      280 
## 46.97693 46.65229 47.57957 50.12435 62.28319 62.88404 63.19374 64.00020 
##      281      282      283      284      285      286      287      288 
## 64.48582 63.55451 64.01240 64.57594 66.63809 68.51878 68.94047 70.25639 
##      289      290      291      292      293      294      295      296 
## 51.28719 54.46940 53.66681 56.04279 57.76655 59.17234 61.44373 64.62651 
##      297      298      299      300      301      302      303      304 
## 66.62889 69.39278 71.91406 75.32136 58.37310 58.91951 59.40156 59.89959 
##      305      306      307      308      309      310      311      312 
## 61.21796 62.26123 63.21372 63.95579 64.67152 65.46611 65.10148 66.41722 
##      313      314      315      316      317      318      319      320 
## 47.18556 47.79604 48.77256 50.65151 50.86245 47.58636 48.09247 48.33989 
##      321      322      323      324      325      326      327      328 
## 47.98872 47.59424 47.02737 46.46055 45.06879 46.05501 46.00496 45.77171 
##      329      330      331      332      333      334      335      336 
## 46.12228 45.31842 44.27412 44.31300 41.86193 39.42659 37.81823 38.82722 
##      337      338      339      340      341      342      343      344 
## 51.47281 52.03066 52.44061 52.98309 54.17347 54.26822 56.90364 55.92999 
##      345      346      347      348      349      350      351      352 
## 55.63969 54.71638 54.72146 54.99849 59.58421 60.43052 61.38712 62.59259 
##      353      354      355      356      357      358      359      360 
## 63.94470 64.90460 64.13235 64.57613 65.16738 65.69624 66.64926 68.10188 
##      361      362      363      364      365      366      367      368 
## 48.71611 49.22674 50.15464 51.28185 52.25749 52.64335 52.87556 51.66725 
##      369      370      371      372      373      374      375      376 
## 49.93169 50.47555 49.96933 49.56162 63.29529 65.44863 66.97132 68.53491 
##      377      378      379      380      381      382      383      384 
## 70.33008 71.70105 72.72365 73.01427 69.80177 70.82013 71.88647 73.37994 
##      385      386      387      388      389      390      391      392 
## 64.55771 65.12934 64.07817 64.69904 64.24909 65.45998 66.35596 66.55028 
##      393      394      395      396      397      398      399      400 
## 64.61218 64.42438 65.43597 67.68527 68.50500 69.70235 71.04220 71.81022 
##      401      402      403      404      405      406      407      408 
## 72.72190 73.51683 73.76780 74.15228 73.29270 74.04655 74.64679 76.34636 
##      409      410      411      412      413      414      415      416 
## 70.69685 71.58292 72.90197 73.94658 75.04887 75.56712 75.95956 76.91711 
##      417      418      419      420      421      422      423      424 
## 77.24448 78.03528 78.53381 79.13724 52.95141 53.41248 53.75863 53.75698 
##      425      426      427      428      429      430      431      432 
## 55.07211 53.88996 53.44775 53.44924 52.19780 50.71921 50.76494 51.33546 
##      433      434      435      436      437      438      439      440 
## 55.48291 56.13834 56.62296 56.59580 58.43416 59.76306 60.19148 60.28611 
##      441      442      443      444      445      446      447      448 
## 60.61006 61.73605 63.26486 65.08417 61.52345 61.99052 62.50386 63.25450 
##      449      450      451      452      453      454      455      456 
## 64.19365 65.73633 66.24913 65.56280 66.17260 66.47675 64.84103 65.98748 
##      457      458      459      460      461      462      463      464 
## 49.04887 49.25852 50.26230 50.74961 51.49239 53.61565 55.18127 55.92708 
##      465      466      467      468      469      470      471      472 
## 55.83892 56.52638 57.44909 58.56431 60.56579 61.32249 61.97096 62.91057 
##      473      474      475      476      477      478      479      480 
## 63.15374 63.99558 62.52129 62.59164 63.05791 64.03074 64.28081 64.73058 
##      481      482      483      484      485      486      487      488 
## 40.15849 40.98089 43.02483 45.97174 43.95781 46.27030 46.05856 46.32824 
##      489      490      491      492      493      494      495      496 
## 47.35759 53.30016 59.87010 62.84572 39.30450 39.60067 40.26528 41.61983 
##      497      498      499      500      501      502      503      504 
## 42.22896 42.12185 42.36522 42.32133 43.05917 45.99452 44.84380 43.69567 
##      505      506      507      508      509      510      511      512 
## 40.12598 40.44064 41.12728 42.50742 43.14122 43.07002 43.34705 43.34920 
##      513      514      515      516      517      518      519      520 
## 41.42588 42.82419 43.08168 44.89542 68.01146 69.06304 70.47900 71.47861 
##      521      522      523      524      525      526      527      528 
## 73.26417 73.80832 74.93102 75.79103 75.63790 76.54512 77.67442 78.74017 
##      529      530      531      532      533      534      535      536 
## 68.98219 70.36352 71.68395 73.06430 74.48424 75.32867 76.01871 76.57700 
##      537      538      539      540      541      542      543      544 
## 77.33102 77.64944 78.38596 78.73681 56.05534 57.01828 58.89203 60.40266 
##      545      546      547      548      549      550      551      552 
## 62.42880 66.64281 64.26950 62.69163 63.54598 64.10242 63.04762 63.39655 
##      553      554      555      556      557      558      559      560 
## 41.82931 42.29283 43.21157 44.53816 44.72541 45.75166 45.38143 43.34567 
##      561      562      563      564      565      566      567      568 
## 43.89908 43.78354 43.85382 44.70825 69.35401 71.68826 73.25666 74.15411 
##      569      570      571      572      573      574      575      576 
## 75.48457 76.32577 76.79349 77.51717 78.02226 78.34492 78.85561 79.30405 
##      577      578      579      580      581      582      583      584 
## 45.99420 46.88650 47.75310 47.40178 47.70796 46.60537 45.79483 45.60263 
##      585      586      587      588      589      590      591      592 
## 46.19885 46.76259 47.44229 48.62183 64.14216 66.30577 67.62764 69.89419 
##      593      594      595      596      597      598      599      600 
## 72.51838 73.23616 73.71630 74.07250 74.62716 75.06281 76.25829 77.57355 
##      601      602      603      604      605      606      607      608 
## 59.09304 59.58680 59.91638 60.99525 62.42059 63.67247 63.59935 62.78145 
##      609      610      611      612      613      614      615      616 
## 63.08298 63.44642 63.69816 64.13796 42.18042 42.97705 44.12048 44.33299 
##      617      618      619      620      621      622      623      624 
## 44.63268 45.71313 45.58659 45.19032 45.11216 45.71214 46.26739 46.25853 
##      625      626      627      628      629      630      631      632 
## 38.69181 41.07118 42.30973 44.36701 45.25772 44.80182 45.40057 44.55752 
##      633      634      635      636      637      638      639      640 
## 44.63909 45.07325 42.95526 42.99650 57.28502 56.87284 57.13473 55.75001 
##      641      642      643      644      645      646      647      648 
## 56.60518 57.42128 57.88399 57.24874 55.78915 55.26035 54.91070 54.55676 
##      649      650      651      652      653      654      655      656 
## 58.41769 58.49576 58.70336 59.37573 59.35867 60.89930 60.73740 60.53489 
##      657      658      659      660      661      662      663      664 
## 60.66718 60.83973 60.72124 61.61115 59.00762 60.13845 61.82103 63.64044 
##      665      666      667      668      669      670      671      672 
## 65.56222 67.50140 69.22828 71.31498 72.69720 73.59423 74.00492 75.79374 
##      673      674      675      676      677      678      679      680 
## 66.76528 67.66641 69.12464 70.50472 71.07036 71.97397 72.44419 72.66840 
##      681      682      683      684      685      686      687      688 
## 71.30121 71.99122 73.53531 74.79506 68.77664 70.34617 71.08377 72.72976 
##      689      690      691      692      693      694      695      696 
## 73.84312 75.26845 76.37001 77.32163 76.87581 77.59198 78.27625 79.25042 
##      697      698      699      700      701      702      703      704 
## 51.47602 52.34523 53.50921 54.43610 55.25852 56.68667 57.75734 59.41798 
##      705      706      707      708      709      710      711      712 
## 61.40526 63.74504 65.67130 68.64595 50.64125 51.60923 51.62476 51.02390 
##      713      714      715      716      717      718      719      720 
## 53.60026 55.18129 55.95153 57.03732 59.21345 61.11429 60.69734 62.18330 
##      721      722      723      724      725      726      727      728 
## 59.11801 59.66936 61.27316 63.55435 66.77315 68.20741 65.37118 64.57391 
##      729      730      731      732      733      734      735      736 
## 65.21657 66.11253 66.87749 68.38966 61.00871 63.69861 65.61365 66.07210 
##      737      738      739      740      741      742      743      744 
## 66.54215 69.35137 69.29815 67.88236 60.49581 59.24037 61.59387 61.74712 
##      745      746      747      748      749      750      751      752 
## 66.63331 67.10212 68.20585 69.14337 70.57406 71.60087 72.40951 73.02853 
##      753      754      755      756      757      758      759      760 
## 74.56599 76.74631 78.89532 80.05253 60.90186 62.70566 64.51800 65.60878 
##      761      762      763      764      765      766      767      768 
## 68.35916 68.62308 69.56597 70.27514 70.62720 71.58803 71.90067 72.90188 
##      769      770      771      772      773      774      775      776 
## 66.72107 68.28082 70.10512 71.39812 72.73481 73.73091 74.70423 75.68259 
##      777      778      779      780      781      782      783      784 
## 76.57347 77.32447 78.14627 78.28734 60.23092 63.46363 64.10412 65.11634 
##      785      786      787      788      789      790      791      792 
## 66.38160 65.65636 65.06008 65.35795 66.35994 66.10723 65.99102 66.28948 
##      793      794      795      796      797      798      799      800 
## 60.18833 62.15936 64.94749 67.63141 70.34353 71.17257 72.22589 73.19868 
##      801      802      803      804      805      806      807      808 
## 74.40419 74.88773 74.85064 75.51598 54.55371 55.84851 57.27965 58.29444 
##      809      810      811      812      813      814      815      816 
## 56.59177 58.55917 61.02760 61.46784 59.78469 60.18558 60.54107 61.60313 
##      817      818      819      820      821      822      823      824 
## 45.57582 46.24596 45.92171 47.00632 47.97477 48.23648 48.67031 48.77166 
##      825      826      827      828      829      830      831      832 
## 48.71325 48.83528 48.50680 49.38376 52.34182 54.74304 54.96473 56.80193 
##      833      834      835      836      837      838      839      840 
## 60.38791 61.08025 61.09382 61.10795 60.49009 55.34340 55.17766 54.97224 
##      841      842      843      844      845      846      847      848 
## 52.10717 54.51842 54.76685 56.61933 59.27060 62.10254 63.36085 66.10508 
##      849      850      851      852      853      854      855      856 
## 68.40787 70.24939 71.47104 72.74647 82.27404 82.57692 81.44757 80.36971 
##      857      858      859      860      861      862      863      864 
## 82.33872 78.34546 74.19505 73.48836 74.89946 75.83551 74.93939 76.88870 
##      865      866      867      868      869      870      871      872 
## 61.99710 63.50483 63.09230 63.42089 64.86225 65.81652 64.99928 62.70717 
##      873      874      875      876      877      878      879      880 
## 64.32679 65.89104 66.29732 67.05754 38.67161 39.43674 40.76484 42.01426 
##      881      882      883      884      885      886      887      888 
## 41.98849 44.63961 45.08033 44.88894 46.41391 47.67805 48.15093 49.50478 
##      889      890      891      892      893      894      895      896 
## 42.94908 43.44552 43.58438 44.35573 45.12786 43.65301 42.92165 42.12406 
##      897      898      899      900      901      902      903      904 
## 43.61730 43.33262 42.44860 40.83056 52.23261 54.63286 59.02427 65.69421 
##      905      906      907      908      909      910      911      912 
## 66.43351 66.72435 65.20120 62.66899 61.37192 61.25793 61.31018 62.84847 
##      913      914      915      916      917      918      919      920 
## 48.98475 49.61854 49.84249 49.81161 50.26101 49.45946 48.36228 47.59270 
##      921      922      923      924      925      926      927      928 
## 46.92657 46.59593 45.98262 47.02168 40.07197 40.86009 41.04239 42.00473 
##      929      930      931      932      933      934      935      936 
## 43.08949 43.92158 43.62389 43.66501 42.89871 44.24907 44.00499 44.88147 
##      937      938      939      940      941      942      943      944 
## 55.71556 55.64996 56.43188 57.17354 58.64666 60.58747 62.24143 62.68315 
##      945      946      947      948      949      950      951      952 
## 64.83422 67.01498 67.08434 68.40283 41.40682 41.93775 42.01884 42.63654 
##      953      954      955      956      957      958      959      960 
## 43.06405 44.15417 43.47454 44.14441 44.65531 45.10240 46.32517 46.93672 
##      961      962      963      964      965      966      967      968 
## 44.61756 45.46503 46.91078 48.84984 49.57043 49.19351 49.12357 48.85804 
##      969      970      971      972      973      974      975      976 
## 48.57835 49.14053 49.55309 50.42349 50.96661 51.18302 52.60513 52.46604 
##      977      978      979      980      981      982      983      984 
## 52.72529 55.10900 55.06932 56.76680 58.30860 59.63702 60.90781 62.17621 
##      985      986      987      988      989      990      991      992 
## 61.70713 62.87902 63.61463 65.17068 66.34843 67.20677 68.75326 68.17926 
##      993      994      995      996      997      998      999     1000 
## 68.82290 69.10069 69.78735 70.55957 50.14295 51.11387 52.06909 53.04240 
##  [ reached getOption(&quot;max.print&quot;) -- omitted 704 entries ]</pre>

</article></slide><slide class=""><hgroup><h2>Tidy model objects with <code>broom</code></h2></hgroup><article  id="tidy-model-objects-with-broom" class="build faster">

<ul>
<li><p>The <code>broom</code> package to help us do a lot of things with our model output.</p></li>
<li><p><code>broom</code> can tidily extract three kinds of information.</p>

<ul>
<li>We can see <em>component-level</em> information about aspects of the model itself, such as <strong>coefficients</strong> and <strong>t-statistics</strong>.</li>
<li>We can obtain <em>observation-level</em> information about the model’s connection to the underlying data, such as <strong>fitted values</strong> and <strong>residuals</strong>.</li>
<li>We can get <em>model-level</em> information that summarizes the fit as a whole, such as <strong>F-statistic</strong>, <strong>model deviance</strong>, or <strong>r-squared</strong>.</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>library(broom)</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy">

<ul>
<li>The <code>tidy()</code> function takes a model object and returns a data frame of component-level information.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_comp &lt;- tidy(out)
out_comp %&gt;% round_df()</pre>

<pre >## # A tibble: 7 × 5
##   term              estimate std.error statistic p.value
##   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)           1.48      1.35      1.09    0.28
## 2 log(gdpPercap)        6.52      0.18     35.8     0   
## 3 pop                   0         0         6.06    0   
## 4 continentAmericas     6.73      0.55     12.2     0   
## 5 continentAsia         5.16      0.49     10.6     0   
## 6 continentEurope       9.29      0.6      15.5     0   
## 7 continentOceania      8.96      1.52      5.9     0</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-1">

<ul>
<li>We can work with <code>tidy()</code> to make plots in a familiar way, and much more easily.</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(out_comp, mapping = aes(x = term,
                                    y = estimate))

p + geom_point() + coord_flip() </pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code>tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-2">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-6-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-3">

<ul>
<li>We can tell <code>tidy()</code> to calculate confidence intervals for the estimates, using R’s <code>conf.int = TRUE</code> option.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_conf &lt;- tidy(out, conf.int = TRUE)
out_conf %&gt;% round_df()</pre>

<pre >## # A tibble: 7 × 7
##   term              estimate std.error statistic p.value conf.low conf.high
##   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)           1.48      1.35      1.09    0.28    -1.18      4.13
## 2 log(gdpPercap)        6.52      0.18     35.8     0        6.17      6.88
## 3 pop                   0         0         6.06    0        0         0   
## 4 continentAmericas     6.73      0.55     12.2     0        5.65      7.81
## 5 continentAsia         5.16      0.49     10.6     0        4.2       6.11
## 6 continentEurope       9.29      0.6      15.5     0        8.11     10.5 
## 7 continentOceania      8.96      1.52      5.9     0        5.98     12.0</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code class="build faster">tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-4">

<ul>
<li>We can tell <code>tidy()</code> to calculate confidence intervals for the estimates, using R’s <code>conf.int = TRUE</code> option.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_conf &lt;- subset(out_conf, term != &quot;(Intercept)&quot;)
out_conf$nicelabs &lt;- prefix_strip(out_conf$term, &quot;continent&quot;)</pre>

<ul>
<li>The <code>socviz::prefix_strip()</code> strips a series of characters from the beginning of a character vector.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code>tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-5" class="build faster">

<ul>
<li>We can use <code>geom_pointrange()</code> to make a figure that displays some information about our confidence in the variable estimates</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(out_conf, mapping = aes(x = reorder(nicelabs, estimate),
                                    y = estimate, ymin = conf.low, ymax = conf.high))
p + geom_pointrange() + coord_flip() + labs(x=&quot;&quot;, y=&quot;OLS Estimate&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Get component-level statistics with <code>tidy()</code></h2></hgroup><article  id="get-component-level-statistics-with-tidy-6">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-10-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  id="get-observation-level-statistics-with-augment">

<ul>
<li><p>The values returned by <code>augment()</code> are all statistics calculated at the level of the original observations.</p></li>
<li><p>Working from a call to <code>augment()</code> will return a data frame with all the original observations used in the estimation of the model, together with columns like the following:</p>

<ul>
<li><code>.fitted</code> — The fitted values of the model.</li>
<li><code>.se.fit</code> — The standard errors of the fitted values.</li>
<li><code>.resid</code> — The residuals.</li>
<li><code>.hat</code> — The diagonal of the hat matrix.</li>
<li><code>.sigma</code> — An estimate of residual standard deviation when the corresponding observation is dropped from the model.</li>
<li><code>.cooksd</code> — Cook’s distance, a common regression diagnostic on how the observation is influential in the estimation;</li>
<li><code>.std.resid</code> — The standardized residuals.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  id="get-observation-level-statistics-with-augment-1" class="build faster">

<pre class = 'prettyprint lang-r'>out_aug &lt;- augment(out)
head(out_aug) </pre>

<pre >## # A tibble: 6 × 9
##   lifeExp `log(gdpPercap)`      pop continent .fitted    .hat .sigma .cooksd
##     &lt;dbl&gt;            &lt;dbl&gt;    &lt;int&gt; &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1    28.8             6.66  8425333 Asia         50.2 0.00427   6.95 0.00578
## 2    30.3             6.71  9240934 Asia         50.5 0.00416   6.95 0.00503
## 3    32.0             6.75 10267083 Asia         50.8 0.00408   6.95 0.00426
## 4    34.0             6.73 11537966 Asia         50.6 0.00410   6.96 0.00337
## 5    36.1             6.61 13079460 Asia         49.9 0.00433   6.96 0.00244
## 6    38.4             6.67 14880372 Asia         50.3 0.00419   6.96 0.00175
## # … with 1 more variable: .std.resid &lt;dbl&gt;</pre>

<pre class = 'prettyprint lang-r'>head(out_aug) %&gt;% round_df()</pre>

<pre >## # A tibble: 6 × 9
##   lifeExp `log(gdpPercap)`      pop continent .fitted  .hat .sigma .cooksd
##     &lt;dbl&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1    28.8             6.66  8425333 Asia         50.2     0   6.95    0.01
## 2    30.3             6.71  9240934 Asia         50.5     0   6.95    0.01
## 3    32               6.75 10267083 Asia         50.8     0   6.95    0   
## 4    34.0             6.73 11537966 Asia         50.6     0   6.96    0   
## 5    36.1             6.61 13079460 Asia         49.9     0   6.96    0   
## 6    38.4             6.67 14880372 Asia         50.3     0   6.96    0   
## # … with 1 more variable: .std.resid &lt;dbl&gt;</pre>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  id="get-observation-level-statistics-with-augment-2" class="build faster">

<ul>
<li>The new columns created by <code>augment()</code> can be used to create some standard regression plots.

<ul>
<li>We can draw the residual plot (the residuals versus the fitted values).</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = out_aug,
            mapping = aes(x = .fitted, y = lifeExp - .fitted))
p + geom_point()</pre>

</article></slide><slide class=""><hgroup><h2>Get observation-level statistics with <code>augment()</code></h2></hgroup><article  id="get-observation-level-statistics-with-augment-3" class="build faster">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-13-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Get model-level statistics with <code>glance()</code></h2></hgroup><article  id="get-model-level-statistics-with-glance" class="build faster">

<ul>
<li><code>glance()</code> returns the information typically presented at the bottom of a model’s <code>summary()</code> output.</li>
</ul>

<pre class = 'prettyprint lang-r'>glance(out) %&gt;% round_df()</pre>

<pre >## # A tibble: 1 × 12
##   r.squared adj.r.squared sigma statistic p.value    df logLik    AIC    BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1      0.71          0.71  6.97      693.       0     6 -5722. 11460. 11503.
## # … with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;dbl&gt;, nobs &lt;dbl&gt;</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns" class="build faster">

<ul>
<li>Consider the linear regression model for the relationship between life expectancy and GDP by continent, for each year in the data.</li>
</ul>

<pre class = 'prettyprint lang-r'>eu77 &lt;- gapminder %&gt;% filter(continent == &quot;Europe&quot;, year == 1977)
fit &lt;- lm(lifeExp ~ log(gdpPercap), data = eu77)
summary(fit)</pre>

<pre >## 
## Call:
## lm(formula = lifeExp ~ log(gdpPercap), data = eu77)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.4956 -1.0306  0.0935  1.1755  3.7125 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)      29.489      7.161   4.118 0.000306 ***
## log(gdpPercap)    4.488      0.756   5.936 2.17e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.114 on 28 degrees of freedom
## Multiple R-squared:  0.5572, Adjusted R-squared:  0.5414 
## F-statistic: 35.24 on 1 and 28 DF,  p-value: 2.173e-06</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns-1" class="build faster">

<ul>
<li>With <code>dplyr</code> and <code>broom</code> we can do the grouped analysis for every continent-year slice of the data in a compact and tidy way.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_le &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest()
out_le</pre>

<pre >## # A tibble: 60 × 3
## # Groups:   continent, year [60]
##    continent  year data             
##    &lt;fct&gt;     &lt;int&gt; &lt;list&gt;           
##  1 Asia       1952 &lt;tibble [33 × 4]&gt;
##  2 Asia       1957 &lt;tibble [33 × 4]&gt;
##  3 Asia       1962 &lt;tibble [33 × 4]&gt;
##  4 Asia       1967 &lt;tibble [33 × 4]&gt;
##  5 Asia       1972 &lt;tibble [33 × 4]&gt;
##  6 Asia       1977 &lt;tibble [33 × 4]&gt;
##  7 Asia       1982 &lt;tibble [33 × 4]&gt;
##  8 Asia       1987 &lt;tibble [33 × 4]&gt;
##  9 Asia       1992 &lt;tibble [33 × 4]&gt;
## 10 Asia       1997 &lt;tibble [33 × 4]&gt;
## # … with 50 more rows</pre>

<ul>
<li><code>nest()</code> creates a list-column of data frames.

<ul>
<li>The list column, <code>data</code>, contains a small table of data corresponding to each continent-year group.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns-2" class="build faster">

<ul>
<li>We can look at specific group, for example, &ldquo;Europe 1977&rdquo;, if we like, by filtering the data and then unnesting the list column.</li>
</ul>

<pre class = 'prettyprint lang-r'>out_le %&gt;% filter(continent == &quot;Europe&quot; &amp; year == 1977) %&gt;% 
  unnest()</pre>

<pre >## # A tibble: 30 × 6
## # Groups:   continent, year [1]
##    continent  year country                lifeExp      pop gdpPercap
##    &lt;fct&gt;     &lt;int&gt; &lt;fct&gt;                    &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Europe     1977 Albania                   68.9  2509048     3533.
##  2 Europe     1977 Austria                   72.2  7568430    19749.
##  3 Europe     1977 Belgium                   72.8  9821800    19118.
##  4 Europe     1977 Bosnia and Herzegovina    69.9  4086000     3528.
##  5 Europe     1977 Bulgaria                  70.8  8797022     7612.
##  6 Europe     1977 Croatia                   70.6  4318673    11305.
##  7 Europe     1977 Czech Republic            70.7 10161915    14800.
##  8 Europe     1977 Denmark                   74.7  5088419    20423.
##  9 Europe     1977 Finland                   72.5  4738902    15605.
## 10 Europe     1977 France                    73.8 53165019    18293.
## # … with 20 more rows</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns-3" class="build faster">

<ul>
<li>List columns are useful because we can act on them in a compact and tidy way.</li>
</ul>

<pre class = 'prettyprint lang-r'>fit_ols &lt;- function(df) {
    lm(lifeExp ~ log(gdpPercap), data = df)
}

out_le &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest() %&gt;% 
    mutate(model = map(data, fit_ols)) 

out_le</pre>

<pre >## # A tibble: 60 × 4
## # Groups:   continent, year [60]
##    continent  year data              model 
##    &lt;fct&gt;     &lt;int&gt; &lt;list&gt;            &lt;list&gt;
##  1 Asia       1952 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  2 Asia       1957 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  3 Asia       1962 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  4 Asia       1967 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  5 Asia       1972 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  6 Asia       1977 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  7 Asia       1982 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  8 Asia       1987 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
##  9 Asia       1992 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
## 10 Asia       1997 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
## # … with 50 more rows</pre>

<ul>
<li><code>map()</code> function applies a function to each element of a vector.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns-4" class="build faster">

<pre class = 'prettyprint lang-r'>fit_ols &lt;- function(df) {
    lm(lifeExp ~ log(gdpPercap), data = df)
}

out_tidy &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest() %&gt;% 
    mutate(model = map(data, fit_ols),
           tidied = map(model, tidy)) %&gt;%
    unnest(tidied) %&gt;%
    filter(term != &quot;(Intercept)&quot; &amp;
           continent != &quot;Oceania&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns-5" class="build faster">

<ul>
<li>We now have tidy regression output with an estimate of the association between log GDP per capita and life expectancy <em>for each year</em>, <em>within continents</em>.</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = out_tidy,
            mapping = aes(x = year, y = estimate,
                          ymin = estimate - 2*std.error,
                          ymax = estimate + 2*std.error,
                          group = continent, color = continent))

p + geom_pointrange(position = position_dodge(width = 1)) +
    scale_x_continuous(breaks = unique(gapminder$year)) + 
    theme(legend.position = &quot;top&quot;) +
    labs(x = &quot;Year&quot;, y = &quot;Estimate&quot;, color = &quot;Continent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Grouped analysis and list columns</h2></hgroup><article  id="grouped-analysis-and-list-columns-6">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-21-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data" class="build faster">

<ul>
<li>The <code>socviz::election</code> dataset has various measures of the vote and vote shares by state.</li>
</ul>

<pre class = 'prettyprint lang-r'>election %&gt;% select(state, total_vote,
                    r_points, pct_trump, party, census) %&gt;%
    sample_n(5)</pre>

<pre >## # A tibble: 5 × 6
##   state      total_vote r_points pct_trump party      census   
##   &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    
## 1 Oklahoma      1452992    36.4       65.3 Republican South    
## 2 New Mexico     798319    -8.22      40.0 Democratic West     
## 3 Missouri      2828266    18.5       56.4 Republican Midwest  
## 4 California   14237893   -30.0       31.5 Democratic West     
## 5 Vermont        315067   -26.4       30.3 Democratic Northeast</pre>

<ul>
<li>We don’t have to represent spatial data spatially.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-1" class="build faster">

<pre class = 'prettyprint lang-r'>party_colors &lt;- c(&quot;#2E74C0&quot;, &quot;#CB454A&quot;)  # Hex color codes for Dem Blue and Rep Red
p0 &lt;- ggplot(data = subset(election, st %nin% &quot;DC&quot;),
             mapping = aes(x = r_points,
                           y = reorder(state, r_points),
                           color = party))

p1 &lt;- p0 + geom_vline(xintercept = 0, color = &quot;gray30&quot;) +
    geom_point(size = 2)

p2 &lt;- p1 + scale_color_manual(values = party_colors)

p3 &lt;- p2 + scale_x_continuous(breaks = c(-30, -20, -10, 0, 10, 20, 30, 40),
                              labels = c(&quot;30\n (Clinton)&quot;, &quot;20&quot;, &quot;10&quot;, &quot;0&quot;,
                                         &quot;10&quot;, &quot;20&quot;, &quot;30&quot;, &quot;40\n(Trump)&quot;))

p3 + facet_wrap(~ census, ncol=1, scales=&quot;free_y&quot;) +
     guides(color = &quot;none&quot;) + labs(x = &quot;Point Margin&quot;, y = &quot;&quot;) +
     theme(axis.text=element_text(size=8))</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-2">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-24-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-3" class="build faster">

<ul>
<li>Let us get a data frame of the US state map</li>
</ul>

<pre class = 'prettyprint lang-r'>us_states &lt;- map_data(&quot;state&quot;)
head(us_states)</pre>

<pre >##        long      lat group order  region subregion
## 1 -87.46201 30.38968     1     1 alabama      &lt;NA&gt;
## 2 -87.48493 30.37249     1     2 alabama      &lt;NA&gt;
## 3 -87.52503 30.37249     1     3 alabama      &lt;NA&gt;
## 4 -87.53076 30.33239     1     4 alabama      &lt;NA&gt;
## 5 -87.57087 30.32665     1     5 alabama      &lt;NA&gt;
## 6 -87.58806 30.32665     1     6 alabama      &lt;NA&gt;</pre>

<pre class = 'prettyprint lang-r'>dim(us_states)</pre>

<pre >## [1] 15537     6</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-4" class="build faster">

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = us_states,
            mapping = aes(x = long, y = lat,
                          group = group))

p + geom_polygon(fill = &quot;white&quot;, color = &quot;black&quot;)</pre>

<ul>
<li>A map is a set of lines drawn in the right order on a grid.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-5">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-27-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-6" class="build faster">

<ul>
<li>Let’s <code>fill</code> the map.</li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = us_states,
            aes(x = long, y = lat,
                group = group, fill = region))

p + geom_polygon(color = &quot;gray90&quot;, size = 0.1) + guides(fill = FALSE)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-7">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-29-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-8" class="build faster">

<ul>
<li>Let’s deal with the projection.

<ul>
<li>By default, the map is plotted using the venerable <em>Mercator</em> projection.</li>
<li>The <em>Albers</em> projection is nicer.</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>p &lt;- ggplot(data = us_states,
            mapping = aes(x = long, y = lat,
                          group = group, fill = region))

p + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) +
    guides(fill = FALSE)</pre>

<ul>
<li><p>We can transform the default projection used by <code>geom_polygon()</code>, via the <code>coord_map()</code> function.</p>

<ul>
<li>The <em>Albers</em> projection requires two latitude parameters, <code>lat0</code> and <code>lat1</code>.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-9">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-31-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-10" class="build faster">

<ul>
<li>Let’s get the <code>election</code> data on to the map</li>
</ul>

<pre class = 'prettyprint lang-r'>election$region &lt;- tolower(election$state)
us_states_elec &lt;- left_join(us_states, election)</pre>

<ul>
<li><p>In the map data, <code>us_states</code>, the state names (in a variable named <code>region</code>) are in lower case.</p></li>
<li><p>Here we can create a variable in the <code>election</code> data frame to correspond to this, using the <code>tolower()</code> function to convert the state names.</p></li>
<li><p>It is important to know your data and variables well enough to check that they have merged properly.</p>

<ul>
<li>FIPS code is useful in joining the data.</li>
</ul></li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-11" class="build faster">

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = us_states_elec,
            aes(x = long, y = lat,
                group = group, fill = party))

p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) </pre>

<ul>
<li>We use our <code>party</code> colors for the <code>fill</code>.</li>
</ul>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-12">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-34-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-13" class="build faster">

<pre class = 'prettyprint lang-r'>p1 &lt;- p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) 

p2 &lt;- p1 + scale_fill_manual(values = party_colors) +
    labs(title = &quot;Election Results 2016&quot;, fill = NULL)

p2 + theme_map() </pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-14">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-36-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-15" class="build faster">

<ul>
<li>To the <code>fill</code> aethetic, let’s try a continuous measure, such as the percentage of the vote received by Donald Trump (<code>pct_trump</code>).</li>
</ul>

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = us_states_elec,
             mapping = aes(x = long, y = lat, group = group, fill = pct_trump))

p1 &lt;- p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) 

p1 + labs(title = &quot;Trump vote&quot;) + theme_map() + labs(fill = &quot;Percent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-16">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-38-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-17" class="build faster">

<ul>
<li><p>Blue is not the color we want here.</p></li>
<li><p>The color gradient runs in the wrong direction.</p></li>
<li><p>Let’s fix these problems using <code>scale_fill_gradient()</code>:</p></li>
</ul>

<pre class = 'prettyprint lang-r'>p2 &lt;- p1 + scale_fill_gradient(low = &quot;white&quot;, high = &quot;#CB454A&quot;) +
        labs(title = &quot;Trump vote&quot;) 
p2 + theme_map() + labs(fill = &quot;Percent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-18">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-40-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-19" class="build faster">

<ul>
<li>For election results, we might prefer a gradient that diverges from a midpoint.

<ul>
<li>The <code>scale_gradient2()</code> function gives us a blue-red spectrum that passes through white by default.</li>
<li>We can also re-specify the mid-level color along with the <code>high</code> and <code>low</code> colors.</li>
</ul></li>
</ul>

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = us_states_elec,
             mapping = aes(x = long, y = lat, group = group, fill = d_points))

p1 &lt;- p0 + geom_polygon(color = &quot;gray90&quot;, size = 0.1) +
    coord_map(projection = &quot;albers&quot;, lat0 = 39, lat1 = 45) 

p2 &lt;- p1 + scale_fill_gradient2() + labs(title = &quot;Winning margins&quot;) 
p2 + theme_map() + labs(fill = &quot;Percent&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-20">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-42-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-21" class="build faster">

<ul>
<li>From the <code>scale_gradient2()</code> function, we can also re-specify the mid-level color along with the <code>high</code> and <code>low</code> colors.</li>
</ul>

<pre class = 'prettyprint lang-r'>p3 &lt;- p1 + scale_fill_gradient2(low = &quot;red&quot;, 
                                mid = scales::muted(&quot;purple&quot;),
                                high = &quot;blue&quot;, 
                                breaks = c(-25, 0, 25, 50, 75)) 
p3 + theme_map() + labs(fill = &quot;Percent&quot;, title = &quot;Winning margins&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-22">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-44-1.png" width="720" style="display: block; margin: auto;" /></p>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-23" class="build faster">

<ul>
<li>If you take a look at the gradient scale for this first &ldquo;purple America&rdquo; map, <code>p3</code>, you’ll see that it extends very high on the Blue side.

<ul>
<li>This is because Washington DC is included in the data.</li>
</ul></li>
<li>If we omit Washington DC, we’ll see that our color scale shifts.</li>
</ul>

<pre class = 'prettyprint lang-r'>p0 &lt;- ggplot(data = subset(us_states_elec,
                           region %nin% &quot;district of columbia&quot;),
             aes(x = long, y = lat, group = group, fill = d_points))

p3 &lt;- p1 + scale_fill_gradient2(low = &quot;red&quot;, 
                                mid = scales::muted(&quot;purple&quot;),
                                high = &quot;blue&quot;, 
                                breaks = c(-25, 0, 25, 50, 75)) 
p3 + theme_map() + labs(fill = &quot;Percent&quot;, title = &quot;Winning margins&quot;, caption = &quot;DC is omitted.&quot;)</pre>

</article></slide><slide class=""><hgroup><h2>Map U.S. state-level data</h2></hgroup><article  id="map-u.s.-state-level-data-24">

<p><img src="DANL310_Lec09_20220224_files/figure-html/unnamed-chunk-46-1.png" width="720" style="display: block; margin: auto;" /></p></article></slide>


  <slide class="backdrop"></slide>

</slides>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!-- map slide visiblity events into shiny -->
<script>
  (function() {
    if (window.jQuery) {
       window.jQuery(document).on('slideleave', function(e) {
         window.jQuery(e.target).trigger('hidden');
      });
       window.jQuery(document).on('slideenter', function(e) {
         window.jQuery(e.target).trigger('shown');
      });
    }
  })();
</script>

</body>
</html>
