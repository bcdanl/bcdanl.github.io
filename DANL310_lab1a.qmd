---
title: "R Lab - Map Visualization"
author: "Byeong-Hak Choe"
editor: visual
---

```{r setup, include = FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
library(ggthemes)
library(ggtech)
library(ggthemr)
library(ggthemes)
library(hrbrthemes)
library(hexbin)
library(ggforce)
library(skimr)

knitr::opts_chunk$set(fig.width=8, fig.height=5)  

theme_set(theme_ipsum() +
          theme(strip.background =element_rect(fill="lightgray")))
```

### Loading R packages

```{r, eval = T, echo = T}
library(tidyverse)
library(skimr)
library(ggthemes)
library(socviz)
```

# Question 1 - Climate Opinion Map

The following data is for Question 1:

```{r, echo = T, eval = T, message=F}
climate_opinion_long <- read_csv(
  'https://bcdanl.github.io/data/climate_opinion_2021.csv')
```


```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(climate_opinion_long) 
```

<br><br>

## Variable Description

- `belief`: 
  - `human`: Estimated percentage who think that global warming is caused mostly by human activities.
  - `happening`: Estimated percentage who think that global warming is happening.


```{r, echo = T, eval = T}
climate_opinion_long <- read_csv(
  'https://bcdanl.github.io/data/climate_opinion_2021.csv')

climate_opinion_long
```

## Q1a. 

- Filter `climate_opinion_long`, so that `climate_opinion_long` has only estimated percentage who think that global warming is caused mostly by human activities.

- Then join the two data.frames `socviz::county_map` and the resulting data.frame above.

```{r, echo = T, eval = T, out.height= 12, out.width=8}

climate_opinion_long <- climate_opinion_long %>% 
  filter(belief == 'human')

county_map <- county_map
county_map$id <- as.integer(county_map$id)
county_full <- left_join(county_map, climate_opinion_long)

```


## Q1b.

- Replicate the following map.
  - Do not use `coord_map(projection = "albers", lat0 = 39, lat1 = 45) `.
  

```{r, echo = T, eval = T}
p1 <- ggplot(data = county_full) + 
  geom_polygon(mapping = aes(x = long, y = lat,
                             group = group, 
                             fill = perc),
               color = "grey60", 
               linewidth = 0.1) 


p2 <- p1 + scale_fill_gradient2( 
  low = '#2E74C0',  
  high = '#CB454A',  
  mid = 'white', # transparent white
  na.value = "grey80",
  midpoint = 50,
  breaks = c(quantile(climate_opinion_long$perc, 0, na.rm = T),
             quantile(climate_opinion_long$perc, .25, na.rm = T),
             quantile(climate_opinion_long$perc, .5, na.rm = T),
             quantile(climate_opinion_long$perc, .75, na.rm = T),
             quantile(climate_opinion_long$perc, 1, na.rm = T)),
  labels = c(paste(round(quantile(climate_opinion_long$perc, 0, na.rm = T), 1),"\n(Min)"),
             paste(round(quantile(climate_opinion_long$perc, .25, na.rm = T), 1),"\n(25th)"),
             paste(round(quantile(climate_opinion_long$perc, .5, na.rm = T), 1),"\n(50th)"),
             paste(round(quantile(climate_opinion_long$perc, .75, na.rm = T), 1),"\n(75th)"),
             paste(round(quantile(climate_opinion_long$perc, 1, na.rm = T), 1),"\n(Max)")
  ),
  guide = guide_colorbar( direction = "horizontal",
                          barwidth = 25,
                          title.vjust = 1 )
) 

p <- p2 + labs(fill = "Percent\nBelief", title = "U.S. Climate Opinion, 2021",
               caption = "Sources: Yale Program on Climate Change Communication\n(https://climatecommunication.yale.edu/visualizations-data/ycom-us/)") +
  theme_map() +
  theme(plot.margin = unit( c(1, 1, 3.85, 0.5), "cm"),
        legend.position = c(0.5, -.15),
        legend.justification = c(.5,.5),
        strip.background = element_rect( colour = "black",
                                         fill = "white",
                                         color = "grey80" )
  ) +
  guides(fill = guide_colourbar(direction = "horizontal", barwidth = 25,
                                title.vjust = 1))
p
```

