---
title: "DANL 310, Make-up Midterm Exam"
subtitle: "Replicate the given figures using `ggplot`<br><br>" 
author: 
  - "Byeong-Hak Choe<br>"
date: "March 22, 2022"
output: 
  html_document:
    df_print: paged
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: false
    highlight: espresso
---

```{r, include = F}
# install.packages("hrbrthemes")
library(tidyverse)
library(socviz)
library(lubridate)
library(hrbrthemes)
library(ggthemes)
library(ggridges)
theme_set(theme_minimal())
```

<br>

- R packages for the make-up midterm exam
```{r, echo = T, eval = F}
# install.packages("hrbrthemes")
library(tidyverse)
library(socviz)
library(lubridate)
library(hrbrthemes)
library(ggthemes)
library(ggridges)

```

<br>


# Question 1

```{r, echo = T, message=F, warning=F}
nyc_flights <- read_csv(
  'https://bcdanl.github.io/data/nyc_flights_grouped.csv')

nyc_flights %>%
  group_by(carrier_full) %>%
  tally() %>%
  mutate(highlight = ifelse(carrier_full %in% c("Delta", "American"), "yes", "no")) %>%
  ggplot(aes(x=reorder(carrier_full, n),
             y=n,
             fill = highlight)) +
  scale_fill_manual(values = c("#B0B0B0D0", "#BD3828D0"),
                    guide = "none") +
  scale_y_continuous(expand = c(0, 0)) +
  scale_x_discrete(name = NULL) +
  geom_col() +
  geom_text(aes(label = n), hjust = -.1, vjust = -.5,
            size = 4) +
  coord_flip(clip = "off") +
  theme_wsj() +
  theme(
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank()
  ) +
  ylim(c(0, 60000)) +
  labs( caption = "Data Sources: U.S. Department of Transportation, Bureau of Transportation Statistics",
        y = "Number of flights",
        title = "Number of flights from NYC in 2013")
```

  
<br>

# Question 2


```{r, echo = T, message=F, warning=F}
library(gapminder)
gapminder

ggplot(data = filter(gapminder, year == 2007),
       aes(x = lifeExp,
           y = fct_reorder(country, lifeExp))) +
  geom_point(color = "#0072B2", size = 1.5) +
  facet_wrap(~continent, scales = "free_y") +
  scale_x_continuous(
    name = "Life expectancy in 2007"
  ) +
  scale_y_discrete(name = NULL) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = rel(.75))
  )

```
  
<br>


# Question 3

```{r, echo = T, message=F, warning=F}
political_ideology <- read_csv(
  'https://bcdanl.github.io/data/political_ideology.csv')

ggplot(political_ideology,
       aes(
         x = ideology_score,
         y = year,
         group = interaction(party, factor(year))  ,
         fill = interaction(party, factor(year))
       )
) +
  geom_density_ridges(scale = 5, size = 0.25,
                      rel_min_height = 0.01,
                      alpha=0.75, color = "white") +
  scale_x_continuous(
    name = "Ideology score",
    limits = c(-.8, 1.3),
    breaks = c(-1,-.75,-.5,-.25,
               0,
               .25,.5,.75,1)
  ) +
  scale_y_reverse(
    name = "Year",
    breaks=c(seq(2013, 1963, -10))
  ) +
  scale_fill_cyclical(
    breaks = c("DEM.1963", "GOP.1963"),
    labels = c(`DEM.1963` = "Democrats  ",
               `GOP.1963` = "Republicans"),
    values = c("#2e74c0", "#cb454a", 
               "#6c9dd2", "#da7c80"),
    name = NULL,
    guide = "legend"
  ) +
  theme_minimal() +
  theme(
    axis.text.y = element_text(vjust = 0),
    legend.position = c(1, 1),
    legend.justification = c(1, 1),
    legend.direction = "horizontal",
    legend.background = element_rect(fill = "white")
  )

```

  
<br>


# Question 4
```{r, echo = T, message=F, warning=F}
covid_country_info <- read.csv('https://bcdanl.github.io/data/covid_country_info.csv',
                stringsAsFactors = FALSE, 
                encoding = 'UTF-8')
### Variable description
# total_cases:	Total confirmed cases of COVID-19
# total_deaths:	Total deaths attributed to COVID-19

covid_country_info
```

  
<br>

Q4a. Calculate new COVID-19 cases and new deaths for each country for each day.
```{r, echo = T, message=F, warning=F}
country_info4a <- covid_country_info %>% 
  group_by(country) %>% 
  mutate( cases_new = total_cases - lag(total_cases),
          deaths_new = total_deaths - lag(total_deaths) ) 

country_info4a
```

  
<br>


Q4b. Calculate the mean level of new COVID-19 cases and new deaths  for each country for each month.
```{r, echo = T, message=F, warning=F}

country_info4b <- covid_country_info %>% 
  group_by(country, year, month) %>% 
  mutate( cases_new = total_cases - lag(total_cases),
          deaths_new = total_deaths - lag(total_deaths) ) %>% 
  summarize( cases_mean = mean(cases_new, na.rm = TRUE),
             deaths_mean = mean(deaths_new, na.rm = TRUE) )

country_info4b
```

  
<br>

Q4c. Describe the relationship between aged_65_older and monthly average of new deaths due to COVID-19 using ggplot.

  - Feel free to remove outliers when describing the average relationship.

  - Make a simple comment on your ggplot result. 
  
<br>

```{r, echo = T, message=F, warning=F}
country_info4c <- covid_country_info %>% 
  group_by(continent, country, year, month, 
           aged_65_older, median_age, gdp_per_capita) %>% 
  mutate( cases_new = total_cases - lag(total_cases),
          deaths_new = total_deaths - lag(total_deaths) ) %>% 
  mutate( cases_mean = mean(cases_new, na.rm = TRUE),
             deaths_mean = mean(deaths_new, na.rm = TRUE),
             cases_tot = sum(cases_new, na.rm = TRUE),
             deaths_tot = sum(deaths_new, na.rm = TRUE)) %>% 
  select(continent, country, year, month, 
           aged_65_older, median_age, gdp_per_capita,
         cases_mean, deaths_mean, cases_tot, deaths_tot)


ggplot(data = country_info4c,  
       mapping = aes(x = median_age, 
                     y = deaths_mean) ) +
  geom_point(alpha = .05) + 
  geom_smooth(method = lm) +
  labs( y = "Monthly mean of new death",
        x = "Media age")

ggplot(data = filter(country_info4c, deaths_mean < 100),  
       mapping = aes(x = median_age, 
                     y = deaths_mean) ) +
  geom_point(alpha = .05) + 
  geom_smooth(method = lm) +
  labs( y = "Monthly mean of new death",
        x = "Media age")

```
  
<br>

Q4d. Describe the average relationship between gdp_per_capita and monthly average of new deaths due to COVID-19 using ggplot.

  - Make a simple comment on your ggplot result.

  - Feel free to remove outliers when describing the average relationship.

  - You can also transform data if you would like to.
  
<br>

```{r, echo = T, message=F, warning=F}
ggplot(data = country_info4c,
       mapping = aes(x = gdp_per_capita, 
                     y = deaths_mean) ) +
  geom_point(alpha = .05) + 
  geom_smooth(method = lm) +
  labs( y = "Monthly mean of new death",
        x = "GDP per capita")


ggplot(data = filter(country_info4c, deaths_mean < 200,
                     gdp_per_capita < 100000),  
       mapping = aes(x = log(gdp_per_capita), 
                     y = log(deaths_mean)) ) +
  geom_point(alpha = .05) + 
  geom_smooth(method = lm) +
  labs( y = "Log of monthly mean of new death",
        x = "Log of GDP per capita")

```



References for this homework are

  - [Fundamentals of Data Visualization by Claus O. Wilke](https://clauswilke.com/dataviz)
  - [Data Visualization: A practical introduction by Kieran Healy](https://socviz.co)

