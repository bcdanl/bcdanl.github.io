---
title: "DANL 200 - Classwork 11 - Joins"
author: "Byeong-Hak Choe"

format: 
  html:
    code-fold: true      
    code-summary: "Show the code"

execute: 
  eval: true
  echo: true
  warning: false
  message: false
  fig-width: 9
---

```{r setup, include = FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
library(ggthemes)
library(ggthemr)
library(hrbrthemes)
library(hexbin)
library(ggforce)
library(skimr)

knitr::opts_chunk$set(fig.width=8, fig.height=5)  

theme_set(theme_ipsum() +
          theme(strip.background =element_rect(fill="lightgray")))


```

## Loading R packages

```{r, eval = T, echo = T}
library(tidyverse)
library(nycflights13)
library(skimr)
```



# Question 1


Consider the following example DataFrames.
```{r}
student_data1 <- data.frame(
  student_id = c('S1', 'S2', 'S3', 'S4', 'S5'),
  name = c('Danniella Fenton', 'Ryder Storey', 'Bryce Jensen', 'Ed Bernal', 'Kwame Morin'),
  marks = c(200, 210, 190, 222, 199)
)

student_data2 <- data.frame(
  student_id = c('S4', 'S5', 'S6', 'S7', 'S8'),
  name = c('Scarlette Fisher', 'Carla Williamson', 'Dante Morse', 'Kaiser William', 'Madeeha Preston'),
  marks = c(201, 200, 198, 219, 201)
)

```




```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(student_data1)
```


```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(student_data2)
```


<br>

## Q1a
Write a R code to join the two given data.frames along **rows** and assign all data.

```{r}
df_r <- rbind(student_data1, student_data2)
```


```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(df_r)
```

<br>


## Q1b
Write a R code to join the two given data.frames along **columns** and assign all data.

```{r}
df_c <- cbind(student_data1, student_data2)
```


```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(df_c)
```


<br><br><br>

# Question 2

Consider the two data.frames `flights` and `airlines` from the `nycflights13` package.


- `flights` data.frame
```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(flights)
```

```{r}
colnames(flights)  # returns column names in the flights data.frame
```


- `airports` data.frame

```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(airports)
```

```{r}
colnames(airports)
```


- `airlines` data.frame

```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(airlines)
```

```{r}
colnames(airlines)
```

<br>

## Q2a

Join `flights` with `airports`, so that we can see information about each flight's destination airport in the `flights` data.frame.

```{r}
q2a <- flights %>% 
  left_join(airports, by = c('dest' = 'faa'))
```

```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(q2a)
```

<br>

## Q2b

Find the airline that has the longest positive `dep_delay` on average.

```{r}
flights <- flights %>% 
  left_join(airlines)

q2b <- flights %>% 
  group_by(carrier, name) %>% 
  summarize(delay_mean = mean(dep_delay[dep_delay> 0],
                              na.rm = T)
            ) %>% 
  arrange(-delay_mean)

```



```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(q2b)
```

<br>

## Q2c

Find the airline that has the largest proportion of flights with longer than 30-minute `dep_delay`.


```{r}
q2c <- flights %>% 
  mutate(delay_over_30 = ifelse(dep_delay > 30, 
                                1, 0) ) %>% 
  group_by(carrier, name) %>% 
  summarize(pct = 100 * mean(delay_over_30,
                              na.rm = T)) %>% 
  arrange(-pct)

```


```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(q2c)
```
