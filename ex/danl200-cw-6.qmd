---
title: "DANL 200: Classwork 6 - Filtering"
date: 2023-10-13
execute: 
  warning: false
  message: false
---
```{r}
#| include: false

library(knitr)
library(rmarkdown)
library(tidyverse)
library(skimr)
library(ggthemes)
library(hrbrthemes)

theme_set(theme_ipsum() +
          theme(strip.background =element_rect(fill="lightgray"),
                axis.title.x = element_text(size = rel(1.5)),
                axis.title.y = element_text(size = rel(1.5)),
                legend.title = element_text(size=rel(1.25))
                ))
```

# Question 1. Filtering with `filter()`

## Q1a.

- Find all flights that
  - Had an arrival delay of two or more hours
  - Flew to Houston (`IAH` or `HOU`)
  - Were operated by United, American, or Delta
  - Departed in summer (July, August, and September)
  - Arrived more than two hours late, but didn’t leave late
  - Were delayed by at least an hour, but made up over 30 minutes in flight
  - Departed between midnight and 6am (inclusive)

<br><br>

## Q1b.

- How many flights have a missing `dep_time`? What other variables are missing? What might these rows represent?

<br><br>

## Q1c.

- Why is `NA^0` not missing? Why is `NA | TRUE` not missing? Why is `FALSE & NA` not missing? Can you figure out the general rule? (`NA * 0` is a tricky counterexample!)



<br><br><br>


# Question 2. Arrange rows with `arrange()`

## Q2a.

- How could you use `arrange()` to sort all missing values to the start? (Hint: use `is.na()`).
```{r}
#| echo: true
df <- data.frame(num = c(1, 4, NA, 2, NA, 3, 7),
                 chr = c("A", "A", "A", "B", "X", "Z", "D"))
```

<br>

## Q2b.

- Sort flights to find the most delayed flights. Find the flights that left earliest.

<br>

## Q2c.

- Sort flights to find the fastest (highest speed) flights.

<br>

## Q2d.

- Which flights traveled the farthest? Which traveled the shortest?

<br><br><br>


# Question 3. Select columns with `select()`

## Q3a.

- Brainstorm as many ways as possible to select `dep_time`, `dep_delay`, `arr_time`, and `arr_delay` from flights.

<br>

## Q3b.

- Does the result of running the following code surprise us? How do the select helpers deal with case by default? How can we change that default?

```{r, echo = T, eval = F}
select(flights, contains("TIME"))
```

<br>

## Q3c.
- Rename `air_time` to `air_time_min` to indicate units of measurement and move it to the beginning of the data frame.


<br><br><br>

# Question 4. Add new variables with `mutate()`

## Q4a.
 
- Currently `dep_time` and `sched_dep_time` are convenient to look at, but hard to compute with because they’re not really continuous numbers. 
  - Convert them to a more convenient representation of number of minutes since midnight.

<br>

## Q4b. 

- Compare `air_time` with `arr_time - dep_time`. What do you expect to see? What do you see? What do you need to do to fix it?

- Compare `dep_time`, `sched_dep_time`, and `dep_delay.` How would you expect those three numbers to be related?

<br>

## Q4c.

- Find the 10 most delayed flights using a ranking function. How do you want to handle ties? 

<br>

