---
title: "DANL 200: Classwork 9 - Data visualization and transformation"
date: 2023-11-08
execute: 
  warning: false
  message: false
  echo: true
  eval: true
---
```{r}
#| eval: true
#| include: false

library(knitr)
library(rmarkdown)
library(tidyverse)
library(skimr)
library(ggthemes)
library(hrbrthemes)

theme_set(theme_ipsum() +
          theme(strip.background =element_rect(fill="lightgray"),
                axis.title.x = element_text(size = rel(1.5)),
                axis.title.y = element_text(size = rel(1.5)),
                legend.title = element_text(size=rel(1.25))
                ))
```

# Question 1. NYC dogs

- For Question 1, run the following R command to read the `nyc_dogs_cleaned.csv` file.

```{r}
#| eval: true
#| echo: true
nyc_dogs <- read_csv('https://bcdanl.github.io/data/nyc_dogs_cleaned.csv')
```


```{r}
#| echo: false
#| eval: true
#| results: asis
rmarkdown::paged_table(nyc_dogs) 
```


<br>


## Q1a

- Find the five most popular `breed`s.

```{r}
q1a <- nyc_dogs %>% 
  filter(!is.na(breed)) %>% 
  group_by(breed) %>% 
  summarise(n = n()) %>% 
  arrange(-n) 

```


```{r}
#| echo: false
#| eval: true
#| results: asis
rmarkdown::paged_table(q1a) 
```

<!-- 1 Unknown 54586 2 Yorkshire Terrier 30379 3 Labrador (or Crossbreed) 28399 4 Shih Tzu 27407 5 Pit Bull (or Mix) 24393 6 Chihuahua 21211 -->

<br><br>

## Q1b

- Provide both (1) ggplot code and (2) a simple comment to describe the relationship between the five popular `breed`s and `borough`. 

```{r}
q1b <- nyc_dogs %>% 
  filter(breed %in% q1a$breed[1:5],
         !is.na(breed) ) 
  
ggplot(data = q1b) +
  geom_bar(aes(y = breed, fill = breed),
           show.legend = F) +
  facet_wrap(.~borough)


ggplot(data = q1b) +
  geom_bar(aes(y = breed, fill = breed),
           position = "dodge",
           show.legend = F) +
  facet_wrap(.~borough)

ggplot(data = q1b) +
  geom_bar(aes(y = breed, fill = breed),
           position = "fill",
           show.legend = F) +
  facet_wrap(.~borough)


ggplot(data = q1b) +
  geom_bar(aes(y = breed, fill = borough, 
               x = stat(prop), group = borough), 
           position = "dodge") 

ggplot(data = q1b) +
  geom_bar(aes(y = borough, fill = breed, 
               x = stat(prop), group = breed), 
           position = "dodge")

```

```{r, fig.width= 9, fig.height= 120}
# What if the filtered data could not be obtained ... 
ggplot(data = nyc_dogs)+
  geom_bar(mapping = aes(x=borough))+
  facet_wrap(~breed, ncol = 4, scales = "free_y") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))  # optional
```

<br><br>

## Q1c

- Find the five most popular `breed`s in each `borough`.

```{r}
q1c <- nyc_dogs %>% 
  filter(!is.na(breed)) %>% 
  group_by(breed, borough) %>% 
  summarize(n = n()) %>% 
  arrange(borough, -n)

q1c <- nyc_dogs %>% 
  filter(!is.na(breed)) %>% 
  group_by(breed, borough) %>% 
  mutate(n = n()) %>% 
  group_by(borough) %>% 
  mutate(rank = dense_rank(-n) ) %>% 
  filter(rank <= 10 ) %>% 
  select(breed, n, rank, borough) %>% 
  distinct() %>% 
  arrange(borough,-n)
```

```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(q1c) 
```

<br><br>

## Q1d

- Find the five most popular dog `name`s for each `gender`.

```{r}
q1d <- nyc_dogs %>% 
  group_by(gender, name) %>% 
  summarise(n = n()) %>% 
  arrange(gender, -n) %>% 
  slice_head( n = 5)


q1d <- nyc_dogs %>% 
  group_by(gender, name) %>% 
  summarise(n = n()) %>% 
  mutate(ranking = dense_rank(-n)) %>% 
  filter(ranking <= 5)


```

<br><br>

## Q1e

- Find the five most popular dog `name`s for each `gender` in each `borough`.

```{r}
q1e <- nyc_dogs %>% 
  group_by(borough, gender, name) %>% 
  summarise(n = n()) %>% 
  arrange(gender, -n)

q1e <- nyc_dogs %>% 
  group_by(borough, gender, name) %>% 
  summarise(n = n()) %>% 
  mutate(ranking = dense_rank(-n)) %>% 
  filter(ranking <= 5)


```

```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(q1e) 
```

<br><br>

## Q1f

- Assume that all dogs in the `nyc_dogs` data frame are alive as of today.
  - Provide both (1) ggplot code and (2) a simple comment to describe the distribution of age for each `borough`.

```{r}
nyc_dogs <- nyc_dogs %>% 
  mutate( age = 2023 - birth_year )

ggplot( nyc_dogs ) +
  geom_freqpoly(aes(x = age, color = borough), 
                 binwidth = 1) 

ggplot( filter(nyc_dogs, 
               age <= 25) ) +
  geom_histogram(aes(x = age), 
                 binwidth = 1) + 
  facet_wrap(~borough)

```

Add some comments here ....

<br><br><br>
