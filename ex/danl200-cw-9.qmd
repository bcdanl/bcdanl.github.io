---
title: "DANL 200: Classwork 9 - Data visualization and transformation"
date: 2023-11-08
execute: 
  warning: false
  message: false
  echo: false
  eval: false
---
```{r}
#| eval: true
#| include: false

library(knitr)
library(rmarkdown)
library(tidyverse)
library(skimr)
library(ggthemes)
library(hrbrthemes)

theme_set(theme_ipsum() +
          theme(strip.background =element_rect(fill="lightgray"),
                axis.title.x = element_text(size = rel(1.5)),
                axis.title.y = element_text(size = rel(1.5)),
                legend.title = element_text(size=rel(1.25))
                ))
```

# Question 1. NYC dogs

- For Question 1, run the following R command to read the `nyc_dogs.csv` file.

```{r}
#| eval: true
#| echo: true
nyc_dogs <- read_csv('https://bcdanl.github.io/data/nyc_dogs_cleaned.csv')
```


```{r}
#| eval: true
#| results: asis
rmarkdown::paged_table(nyc_dogs) 
```


<br>

## Q1a

- Provide both (1) ggplot code and (2) a simple comment to describe the distribution of `animal_gender`

```{r}
ggplot(nyc_dogs) +
  geom_bar(aes(x = animal_gender))

ggplot(nyc_dogs) +
  geom_boxplot(aes(x = animal_gender))
```

<!-- -   There are more male dogs than female dogs. -->

<!-- -   There are more male dogs than female dogs in each borough. -->

<br><br>

## Q1b

- Find the five most popular breeds in NYC.

```{r}
q1b <- nyc_dogs %>% 
  group_by(breed_rc) %>% 
  summarise(n = n()) %>% 
  arrange(-n) 

```

<!-- 1 Unknown 54586 2 Yorkshire Terrier 30379 3 Labrador (or Crossbreed) 28399 4 Shih Tzu 27407 5 Pit Bull (or Mix) 24393 6 Chihuahua 21211 -->

<br><br>

## Q1c

- Provide both (1) ggplot code and (2) a simple comment to describe the relationship between the five popular breeds and `borough`. 

```{r}
q1c <- nyc_dogs %>% 
  filter(breed_rc %in% q1b$breed_rc[1:5],
         !is.na(borough) ) 
  
ggplot(data = q1c) +
  geom_bar(aes(y = breed_rc, fill = breed_rc),
           show.legend = F) +
  facet_wrap(.~borough)


ggplot(data = q1c) +
  geom_bar(aes(y = breed_rc, fill = breed_rc),
           position = "dodge",
           show.legend = F) +
  facet_wrap(.~borough)

ggplot(data = q1c) +
  geom_bar(aes(y = breed_rc, fill = breed_rc),
           position = "fill",
           show.legend = F) +
  facet_wrap(.~borough)


ggplot(data = q1c) +
  geom_bar(aes(y = breed_rc, fill = borough, 
               x = stat(prop), group = borough), 
           position = "dodge") 

ggplot(data = q1c) +
  geom_bar(aes(y = borough, fill = breed_rc, 
               x = stat(prop), group = breed_rc), 
           position = "dodge")

```

```{r, fig.width= 8, fig.height= 120}
# What if the filtered data could not be obtained ... 
ggplot(data = nyc_dogs)+
  geom_bar(mapping = aes(x=borough))+
  facet_wrap(~breed_rc, ncol = 4) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))  # optional
```

<br><br>

## Q1d

- Find the five most popular breeds for each borough in NYC.

```{r}
q1d <- nyc_dogs %>% 
  group_by(breed_rc, borough) %>% 
  summarize(n = n()) %>% 
  arrange(borough, -n)

Q1d <- nyc_dogs %>% 
  group_by(breed_rc, borough) %>% 
  mutate(n = n()) %>% 
  group_by(borough) %>% 
  mutate(rank = dense_rank(-n) ) %>% 
  filter(rank <= 10 ) %>% 
  select(breed_rc, n, rank, borough) %>% 
  distinct() %>% 
  arrange(borough,-n)
```

```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(Q1d) 
```

<br><br>

## Q1e

- Find the five most popular dog names for each gender in NYC.

```{r}
q1e <- nyc_dogs %>% 
  group_by(animal_gender, animal_name) %>% 
  summarise(n = n()) %>% 
  arrange(animal_gender, -n) %>% 
  slice_head(5)


Q1e <- nyc_dogs %>% 
  group_by(animal_gender, animal_name) %>% 
  summarise(n = n()) %>% 
  mutate(ranking = dense_rank(-n)) %>% 
  filter(ranking <= 5)


```

<br><br>

## Q1f

- Find the five most popular dog names for each gender for each borough in NYC.

```{r}
q1f <- nyc_dogs %>% 
  group_by(borough, animal_gender, animal_name) %>% 
  summarise(n = n()) %>% 
  arrange(animal_gender, -n)

Q1f <- nyc_dogs %>% 
  group_by(borough, animal_gender, animal_name) %>% 
  summarise(n = n()) %>% 
  mutate(ranking = dense_rank(-n)) %>% 
  filter(ranking <= 5)


```

```{r, result = 'asis', echo = F, message = F, warning = F}
rmarkdown::paged_table(Q1f) 
```

<br><br>

## Q1g

- Assume that all dogs in the `nyc_dogs` data frame are alive as of today.
  - Provide both (1) ggplot code and (2) a simple comment to describe the distribution of age for each `borough`.

```{r}
nyc_dogs <- nyc_dogs %>% 
  mutate( age = 2023 - animal_birth_year )

ggplot( nyc_dogs ) +
  geom_density(aes(x = age)) + 
  facet_wrap(~borough)

ggplot( data = filter(nyc_dogs, 
                      age <= 25, !is.na(borough)) ) +
  geom_density(aes(x = age)) + 
  facet_wrap(~borough)


ggplot( filter(nyc_dogs, 
               age <= 25, !is.na(borough)) ) +
  geom_histogram(aes(x = age), 
                 binwidth = 1) + 
  facet_wrap(~borough)

```

<!-- Add some comments here .... -->

<br><br><br>
