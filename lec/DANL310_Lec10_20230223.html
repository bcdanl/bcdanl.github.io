<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>DANL 310 Lecture 10</title>
    <meta charset="utf-8" />
    <meta name="author" content="Byeong-Hak Choe" />
    <script src="libs/header-attrs-2.20/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <script src="libs/xaringanExtra-webcam-0.0.1/webcam.js"></script>
    <script id="xaringanExtra-webcam-options" type="application/json">{"width":"200","height":"200","margin":"1em"}</script>
    <script src="libs/js-cookie-3.0.0/js.cookie.js"></script>
    <script src="libs/peerjs-1.3.1/peerjs.min.js"></script>
    <script src="libs/tiny.toast-1.0.0/toast.min.js"></script>
    <link href="libs/xaringanExtra-broadcast-0.2.6/broadcast.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-broadcast-0.2.6/broadcast.js"></script>
    <link href="libs/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon-1.4.1/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain-0.2.6/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain-0.2.6/shareagain.js"></script>
    <link href="libs/xaringanExtra-extra-styles-0.2.6/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/nhsr.css" type="text/css" />
    <link rel="stylesheet" href="css/nhsr-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: title-slide, left, bottom

# DANL 310 Lecture 10
----
## **DANL 310: Data Visualization and Presentation**
### Byeong-Hak Choe
### Febraury 23, 2023


---
class: inverse, center, middle

# Get Started with `ggplot` visualization
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;

---
# Get Started with `ggplot` visualization

*1*. Tell the `ggplot()` function what our **tidy** data is. 
  - `ggplot(data = ...)`


*2*. Tell `ggplot()` what relationships or distributions we want to see.
  - The `ggplot(mapping = aes(...))` 
  - `p &lt;- ggplot(data = ... , aes(...))`
  
  
*3*. Tell `ggplot()` how we want to see the relationships in our data.
  - Choose a `geom_*()`.
  - If needed, use `stat()`, `after_stat()`, or `..statistics..`.
  
  
*4*. Layer on `geoms` as needed, by adding them to the `p` object one at a time.


*5*. Use some additional functions to adjust scales, labels, tick marks, titles, coord, etc.



---
# Get Started with `ggplot` visualization

- In last class, we have learned how to customize the scale, guide, and theme functions in ggplot.

  - These techniques will allow us to produce very sophisticated graphs in a systematic, comprehensible way.
  
  - [ggThemeAssist](https://github.com/calligross/ggthemeassist) can be helpful.
  
  - [https://ggplot2tor.com/scales](https://ggplot2tor.com/scales) provides a complete guide to `scale`s.
  
  - [https://ggplot2tor.com/theme](https://ggplot2tor.com/theme) provides a complete guide to `theme`s.
  
  - [https://ggplot2tor.com/aesthetics](https://ggplot2tor.com/aesthetics) finds available aesthetics for each geom.

---
class: inverse, center, middle

# Add Labels and Make Notes
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;

---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; Plot text directly &lt;/p&gt;

- It can sometimes be useful to plot the labels along with the points in a scatterplot, or just plot informative labels directly.
  - We can do this with `geom_text()`.
  

```r
p &lt;- ggplot(data = by_country,
            mapping = aes(x = roads_mean, y = donors_mean))
p + geom_point() + geom_text(mapping = aes(label = country))
```

- By default, the text is plotted right on top of the points.
- Setting `hjust = 0` will left justify the label, and `hjust = 1` will right justify it.


```r
p + geom_point() + geom_text(mapping = aes(label = country), hjust = 0)
```





---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt;  &lt;/p&gt;

&lt;img src="DANL310_Lec10_20230223_files/figure-html/unnamed-chunk-3-1.png" width="100%" style="display: block; margin: auto;" /&gt;



---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; Plot text directly &lt;/p&gt;

- Instead of wrestling any further with `geom_text()`, we can use `ggrepel::geom_text_repel()` instead. 


```r
install.packages("ggrepel")
library(ggrepel)
```

- Let's use some historical U.S. presidential election data provided in the `socviz` library.

```r
socviz::elections_historic %&gt;% select(2:7) 
```

---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; Plot text directly &lt;/p&gt;

.panelset[
.panel[.panel-name[Step 1]
- Let's map aethetics to variables

```r
p &lt;- ggplot(elections_historic, aes(x = popular_pct, y = ec_pct,
                                    label = winner_label))
```

]

.panel[.panel-name[Step 2]
- Then, add geometric objects to ggplot.

```r
p &lt;- p + 
    geom_hline(yintercept = 0.5, linewidth = 1.4, color = "gray80") +
    geom_vline(xintercept = 0.5, linewidth = 1.4, color = "gray80") +
    geom_point() +
    geom_text_repel()
p
```
- We use two new geoms, `geom_hline(yintercept = NUMBER)` and `geom_vline(xintercept = NUMBER)` to make the lines.
]



.panel[.panel-name[Step 3]
- Let's set the scales for `x` and `y`.

```r
p &lt;- p + 
     scale_x_continuous(labels = scales::percent) +
     scale_y_continuous(labels = scales::percent) 
p
```

]


.panel[.panel-name[Step 4]
- Let's set the labels.

```r
p_title &lt;- "Presidential Elections: Popular &amp; Electoral College Margins"
p_subtitle &lt;- "1824-2016"
p_caption &lt;- "Data for 2016 are provisional."
x_label &lt;- "Winner's share of Popular Vote"
y_label &lt;- "Winner's share of Electoral College Votes"

p + labs(x = x_label, y = y_label, 
         title = p_title, subtitle = p_subtitle,
         caption = p_caption)
```

]


]



---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; Label Outliers &lt;/p&gt;

- Sometimes we want to pick out some points of interest in the data without labeling every single item. 
  -  We do this using the `filter()` function.

.panelset[
.panel[.panel-name[(1)]

```r
p &lt;- ggplot(data = by_country,
            mapping = aes(x = gdp_mean, y = health_mean))

p + geom_point() +
    geom_text_repel(data = subset(by_country, gdp_mean &gt; 25000),
                    mapping = aes(label = country))
```
]

.panel[.panel-name[(2)]

```r
p &lt;- ggplot(data = by_country,
            mapping = aes(x = gdp_mean, y = health_mean))
p + geom_point() +
    geom_text_repel(data = filter(by_country,
                                  gdp_mean &gt; 25000 | health_mean &lt; 1500 |
                                  country %in% "Belgium"),
                    mapping = aes(label = country))
```
]



]



---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; Label Outliers &lt;/p&gt;

- We can also add a logical variable (either `TRUE` or `FALSE`) to label specific points using `filter()`.


```r
# creating a dummy variable in the data set for labels
organdata$ind &lt;- organdata$ccode %in% c("Ita", "Spa") &amp; organdata$year &gt; 1998   

p &lt;- ggplot(data = organdata,
            mapping = aes(x = roads, y = donors, 
                          color = ind))
p + geom_point() +
    geom_text_repel(data = filter(organdata, ind),
                    mapping = aes(label = ccode)) +
    guides(label = "none", color = "none")
```




---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; Label Outliers &lt;/p&gt;

- Let's replicate the following using `ggplot::mtcars`:
&lt;img src="DANL310_Lec10_20230223_files/figure-html/unnamed-chunk-13-1.png" width="75%" /&gt;


---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; Write and draw in the plot area &lt;/p&gt;

- We can use `annotate()` to annotate the figure directly. 
  &lt;!-- - Maybe we sometimes need to point out something important that is not mapped to a variable.  --&gt;

.panelset[
.panel[.panel-name[text]

```r
p &lt;- ggplot(data = organdata, mapping = aes(x = roads, y = donors))
p + geom_point() + annotate(geom = "text", x = 91, y = 33,
                            label = "A surprisingly high \n recovery rate.",
                            hjust = 0)
```
]

.panel[.panel-name[rect]

```r
p &lt;- ggplot(data = organdata,
            mapping = aes(x = roads, y = donors))
p + geom_point() +
    annotate(geom = "rect", xmin = 125, xmax = 155,
             ymin = 30, ymax = 35, fill = "red", alpha = 0.2) + 
    annotate(geom = "text", x = 157, y = 33,
             label = "A surprisingly high \n recovery rate.", hjust = 0)
```

]

.panel[.panel-name[point]

```r
p &lt;- ggplot(mpg, aes(displ, hwy)) +
  geom_point(
    data = filter(mpg, manufacturer == "subaru"), color = "orange", size = 3) +
  geom_point() 

p + 
  annotate(geom = "point", x = 5.5, y = 40, colour = "orange", size = 3) + 
  annotate(geom = "point", x = 5.5, y = 40) + 
  annotate(geom = "text", x = 5.6, y = 40, label = "subaru", hjust = "left")
```

]

.panel[.panel-name[curve]

```r
p + 
  annotate(
    geom = "curve", x = 4, y = 35, xend = 2.65, yend = 27, 
    curvature = .3, arrow = arrow(length = unit(2, "mm"))
  ) +
  annotate(geom = "text", x = 4.1, y = 35, label = "subaru", hjust = "left")
```

]
]




---
class: inverse, center, middle

# Work with models
&lt;html&gt;&lt;div style='float:left'&gt;&lt;/div&gt;&lt;hr color='#EB811B' size=1px width=796px&gt;&lt;/html&gt;





---
# Add Labels and Make Notes
### &lt;p style="color:#00449E"&gt; gapminder data &lt;/p&gt;

- The `gapminder` package include the `gapminder` data.frame.


```r
gapminder
```

```
# # A tibble: 1,704 × 6
#    country     continent  year lifeExp      pop gdpPercap
#    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
#  1 Afghanistan Asia       1952    28.8  8425333      779.
#  2 Afghanistan Asia       1957    30.3  9240934      821.
#  3 Afghanistan Asia       1962    32.0 10267083      853.
#  4 Afghanistan Asia       1967    34.0 11537966      836.
#  5 Afghanistan Asia       1972    36.1 13079460      740.
#  6 Afghanistan Asia       1977    38.4 14880372      786.
#  7 Afghanistan Asia       1982    39.9 12881816      978.
#  8 Afghanistan Asia       1987    40.8 13867957      852.
#  9 Afghanistan Asia       1992    41.7 16317921      649.
# 10 Afghanistan Asia       1997    41.8 22227415      635.
# # … with 1,694 more rows
```

```r
skim(gapminder)
```


&lt;table style='width: auto;'
      class='table table-condensed'&gt;
&lt;caption&gt;Data summary&lt;/caption&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Name &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; gapminder &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Number of rows &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1704 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Number of columns &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 6 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; _______________________ &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Column type frequency: &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; factor &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; numeric &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ________________________ &lt;/td&gt;
   &lt;td style="text-align:left;"&gt;  &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Group variables &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; None &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


**Variable type: factor**

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; skim_variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; n_missing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; complete_rate &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; ordered &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; n_unique &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; top_counts &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; country &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; FALSE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 142 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Afg: 12, Alb: 12, Alg: 12, Ang: 12 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; continent &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; FALSE &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Afr: 624, Asi: 396, Eur: 360, Ame: 300 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


**Variable type: numeric**

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; skim_variable &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; n_missing &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; complete_rate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; mean &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sd &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p0 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p25 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p50 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p75 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p100 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; hist &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; year &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1979.50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 17.27 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1952.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1965.75 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1979.50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1993.25 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2007.0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ▇▅▅▅▇ &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; lifeExp &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 59.47 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 12.92 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 23.60 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48.20 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.71 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 70.85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 82.6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ▁▆▇▇▇ &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; pop &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 29601212.32 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 106157896.74 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60011.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2793664.00 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7023595.50 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 19585221.75 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1318683096.0 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ▇▁▁▁▁ &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; gdpPercap &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7215.33 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9857.45 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 241.17 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1202.06 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3531.85 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9325.46 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 113523.1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ▇▁▁▁▁ &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

```r
str(gapminder)
```

```
# tibble [1,704 × 6] (S3: tbl_df/tbl/data.frame)
#  $ country  : Factor w/ 142 levels "Afghanistan",..: 1 1 1 1 1 1 1 1 1 1 ...
#  $ continent: Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
#  $ year     : int [1:1704] 1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
#  $ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
#  $ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
#  $ gdpPercap: num [1:1704] 779 821 853 836 740 ...
```

- We can use the `str()` function to learn more about the internal structure of any object. 




---
# Work with models
### &lt;p style="color:#00449E"&gt; gapminder data &lt;/p&gt;

- Let us consider the linear regression of `lifeExp` on `gdpPercap`, `pop`, and `continent`.


```r
out &lt;- lm(formula = lifeExp ~ gdpPercap + pop + continent,
          data = gapminder)

summary(out)
```

```
# 
# Call:
# lm(formula = lifeExp ~ gdpPercap + pop + continent, data = gapminder)
# 
# Residuals:
#     Min      1Q  Median      3Q     Max 
# -49.161  -4.486   0.297   5.110  25.175 
# 
# Coefficients:
#                    Estimate Std. Error t value Pr(&gt;|t|)    
# (Intercept)       4.781e+01  3.395e-01 140.819  &lt; 2e-16 ***
# gdpPercap         4.495e-04  2.346e-05  19.158  &lt; 2e-16 ***
# pop               6.570e-09  1.975e-09   3.326 0.000901 ***
# continentAmericas 1.348e+01  6.000e-01  22.458  &lt; 2e-16 ***
# continentAsia     8.193e+00  5.712e-01  14.342  &lt; 2e-16 ***
# continentEurope   1.747e+01  6.246e-01  27.973  &lt; 2e-16 ***
# continentOceania  1.808e+01  1.782e+00  10.146  &lt; 2e-16 ***
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# 
# Residual standard error: 8.365 on 1697 degrees of freedom
# Multiple R-squared:  0.5821,	Adjusted R-squared:  0.5806 
# F-statistic: 393.9 on 6 and 1697 DF,  p-value: &lt; 2.2e-16
```

```r
str(out)
```

```
# List of 13
#  $ coefficients : Named num [1:7] 4.78e+01 4.50e-04 6.57e-09 1.35e+01 8.19 ...
#   ..- attr(*, "names")= chr [1:7] "(Intercept)" "gdpPercap" "pop" "continentAmericas" ...
#  $ residuals    : Named num [1:1704] -27.6 -26.1 -24.5 -22.4 -20.3 ...
#   ..- attr(*, "names")= chr [1:1704] "1" "2" "3" "4" ...
#  $ effects      : Named num [1:1704] -2455.1 311.1 42.6 101.1 -17.2 ...
#   ..- attr(*, "names")= chr [1:1704] "(Intercept)" "gdpPercap" "pop" "continentAmericas" ...
#  $ rank         : int 7
#  $ fitted.values: Named num [1:1704] 56.4 56.4 56.5 56.5 56.4 ...
#   ..- attr(*, "names")= chr [1:1704] "1" "2" "3" "4" ...
#  $ assign       : int [1:7] 0 1 2 3 3 3 3
#  $ qr           :List of 5
#   ..$ qr   : num [1:1704, 1:7] -41.2795 0.0242 0.0242 0.0242 0.0242 ...
#   .. ..- attr(*, "dimnames")=List of 2
#   .. .. ..$ : chr [1:1704] "1" "2" "3" "4" ...
#   .. .. ..$ : chr [1:7] "(Intercept)" "gdpPercap" "pop" "continentAmericas" ...
#   .. ..- attr(*, "assign")= int [1:7] 0 1 2 3 3 3 3
#   .. ..- attr(*, "contrasts")=List of 1
#   .. .. ..$ continent: chr "contr.treatment"
#   ..$ qraux: num [1:7] 1.02 1.02 1 1.01 1.04 ...
#   ..$ pivot: int [1:7] 1 2 3 4 5 6 7
#   ..$ tol  : num 1e-07
#   ..$ rank : int 7
#   ..- attr(*, "class")= chr "qr"
#  $ df.residual  : int 1697
#  $ contrasts    :List of 1
#   ..$ continent: chr "contr.treatment"
#  $ xlevels      :List of 1
#   ..$ continent: chr [1:5] "Africa" "Americas" "Asia" "Europe" ...
#  $ call         : language lm(formula = lifeExp ~ gdpPercap + pop + continent, data = gapminder)
#  $ terms        :Classes 'terms', 'formula'  language lifeExp ~ gdpPercap + pop + continent
#   .. ..- attr(*, "variables")= language list(lifeExp, gdpPercap, pop, continent)
#   .. ..- attr(*, "factors")= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
#   .. .. ..- attr(*, "dimnames")=List of 2
#   .. .. .. ..$ : chr [1:4] "lifeExp" "gdpPercap" "pop" "continent"
#   .. .. .. ..$ : chr [1:3] "gdpPercap" "pop" "continent"
#   .. ..- attr(*, "term.labels")= chr [1:3] "gdpPercap" "pop" "continent"
#   .. ..- attr(*, "order")= int [1:3] 1 1 1
#   .. ..- attr(*, "intercept")= int 1
#   .. ..- attr(*, "response")= int 1
#   .. ..- attr(*, ".Environment")=&lt;environment: R_GlobalEnv&gt; 
#   .. ..- attr(*, "predvars")= language list(lifeExp, gdpPercap, pop, continent)
#   .. ..- attr(*, "dataClasses")= Named chr [1:4] "numeric" "numeric" "numeric" "factor"
#   .. .. ..- attr(*, "names")= chr [1:4] "lifeExp" "gdpPercap" "pop" "continent"
#  $ model        :'data.frame':	1704 obs. of  4 variables:
#   ..$ lifeExp  : num [1:1704] 28.8 30.3 32 34 36.1 ...
#   ..$ gdpPercap: num [1:1704] 779 821 853 836 740 ...
#   ..$ pop      : int [1:1704] 8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
#   ..$ continent: Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
#   ..- attr(*, "terms")=Classes 'terms', 'formula'  language lifeExp ~ gdpPercap + pop + continent
#   .. .. ..- attr(*, "variables")= language list(lifeExp, gdpPercap, pop, continent)
#   .. .. ..- attr(*, "factors")= int [1:4, 1:3] 0 1 0 0 0 0 1 0 0 0 ...
#   .. .. .. ..- attr(*, "dimnames")=List of 2
#   .. .. .. .. ..$ : chr [1:4] "lifeExp" "gdpPercap" "pop" "continent"
#   .. .. .. .. ..$ : chr [1:3] "gdpPercap" "pop" "continent"
#   .. .. ..- attr(*, "term.labels")= chr [1:3] "gdpPercap" "pop" "continent"
#   .. .. ..- attr(*, "order")= int [1:3] 1 1 1
#   .. .. ..- attr(*, "intercept")= int 1
#   .. .. ..- attr(*, "response")= int 1
#   .. .. ..- attr(*, ".Environment")=&lt;environment: R_GlobalEnv&gt; 
#   .. .. ..- attr(*, "predvars")= language list(lifeExp, gdpPercap, pop, continent)
#   .. .. ..- attr(*, "dataClasses")= Named chr [1:4] "numeric" "numeric" "numeric" "factor"
#   .. .. .. ..- attr(*, "names")= chr [1:4] "lifeExp" "gdpPercap" "pop" "continent"
#  - attr(*, "class")= chr "lm"
```

```r
out$coefficients
```

```
#       (Intercept)         gdpPercap               pop continentAmericas     continentAsia 
#      4.781408e+01      4.495058e-04      6.569823e-09      1.347594e+01      8.192632e+00 
#   continentEurope  continentOceania 
#      1.747269e+01      1.808330e+01
```

```r
out$residuals
```

```
#             1             2             3             4             5             6 
# -27.611428453 -26.104399813 -24.460636949 -22.438388173 -20.337265855 -18.019834243 
#             7             8             9            10            11            12 
# -16.676963374 -15.658977259 -14.731798900 -14.675330131 -14.370390444 -12.826300978 
#            13            14            15            16            17            18 
# -10.784882304  -6.889539586  -1.517781716  -0.320530593   0.898955244   2.038639144 
#            19            20            21            22            23            24 
#   3.482862209   5.012352638   5.149761523   6.205410711   8.271558758   8.443844996 
#            25            26            27            28            29            30 
#  -5.898886545  -3.551355709  -0.729959584   2.049545857   4.726814372   7.879970085 
#            31            32            33            34            35            36 
#  10.839820771  15.278337257  17.499181113  18.990511833  20.597365990  21.470488738 
#            37            38            39            40            41            42 
# -19.409417128 -17.565727037 -15.764848964 -14.346073141 -12.385081065  -9.723970419 
#            43            44            45            46            47            48 
#  -9.157441377  -9.052203353  -8.405704088  -7.939543527  -8.129075435  -7.321061828 
#            49            50            51            52            53            54 
#  -1.579640398  -0.102055919   0.505748307   0.573455646   1.367479116   2.483118673 
#            55            56            57            58            59            60 
#   4.414603867   5.167899447   6.170686118   6.817271471   8.843559356   8.020796946 
#            61            62            63            64            65            66 
#  -1.347338534  -0.553123157  -0.530017605  -1.404958094  -1.600538922  -0.741174435 
#            67            68            69            70            71            72 
#  -0.012168063   0.476628366   1.018196209   0.674918980   0.549875877  -0.275527560 
#            73            74            75            76            77            78 
#  -1.290936705  -1.827334439  -0.626124222  -0.964464482  -2.195831930  -2.043973498 
#            79            80            81            82            83            84 
#  -1.864548517  -1.044377465  -1.454314242  -0.908572714  -0.932205462  -1.750708775 
#            85            86            87            88            89            90 
#  -9.503813054  -7.405980108  -4.817510033  -2.739824233  -0.920093752   0.890848581 
#            91            92            93            94            95            96 
#   4.407285193   6.413647504   8.034208596   8.792978877   8.263942653   6.230139238 
#            97            98            99           100           101           102 
# -19.138320419 -17.293582240 -15.472648910 -13.290616320 -11.502880053  -9.908728717 
#           103           104           105           106           107           108 
#  -6.913499990  -4.207442142  -1.112329826   2.157864275   4.604234480   6.441494069 
#           109           110           111           112           113           114 
#  -1.094402253  -0.472758846  -0.037945218  -0.320125471  -1.404782817  -1.144938312 
#           115           116           117           118           119           120 
#  -0.852086905  -0.126986978  -0.389135444  -0.212698569  -0.738099284  -1.059066245 
#           121           122           123           124           125           126 
# -10.080212084  -7.900072686  -5.637021295  -3.410637768  -1.306292334   0.892492709 
#           127           128           129           130           131           132 
#   2.491574547   3.944011300   5.536738162   6.368839005   5.928644717   8.212982628 
#           133           134           135           136           137           138 
# -22.098438291 -20.377529620 -18.865992937 -17.447388444 -15.945694881 -12.895285052 
#           139           140           141           142           143           144 
#  -8.886959849  -5.317268249  -2.709611632  -0.785685212   1.003213919   2.485994347 
#           145           146           147           148           149           150 
# -11.922716414  -7.465605967  -4.147286255  -1.496808996   0.852475818   2.960311785 
#           151           152           153           154           155           156 
#   3.520878517   3.885503012   5.718474566   5.791026973   6.070298679   6.188167433 
#           157           158           159           160           161           162 
#  -0.577622109   1.388052465   3.260394676   4.934266083   7.188346318  10.054690344 
#           163           164           165           166           167           168 
#  11.617781971  13.010777986  11.346681869   0.844886562  -6.136973336  -2.747067946 
#           169           170           171           172           173           174 
# -11.692873259  -9.553766754  -7.624401693  -5.778237362  -4.689629176  -3.545805938 
#           175           176           177           178           179           180 
#  -1.961686726  -0.533434217   1.618051382   3.413497847   4.878946637   5.776512167 
#           181           182           183           184           185           186 
#  -6.833286986  -0.079453457   2.258235754   2.571737165   2.591272916   2.043687969 
#           187           188           189           190           191           192 
#   2.037987746   2.290422392   3.013278374   2.296512059   3.343146187   2.869041010 
#           193           194           195           196           197           198 
# -16.112641761 -13.216472261 -10.357172856  -7.508047171  -4.642986843  -2.049928643 
#           199           200           201           202           203           204 
#  -0.098506965   1.283101638   1.968764453   2.016540188   2.289005792   3.839737612 
#           205           206           207           208           209           210 
#  -8.951661421  -7.469220038  -5.948203585  -4.473598210  -3.988885194  -2.179241479 
#           211           212           213           214           215           216 
#  -0.624715789   0.083733365  -3.400196816  -2.736469252  -0.700866621   1.517478183 
#           217           218           219           220           221           222 
# -16.786177087 -14.870781200 -12.855044195 -10.872722597 -15.928181940 -25.068536581 
#           223           224           225           226           227           228 
#  -5.378194612  -2.455126533  -0.577093877   0.119812263   0.257504719   2.853092459 
#           229           230           231           232           233           234 
#  -9.851107976  -8.011514856  -5.838273176  -3.734759958  -1.568238902   0.686963322 
#           235           236           237           238           239           240 
#   4.021723130   5.930181952   5.611977245   3.530043169   1.067915086   1.581726488 
#           241           242           243           244           245           246 
#   2.253235162   2.943920040   3.833779773   3.476677146   2.916192172   2.833660964 
#           247           248           249           250           251           252 
#   4.011267296   3.426779595   4.631305728   4.105468317   3.288824302   2.817905691 
#           253           254           255           256           257           258 
# -12.841124971 -10.894516870  -8.885378684  -6.858132114  -4.850717315  -1.551988890 
#           259           260           261           262           263           264 
#   0.034582331   2.272486429   1.224282443  -2.105225727  -4.864718841  -3.419140736 
#           265           266           267           268           269           270 
# -10.269518851  -8.540273410  -6.743507133  -4.774019554  -2.766995716  -0.969641286 
#           271           272           273           274           275           276 
#   1.312228621   2.772691360   3.392075443   3.257504581   2.133161925   2.003667965 
#           277           278           279           280           281           282 
#  -8.357964791  -7.202225984  -5.449684788  -3.120693783  -0.382459839   3.554146693 
#           283           284           285           286           287           288 
#   6.908978809   8.626659065   9.332303670   9.881936091  11.623039952  11.235262841 
#           289           290           291           292           293           294 
# -15.841267356  -9.904317718 -16.098553851  -2.858265216   1.144514429   1.429126550 
#           295           296           297           298           299           300 
#   2.514006333   3.525546014   4.285358153   5.308890400   6.207153249   6.061624122 
#           301           302           303           304           305           306 
# -11.691956278  -7.311756216  -4.659099925  -2.660972463  -1.282608100   0.666884730 
#           307           308           309           310           311           312 
#   3.203833809   4.070523359   4.458871460   6.025783581   7.535538901   8.158912771 
#           313           314           315           316           317           318 
#  -7.595890538  -5.899619641  -3.980634291  -2.186792688   0.257326619   2.595827669 
#           319           320           321           322           323           324 
#   4.547062266   6.517784790   9.561444011  12.314904669  14.672301700  16.889971540 
#           325           326           327           328           329           330 
#  -9.114571240  -7.671612078  -6.209859799  -4.276378878  -2.382990741  -0.541750545 
#           331           332           333           334           335           336 
#  -0.534274009  -0.937602718  -2.745604452  -5.681439814  -3.320319720  -1.901294577 
#           337           338           339           340           341           342 
#  -6.664173936  -3.807888327  -0.493897322   3.014421472   5.639784373   6.335805560 
#           343           344           345           346           347           348 
#   6.675895159   7.753899526   6.797771602   3.563367902   3.567946066   5.850096596 
#           349           350           351           352           353           354 
#  -5.270963435  -2.615356498  -0.012570572   2.252819977   4.246287389   6.781960683 
#           355           356           357           358           359           360 
#   9.778420959  10.912904580  11.632988123  12.945494542  13.336049377  13.129308675 
#           361           362           363           364           365           366 
#  -7.980818244  -6.041420205  -3.686393433  -1.417659887   0.878016512   3.379176418 
#           367           368           369           370           371           372 
#   4.939689465   5.800658890   3.405189216  -0.722105031  -1.830001428  -0.298797411 
#           373           374           375           376           377           378 
#  -5.504391590  -2.493053098  -0.645896612   0.057109943   0.176157943   0.243020119 
#           379           380           381           382           383           384 
#  -0.799051324  -0.009563421   3.413371451   3.924887467   4.332761469   3.860283720 
#           385           386           387           388           389           390 
#  -4.419673318  -1.747117823   1.579538634   4.388695986   6.990129608   8.428246076 
#           391           392           393           394           395           396 
#   9.073667909   9.430611213  10.539512708  12.347110811  12.944061605  12.885746831 
#           397           398           399           400           401           402 
#  -1.567586719  -0.030549081  -0.006554931  -0.095502276  -0.953889234  -1.296290627 
#           403           404           405           406           407           408 
#  -1.306617511  -1.106154813   0.618863076   1.441655398   2.246248926   0.868324109 
#           409           410           411           412           413           414 
#   1.107972173   1.504383721   0.926921833   0.477570505  -0.330033888   0.189586959 
#           415           416           417           418           419           420 
#  -0.439293387  -1.810320482  -1.860727942  -2.608708907  -2.601108951  -2.848548106 
#           421           422           423           424           425           426 
# -14.202462172 -11.774370568  -9.479621106  -7.098446940  -5.109823145  -2.681850227 
#           427           428           429           430           431           432 
#  -0.298426207   0.929255509   2.718852342   4.488354946   4.698207882   6.037573029 
#           433           434           435           436           437           438 
# -16.006671420 -12.175444670  -8.600850580  -5.308982001  -2.674072816  -0.742429725 
#           439           440           441           442           443           444 
#   1.111689688   3.408758308   5.750290411   6.989910480   7.448689063   8.175309282 
#           445           446           447           448           449           450 
# -14.539545538 -11.660062170  -8.517511602  -6.706032099  -4.909240359  -3.030371781 
#           451           452           453           454           455           456 
#  -0.245624667   2.964672117   5.059207931   7.604136460  10.203071223  10.524034821 
#           457           458           459           460           461           462 
#  -6.704850498  -4.190178821  -1.768336304   0.454982431   2.184439680   3.998023047 
#           463           464           465           466           467           468 
#   6.316853508   9.889504112  13.763895327  17.092561730  19.373048966  20.487824728 
#           469           470           471           472           473           474 
# -17.411672779 -14.273493420 -10.698768604  -7.415475293  -5.139803978  -6.932132836 
#           475           476           477           478           479           480 
#  -6.557650238  -0.028986730   3.475616942   5.889858280   6.996674704   7.967457784 
#           481           482           483           484           485           486 
# -13.502357593 -12.024141476 -10.592706584  -9.240351365  -7.602155414  -6.222225571 
#           487           488           489           490           491           492 
#  -4.571016836  -2.586946027  -0.780491712  -0.837094261  -1.932100356  -1.702033018 
#           493           494           495           496           497           498 
# -12.043391504  -9.931915862  -7.838287642  -5.847763643  -3.918119152  -3.522925293 
#           499           500           501           502           503           504 
#  -4.177339722  -1.614488559   1.890822311   5.126648752   7.052887455   9.905386880 
#           505           506           507           508           509           510 
# -14.035917964 -11.467292585  -8.108827154  -6.114113959  -4.755764249  -3.781799825 
#           511           512           513           514           515           516 
#  -3.408217664  -1.670477766  -0.254691865   0.962748146   2.226261009   4.319730912 
#           517           518           519           520           521           522 
#  -1.651503423  -1.216886821  -0.778976419  -0.396368543  -0.901650346   0.187367612 
#           523           524           525           526           527           528 
#   0.900755631   0.007821479   1.099090508   1.145444444   0.370985602  -0.934962574 
#           529           530           531           532           533           534 
#  -1.315663522  -0.541879945   0.166633361   0.094031362  -0.486916735  -0.028700816 
#           535           536           537           538           539           540 
#   0.123386130   0.768756072   0.691791975   1.330475874   0.907113834   1.272470335 
#           541           542           543           544           545           546 
# -12.743784755 -11.054765359 -10.308951130  -6.976602722  -4.252854277  -4.803479479 
#           547           548           549           550           551           552 
#   1.951425576   7.037017639   7.467157808   6.021520547   3.309802898   2.974972551 
#           553           554           555           556           557           558 
# -18.034060338 -15.985361025 -14.190081927 -12.290255628  -9.849341078  -6.373777261 
#           559           560           561           562           563           564 
#  -2.614480522   1.170403513   4.523982972   7.744947324   9.920407274  11.284464014 
#           565           566           567           568           569           570 
#  -1.452368482  -1.232840707  -1.270955564  -1.616742078  -2.902305338  -2.520949877 
#           571           572           573           574           575           576 
#  -1.904720879  -2.025822504  -1.660570647  -0.976832880  -0.659066471  -0.882899694 
#           577           578           579           580           581           582 
#  -5.111378739  -3.546154981  -1.945331442  -0.303864982   1.469848316   3.426228275 
#           583           584           585           586           587           588 
#   5.461241681   7.441105526   9.164153274  10.169052894  10.004063299  11.460879935 
#           589           590           591           592           593           594 
#  -1.064642854   0.310132920   1.462963474   1.829277156   1.274947895   1.951103812 
#           595           596           597           598           599           600 
#   3.025690229   4.071427811   3.790388932   4.086031797   2.779276122   1.747215672 
#           601           602           603           604           605           606 
# -20.379199839 -18.348368401 -15.599977920 -12.762375781  -9.397994876  -7.492077173 
#           607           608           609           610           611           612 
#  -5.361880130  -2.464974897   0.031661723   2.861942439   5.430681266   6.555216942 
#           613           614           615           616           617           618 
# -14.451918336 -13.534013357 -12.390236613 -10.958345131  -9.330501810  -7.473025575 
#           619           620           621           622           623           624 
#  -5.339364534  -2.661309117   0.358930538   3.197219478   5.379010498   7.703837696 
#           625           626           627           628           629           630 
# -15.452677663 -14.523119815 -13.564860553 -12.647686397 -11.700882616 -10.697723169 
#           631           632           633           634           635           636 
#  -8.869246567  -6.906195057  -4.890107371  -3.307026146  -2.577615036  -1.696117483 
#           637           638           639           640           641           642 
# -24.559310561 -21.393312837 -18.533090698 -15.728099494 -14.022576746 -12.241778308 
#           643           644           645           646           647           648 
# -10.767202174  -8.511295238  -6.897206512  -5.267556566  -3.774039090  -0.970026621 
#           649           650           651           652           653           654 
# -20.374623179 -17.634774962 -14.292641998 -11.523417589  -8.562680999  -5.347954635 
#           655           656           657           658           659           660 
#  -1.808378888   1.814354214   3.690381448   4.909784070   5.837763443   7.263816043 
#           661           662           663           664           665           666 
#   3.566342951   7.094021890   9.512202665  11.182811557  12.228192668  12.534940681 
#           667           668           669           670           671           672 
#  12.863660552  11.149191606  10.427304539  11.194703627  11.864735203   8.298823037 
#           673           674           675           676           677           678 
#  -3.685262538  -1.656507432  -0.786813614  -0.046317796  -0.165928049  -0.654562187 
#           679           680           681           682           683           684 
#  -1.606599744  -1.613992581  -0.920585957   0.420962391   0.564548687  -0.109305306 
#           685           686           687           688           689           690 
#   3.935388876   4.026912156   3.739576615   2.454553702   2.070533317   1.986752649 
#           691           692           693           694           695           696 
#   1.241868923  -0.160514915   2.178978152   1.047821256   1.203297796   0.204772132 
#           697           698           699           700           701           702 
# -21.323369047 -18.710004321 -15.680340937 -12.453041335  -9.406256919  -6.329578096 
#           703           704           705           706           707           708 
#  -4.446797864  -3.069679136  -2.036003783  -1.197917680  -0.707224113   0.293899330 
#           709           710           711           712           713           714 
# -19.414763705 -17.066889715 -14.521067445 -11.103792002  -8.099961051  -4.824501965 
#           715           716           717           718           719           720 
#  -1.536989894   2.232279734   4.388845648   7.322909107   9.902822381  11.583082118 
#           721           722           723           724           725           726 
# -12.615580843 -10.434730038  -8.714217331  -6.367170260  -5.295305712  -3.881804050 
#           727           728           729           730           731           732 
#  -0.089680902   3.706370112   6.086017892   7.904704570   8.850941369   9.284156515 
#           733           734           735           736           737           738 
# -12.578815400 -10.410884117  -8.346936735  -5.618423114  -3.427296677  -2.274225206 
#           739           740           741           742           743           744 
#  -0.587709344   3.694750891   1.653253046   1.285009462  -1.092050740   1.347853831 
#           745           746           747           748           749           750 
#  -0.738217401   1.077501612   2.003694977   2.332953283   1.689221694   1.709302737 
#           751           752           753           754           755           756 
#   2.118357656   2.814038876   2.264066230  -0.211620702  -2.847086450  -4.712861693 
#           757           758           759           760           761           762 
#   7.535725317   9.399801622  10.174085523  10.952558204   9.855150551  11.048920169 
#           763           764           765           766           767           768 
#  11.510372440  11.869022470  12.776594117  12.832803297  13.802985623  13.223207556 
#           769           770           771           772           773           774 
#  -1.876623008  -0.608695250  -0.086339807   0.922088128   1.030947413   1.416782213 
#           775           776           777           778           779           780 
#   1.888105590   2.126762020   1.884534359   2.064033278   2.000837500   2.034954977 
#           781           782           783           784           785           786 
#  -4.072297325  -0.828192803   1.950883059   3.454661658   4.355278175   5.816507110 
#           787           788           789           790           791           792 
#   7.177254691   7.609774983   7.131795267   7.754001771   7.595280285   7.967935393 
#           793           794           795           796           797           798 
#   5.009228746   6.950908399   9.137450163  10.334247733  10.065932118  11.158707567 
#           799           800           801           802           803           804 
#  11.611794331  11.803056566  10.478523592  10.902556915  12.300560848  11.529262822 
#           805           806           807           808           809           810 
# -13.548048199 -11.190419191  -8.942287297  -5.618409054  -0.438153154   3.832411174 
#           811           812           813           814           815           816 
#   5.846289648   7.844055249  10.440360363  12.096933989  13.493108104  14.456997436 
#           817           818           819           820           821           822 
#  -5.970217627  -3.601585470  -0.325286564   2.297956017   5.116331619   7.675857046 
#           823           824           825           826           827           828 
#  10.229853698  10.773455461  10.703339513   5.795687374   2.392970282   5.404230026 
#           829           830           831           832           833           834 
#  -6.498142154  -2.693775529  -0.151396961   2.888864291   6.215279341   9.199229140 
#           835           836           837           838           839           840 
#  11.131441823  12.669127262  12.160332587  10.818474407   9.769111363  10.421109334 
#           841           842           843           844           845           846 
#  -9.154589325  -4.142946106  -1.578882740   0.599184578   5.022771225   6.426463919 
#           847           848           849           850           851           852 
#   8.330379783   9.694167939  10.508552639  11.147752976  12.077352430  11.798950866 
#           853           854           855           856           857           858 
# -49.161252920 -49.004410306 -38.448034718 -27.749203615 -37.452737251 -13.311375357 
#           859           860           861           862           863           864 
#   1.198631868   5.515466810   3.471424613   2.022331033   5.101222506   0.300064400 
#           865           866           867           868           869           870 
#  -2.261440054   0.734072170   3.506165509   5.148748694   6.031509559   6.179235914 
#           871           872           873           874           875           876 
#   7.521551923   9.481959649  10.166677520  10.300345970  10.810458178  11.258221464 
#           877           878           879           880           881           882 
#  -5.815330659  -2.923454556  -0.258052975   0.447234416   1.722368244   4.050651379 
#           883           884           885           886           887           888 
#   6.896271891   9.007500703  11.419689191   7.197714422  -3.807728167  -5.940724695 
#           889           890           891           892           893           894 
#  -9.598473587  -8.613619835  -7.604463680  -6.607252850  -5.570774608  -4.349099515 
#           895           896           897           898           899           900 
#  -3.232141754  -2.029489172  -7.310811999  -5.881364003  -4.318474574  -2.343385502 
#           901           902           903           904           905           906 
#  -6.170994465  -4.082996268  -3.052875457  -6.037096149  -4.500215040  -0.257156086 
#           907           908           909           910           911           912 
#   6.513609874  13.104009400  16.578949830  19.453979888  20.601758518  20.678344790 
#           913           914           915           916           917           918 
# -11.813011992  -9.697476929  -7.742260226  -5.709209003  -3.795597869  -1.679823734 
#           919           920           921           922           923           924 
#   0.509015130   0.947109653   3.851911495   6.627513592   8.961549219  11.033363285 
#           925           926           927           928           929           930 
# -11.743189703 -10.815402020  -9.620261745  -8.577061890  -6.341951186  -4.382237001 
#           931           932           933           934           935           936 
#  -2.499249847  -0.694154349   1.286968075  -0.698717892  -3.181874795   0.060032860 
#           937           938           939           940           941           942 
#  -8.411150774  -4.769191286  -1.243815230   2.273715581   5.647436767   7.444224991 
#           943           944           945           946           947           948 
#   9.686680497  11.026176203  11.294470070  11.241964151  12.300306590  12.474127244 
#           949           950           951           952           953           954 
# -14.357622593 -12.755376475 -11.131926569  -9.606308164  -8.136697055  -6.451266042 
#           955           956           957           958           959           960 
#  -4.221856615  -1.807771568   0.186437309   1.672038370   3.506747523   6.105228392 
#           961           962           963           964           965           966 
#  -7.611831322  -5.863489086  -4.048243768  -2.171975818  -0.099133608   2.355220013 
#           967           968           969           970           971           972 
#   5.108478887   7.679805958   9.893053505  11.933181823  13.704558099  15.517910844 
#           973           974           975           976           977           978 
#   2.283920470   9.356603406  11.290485626  12.625034992  13.966633503  15.441814956 
#           979           980           981           982           983           984 
#  17.232609852  18.768821613  19.200499744  19.576470200  20.076678260  20.053472926 
#           985           986           987           988           989           990 
# -12.262502097  -8.187221774  -5.320642495  -4.082130159  -2.357696233  -0.126838398 
#           991           992           993           994           995           996 
#   1.324043969   3.776211444   5.328213030   7.359507568   8.109914330   8.806843661 
#           997           998           999          1000 
# -14.121536893 -11.174752909  -8.237184894  -5.312374905 
#  [ reached getOption("max.print") -- omitted 704 entries ]
```

```r
out$fitted.values
```

```
#         1         2         3         4         5         6         7         8         9 
#  56.41243  56.43640  56.45764  56.45839  56.42527  56.45783  56.53096  56.48098  56.40580 
#        10        11        12        13        14        15        16        17        18 
#  56.43833  56.49939  56.65430  66.01488  66.16954  66.33778  66.54053  66.79104  66.89136 
#        19        20        21        22        23        24        25        26        27 
#  66.93714  66.98765  66.43124  66.74459  67.37944  67.97916  48.97589  49.23636  49.03296 
#        28        29        30        31        32        33        34        35        36 
#  49.35745  49.79119  50.13403  50.52818  50.52066  50.24482  50.16149  50.39663  50.83051 
#        37        38        39        40        41        42        43        44        45 
#  49.42442  49.56473  49.76485  50.33107  50.31308  49.20697  49.09944  48.95820  49.05270 
#        46        47        48        49        50        51        52        53        54 
#  48.90254  49.13208  50.05206  64.06464  64.50106  64.63625  65.06054  65.69752  65.99788 
#        55        56        57        58        59        60        61        62        63 
#  65.52740  65.60610  65.69731  66.45773  65.49644  67.29920  70.46734  70.88312  71.46002 
#        64        65        66        67        68        69        70        71        72 
#  72.50496  73.53054  74.23117  74.75217  75.84337  76.54180  78.15508  79.82012  81.51053 
#        73        74        75        76        77        78        79        80        81 
#  68.09094  69.30733  70.16612  71.10446  72.82583  74.21397  75.04455  75.98438  77.49431 
#        82        83        84        85        86        87        88        89        90 
#  78.41857  79.91221  81.57971  60.44281  61.23798  61.74051  62.66282  64.22009  64.70215 
#        91        92        93        94        95        96        97        98        99 
#  64.64471  64.33635  64.56679  65.13202  66.53106  69.40486  56.62232  56.64158  56.68865 
#       100       101       102       103       104       105       106       107       108 
#  56.74362  56.75488  56.83173  56.92250  57.02644  57.13033  57.25414  57.40877  57.62051 
#       109       110       111       112       113       114       115       116       117 
#  69.09440  69.71276  70.28795  71.26013  72.84478  73.94494  74.78209  75.47699  76.84914 
#       118       119       120       121       122       123       124       125       126 
#  77.74270  79.05810  80.50007  48.30321  48.25807  48.25502  48.29564  48.32029  48.29751 
#       127       128       129       130       131       132       133       134       135 
#  48.41243  48.39299  48.38226  48.40816  48.47736  48.51502  62.51244  62.26753  62.29399 
#       136       137       138       139       140       141       142       143       144 
#  62.47939  62.65969  62.91829  62.74596  62.56827  62.66661  62.83569  62.87979  63.06801 
#       145       146       147       148       149       150       151       152       153 
#  65.74272  65.91561  66.07729  66.28681  66.59752  66.89969  67.16912  67.25450  66.45953 
#       154       155       156       157       158       159       160       161       162 
#  67.45297  68.01970  68.66383  48.19962  48.22995  48.25961  48.36373  48.83565  49.26431 
#       163       164       165       166       167       168       169       170       171 
#  49.86622  50.61122  51.39832  51.71111  52.77097  53.47507  62.60987  62.83877  63.28940 
#       172       173       174       175       176       177       178       179       180 
#  63.41024  64.19363  65.03481  65.29769  65.73843  65.43895  65.97450  66.12705  66.61349 
#       181       182       183       184       185       186       187       188       189 
#  66.43329  66.68945  67.25176  67.84826  68.30873  68.76631  69.04201  69.04958  68.17672 
#       190       191       192       193       194       195       196       197       198 
#  68.02349  68.79685  70.13596  48.08764  48.12247  48.17117  48.20505  48.23399  48.18693 
#       199       200       201       202       203       204       205       206       207 
#  48.22051  48.27390  48.29124  48.30746  48.36099  48.45526  47.98266  48.00222  47.99320 
#       208       209       210       211       212       213       214       215       216 
#  48.02160  48.04589  48.08924  48.09572  48.12727  48.13620  48.06247  48.06087  48.06252 
#       217       218       219       220       221       222       223       224       225 
#  56.20318  56.23678  56.27004  56.28772  56.24518  56.28854  56.33519  56.36913  56.38009 
#       226       227       228       229       230       231       232       233       234 
#  56.41419  56.49450  56.86991  48.37411  48.43951  48.48127  48.53376  48.61724  48.66804 
#       235       236       237       238       239       240       241       242       243 
#  48.93928  49.05482  48.70202  48.66896  48.78808  48.84827  66.49676  67.01608  67.46622 
#       244       245       246       247       248       249       250       251       252 
#  68.65332  69.96381  71.37634  71.74873  73.43322  73.31869  74.50453  76.48118  77.83509 
#       253       254       255       256       257       258       259       260       261 
#  48.30412  48.35852  48.36038  48.33613  48.30772  48.32699  48.26042  48.21251  48.17172 
#       262       263       264       265       266       267       268       269       270 
#  48.17123  48.17272  48.16014  48.36152  48.42127  48.45951  48.37502  48.33600  48.35264 
#       271       272       273       274       275       276       277       278       279 
#  48.20477  48.27831  48.33192  48.31550  48.39184  48.64733  63.10296  63.27623  63.37368 
#       280       281       282       283       284       285       286       287       288 
#  63.64369  63.82346  63.49785  63.65602  63.86534  64.79370  65.93406  66.23696  67.31774 
#       289       290       291       292       293       294       295       296       297 
#  59.84127  60.45328  60.59991  61.23939  61.97437  62.53823  63.01099  63.74845  64.40464 
#       298       299       300       301       302       303       304       305       306 
#  65.11711  65.82085  66.89938  62.33496  62.42976  62.52210  62.62397  62.90561  63.17012 
#       307       308       309       310       311       312       313       314       315 
#  63.44917  63.69748  63.96213  64.28722  64.14646  64.73009  48.31089  48.35962  48.44763 
#       316       317       318       319       320       321       322       323       324 
#  48.65879  48.68667  48.34317  48.38594  48.40822  48.37756  48.34510  48.30170  48.26203 
#       325       326       327       328       329       330       331       332       333 
#  48.25757  48.32361  48.33186  48.33238  48.37199  48.34575  48.31827  48.34960  48.29360 
#       334       335       336       337       338       339       340       341       342 
#  48.26844  48.28632  48.36329  48.77517  48.86089  48.92890  49.02558  49.26722  49.28919 
#       343       344       345       346       347       348       349       350       351 
#  50.01910  49.71610  49.63523  49.39863  49.40205  49.47190  62.47696  62.64136  62.85457 
#       352       353       354       355       356       357       358       359       360 
#  63.17118  63.60271  63.96804  63.67158  63.83910  64.08001  64.31451  64.78695  65.65269 
#       361       362       363       364       365       366       367       368       369 
#  48.45782  48.51042  48.61639  48.76766  48.92298  48.99482  49.04331  48.85434  48.63881 
#       370       371       372       373       374       375       376       377       378 
#  48.71311  48.66200  48.62680  66.71439  67.26305  67.77590  68.44289  69.43384  70.39698 
#       379       380       381       382       383       384       385       386       387 
#  71.25905  71.52956  69.11363  69.75511  70.54324  71.88772  63.84067  64.07212  63.66646 
#       388       389       390       391       392       393       394       395       396 
#  63.90130  63.73287  64.22075  64.64333  64.74339  63.87449  63.80389  64.21394  65.38725 
#       397       398       399       400       401       402       403       404       405 
#  68.43759  69.06055  69.90655  70.47550  71.24389  72.00629  72.26662  72.68615  71.78114 
#       406       407       408       409       410       411       412       413       414 
#  72.56834  73.26375  75.61768  69.67203  70.30562  71.42308  72.48243  73.80003  74.50041 
#       415       416       417       418       419       420       421       422       423 
#  75.06929  76.61032  77.19073  78.71871  79.78111  81.18055  49.01446  49.10237  49.17262 
#       424       425       426       427       428       429       430       431       432 
#  49.17245  49.47582  49.20085  49.11043  49.11074  48.88515  48.66865  48.67479  48.75343 
#       433       434       435       436       437       438       439       440       441 
#  61.93467  62.00344  62.05985  62.05998  62.30507  62.53043  62.61531  62.63724  62.70671 
#       442       443       444       445       446       447       448       449       450 
#  62.96709  63.39831  64.05969  62.89655  63.01606  63.15751  63.38403  63.70524  64.34037 
#       451       452       453       454       455       456       457       458       459 
#  64.58762  64.26633  64.55379  64.70786  63.96993  64.46997  48.59785  48.63418  48.76034 
#       460       461       462       463       464       465       466       467       468 
#  48.83802  48.95256  49.32098  49.68915  49.90750  49.91010  50.12444  50.43295  50.85018 
#       469       470       471       472       473       474       475       476       477 
#  62.67367  62.84349  63.00577  63.27048  63.34680  63.62813  63.16165  63.18299  63.32238 
#       478       479       480       481       482       483       484       485       486 
#  63.64514  63.73733  63.91054  47.98436  48.00714  48.07771  48.22735  48.11816  48.24623 
#       487       488       489       490       491       492       493       494       495 
#  48.23302  48.25095  48.32549  49.08209  51.28010  53.28103  47.97139  47.97892  47.99629 
#       496       497       498       499       500       501       502       503       504 
#  48.03676  48.06012  48.05793  48.06734  48.06749  48.10018  48.25135  48.18711  48.13461 
#       505       506       507       508       509       510       511       512       513 
#  48.11392  48.13429  48.16783  48.22911  48.27076  48.29180  48.32422  48.35448  48.34569 
#       514       515       516       517       518       519       520       521       522 
#  48.43925  48.49874  48.62727  68.20150  68.70689  69.52898  70.22637  71.77165  72.33263 
#       523       524       525       526       527       528       529       530       531 
#  73.64924  74.82218  74.60091  75.98456  77.99901  80.24796  68.72566  69.47188  70.34337 
#       532       533       534       535       536       537       538       539       540 
#  71.45597  72.86692  73.85870  74.76661  75.57124  76.76821  77.30952  78.68289  79.38453 
#       541       542       543       544       545       546       547       548       549 
#  49.74678  50.05377  50.79795  51.57460  52.94285  57.59348  54.61257  53.15298  53.89884 
#       550       551       552       553       554       555       556       557       558 
#  54.43948  53.45120  53.76003  48.03406  48.05036  48.08608  48.14726  48.15734  48.21578 
#       559       560       561       562       563       564       565       566       567 
#  48.19448  48.09460  48.12002  48.11605  48.12059  48.16354  68.95237  70.33284  71.57096 
#       568       569       570       571       572       573       574       575       576 
#  72.41674  73.90231  75.02095  75.70472  76.87282  77.73057  78.31683  79.32907  80.28890 
#       577       578       579       580       581       582       583       584       585 
#  48.26038  48.32515  48.39733  48.37586  48.40515  48.32977  48.28276  48.28789  48.33685 
#       586       587       588       589       590       591       592       593       594 
#  48.38695  48.44894  48.56112  66.92464  67.54987  68.04704  69.17072  71.06505  71.72890 
#       595       596       597       598       599       600       601       602       603 
#  72.21431  72.59857  73.23961  73.78297  75.47672  77.73578  62.40220  62.49037  62.55398 
#       604       605       606       607       608       609       610       611       612 
#  62.77838  63.13599  63.52108  63.49888  63.24697  63.34134  63.46006  63.54732  63.70378 
#       613       614       615       616       617       618       619       620       621 
#  48.06092  48.09201  48.14324  48.15535  48.17250  48.23503  48.23036  48.21331  48.21707 
#       622       623       624       625       626       627       628       629       630 
#  48.25778  48.29699  48.30316  47.95268  48.01212  48.05286  48.13969  48.18688  48.16272 
#       631       632       633       634       635       636       637       638       639 
#  48.19625  48.15120  48.15611  48.18003  48.08162  48.08412  62.13831  62.08931  62.12309 
#       640       641       642       643       644       645       646       647       648 
#  61.97110  62.06458  62.16478  62.22820  62.14730  61.98621  61.93856  61.91104  61.88603 
#       649       650       651       652       653       654       655       656       657 
#  62.28662  62.29977  62.33364  62.44742  62.44668  62.74995  62.71738  62.67765  62.70862 
#       658       659       660       661       662       663       664       665       666 
#  62.74922  62.72724  62.93418  57.39366  57.65598  58.13780  58.81719  59.77181  61.06506 
#       667       668       669       670       671       672       673       674       675 
#  62.58634  65.05081  67.17370  68.80530  69.63026  73.90918  67.71526  68.06651  68.74681 
#       676       677       678       679       680       681       682       683       684 
#  69.54632  69.92593  70.60456  70.99660  71.19399  70.09059  70.61904  72.02545  73.44731 
#       685       686       687       688       689       690       691       692       693 
#  68.55461  69.44309  69.94042  71.27545  72.38947  74.12325  75.74813  77.39051  76.59102 
#       694       695       696       697       698       699       700       701       702 
#  77.90218  79.29670  81.55223  58.69637  58.95900  59.28534  59.64604  60.05726  60.53758 
#       703       704       705       706       707       708       709       710       711 
#  61.04280  61.62268  62.25900  62.96292  63.58622  64.40410  56.88276  56.98489  57.03907 
#       712       713       714       715       716       717       718       719       720 
#  57.06779  57.30296  57.52650  57.69599  57.90472  58.29215  58.71809  58.68518  59.06692 
#       721       722       723       724       725       726       727       728       729 
#  57.48458  57.61573  58.03922  58.83617  60.52931  61.58380  59.70968  59.33363  59.65598 
#       730       731       732       733       734       735       736       737       738 
#  60.13730  60.60006  61.67984  57.89882  58.84788  59.80394  60.07742  60.37730  62.68723 
#       739       740       741       742       743       744       745       746       747 
#  62.62571  61.34925  57.80775  57.52599  58.13805  58.19715  67.64822  67.82250  68.28631 
#       748       749       750       751       752       753       754       755       756 
#  68.74705  69.59078  70.32070  70.98164  71.54596  73.20293  76.33362  80.63009  83.59786 
#       757       758       759       760       761       762       763       764       765 
#  57.85427  58.44020  59.21591  59.79744  61.77485  62.01108  62.93963  63.73098  64.15341 
#       766       767       768       769       770       771       772       773       774 
#  65.43620  65.89301  67.52179  67.81662  68.41870  69.32634  70.13791  71.15905  72.06322 
#       775       776       777       778       779       780       781       782       783 
#  73.09189  74.29324  75.55547  76.75597  78.23916  78.51105  62.60230  63.43819  63.65912 
#       784       785       786       787       788       789       790       791       792 
#  64.05534  64.64472  64.29349  64.03275  64.16023  64.63420  64.50800  64.45172  64.59906 
#       793       794       795       796       797       798       799       800       801 
#  58.02077  58.54909  59.59255  61.09575  63.35407  64.22129  65.49821  66.86694  68.88148 
#       802       803       804       805       806       807       808       809       810 
#  69.78744  69.69944  71.07374  56.70605  56.85942  57.06829  57.24741  56.96615  57.30159 
#       811       812       813       814       815       816       817       818       819 
#  57.89271  58.02494  57.57464  57.67507  57.76989  58.07800  48.24022  48.28759  48.27429 
#       820       821       822       823       824       825       826       827       828 
#  48.35604  48.44267  48.47914  48.53615  48.56554  48.58166  48.61131  48.59903  48.70577 
#       829       830       831       832       833       834       835       836       837 
#  56.55414  56.77478  56.80740  57.05314  57.76772  57.95977  57.96856  57.97787  57.81767 
#       838       839       840       841       842       843       844       845       846 
#  56.90853  56.89289  56.87589  56.60759  56.82395  56.87088  57.11682  57.58923  58.33954 
#       847       848       849       850       851       852       853       854       855 
#  58.79262  60.11583  61.73545  63.49925  64.96765  66.82405 104.72625 107.03741  98.91803 
#       856       857       858       859       860       861       862       863       864 
#  92.37320 105.16474  82.65438  70.11037  68.65853  71.71858  74.13367  71.80278  77.28794 
#       865       866       867       868       869       870       871       872       873 
#  58.18944  58.75493  58.58783  58.72125  59.38949  59.91976  59.46145  58.44404  59.12532 
#       874       875       876       877       878       879       880       881       882 
#  59.96465  60.21754  60.73478  47.95333  47.97045  48.00505  48.04477  48.04463  48.15735 
#       883       884       885       886       887       888       889       890       891 
#  48.18173  48.17250  48.26531  48.36029  48.40073  48.53272  48.07847  48.09962  48.10646 
#       892       893       894       895       896       897       898       899       900 
#  48.14325  48.18477  48.11310  48.08414  48.05649  48.11281  48.10236  48.07147  48.02139 
#       901       902       903       904       905       906       907       908       909 
#  48.89399  49.37200  50.86088  56.26410  57.27322  57.69916  55.64139  53.12999  52.17605 
#       910       911       912       913       914       915       916       917       918 
#  52.10102  52.13524  53.27366  48.49401  48.56248  48.59026  48.59021  48.64660  48.56082 
#       919       920       921       922       923       924       925       926       927 
#  48.45998  48.40289  48.36209  48.35049  48.32445  48.40964  47.99919  48.02240  48.03026 
#       928       929       930       931       932       933       934       935       936 
#  48.06406  48.10795  48.14924  48.14125  48.15115  48.13303  48.19372  48.19087  48.24297 
#       937       938       939       940       941       942       943       944       945 
#  56.87415  56.87119  56.98082  57.09728  57.36256  57.81178  58.31332  58.47382  59.39853 
#       946       947       948       949       950       951       952       953       954 
#  60.69604  60.74369  61.76687  48.04262  48.06238  48.06793  48.09331  48.11370  48.16527 
#       955       956       957       958       959       960       961       962       963 
#  48.13786  48.17177  48.20156  48.23096  48.31125  48.36177  48.15483  48.20149  48.29624 
#       964       965       966       967       968       969       970       971       972 
#  48.46098  48.53613  48.49678  48.49052  48.46519  48.43995  48.49682  48.54244  48.64609 
#       973       974       975       976       977       978       979       980       981 
#  48.70208  48.73240  48.95551  48.93197  48.97737  49.48819  49.47839  49.97118  50.54450 
#       982       983       984       985       986       987       988       989       990 
#  51.15953  51.87732  52.74753  63.05150  63.37722  63.61964  64.19213  64.71870  65.15884 
#       991       992       993       994       995       996       997       998       999 
#  66.08096  65.72179  66.12679  66.31049  66.79209  67.38816  56.36554  56.42275  56.48818 
#      1000 
#  56.56537 
#  [ reached getOption("max.print") -- omitted 704 entries ]
```




---
# Work with models
### &lt;p style="color:#00449E"&gt; Generate predictions to graph &lt;/p&gt;

- Having fitted a model, then, we might want to get a picture of the predictions the model produces over the range of some particular variable.


```r
min_gdp &lt;- min(gapminder$gdpPercap)
max_gdp &lt;- max(gapminder$gdpPercap)
med_pop &lt;- median(gapminder$pop)

pred_df &lt;- expand.grid(gdpPercap = (seq(from = min_gdp,
                                        to = max_gdp,
                                        length.out = 100)),
                       pop = med_pop,
                       continent = c("Africa", "Americas",
                                     "Asia", "Europe", "Oceania"))
dim(pred_df); head(pred_df)
```

```
# [1] 500   3
```

```
#   gdpPercap     pop continent
# 1  241.1659 7023596    Africa
# 2 1385.4282 7023596    Africa
# 3 2529.6905 7023596    Africa
# 4 3673.9528 7023596    Africa
# 5 4818.2150 7023596    Africa
# 6 5962.4773 7023596    Africa
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Generate predictions to graph &lt;/p&gt;

- Now we can use `predict()`
  - It needs some new data to fit the model to. 
  - If we specify `interval = 'predict'` as an argument, it will calculate 95% prediction intervals in addition to the point estimate.


```r
pred_out &lt;- predict(object = out,
                    newdata = pred_df,
                    interval = "predict")
head(pred_out)
```

```
#        fit      lwr      upr
# 1 47.96863 31.54775 64.38951
# 2 48.48298 32.06231 64.90365
# 3 48.99733 32.57670 65.41797
# 4 49.51169 33.09092 65.93245
# 5 50.02604 33.60497 66.44711
# 6 50.54039 34.11885 66.96193
```





---
# Work with models
### &lt;p style="color:#00449E"&gt; Generate predictions to graph &lt;/p&gt;

-  We can bind the two data frames, `pred_df` and `pred_out`, together by column.
  - This is because `pred_df` and `pred_out` correspond row for row.


```r
pred_df &lt;- cbind(pred_df, pred_out)
head(pred_df)
```

```
#   gdpPercap     pop continent      fit      lwr      upr
# 1  241.1659 7023596    Africa 47.96863 31.54775 64.38951
# 2 1385.4282 7023596    Africa 48.48298 32.06231 64.90365
# 3 2529.6905 7023596    Africa 48.99733 32.57670 65.41797
# 4 3673.9528 7023596    Africa 49.51169 33.09092 65.93245
# 5 4818.2150 7023596    Africa 50.02604 33.60497 66.44711
# 6 5962.4773 7023596    Africa 50.54039 34.11885 66.96193
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Generate predictions to graph &lt;/p&gt;


```r
p &lt;- ggplot(data = subset(pred_df, continent %in% c("Europe", "Africa")),
            aes(x = gdpPercap, 
                y = fit, ymin = lwr, ymax = upr,
                color = continent, fill = continent, group = continent))
p + geom_point(data = subset(gapminder,
                             continent %in% c("Europe", "Africa")),
               aes(x = gdpPercap, y = lifeExp,
                   color = continent),
               alpha = 0.5,
               inherit.aes = FALSE) + 
    geom_line() +
    geom_ribbon(alpha = 0.2, color = FALSE) + # the area covered by the prediction intervals
    scale_x_log10(labels = scales::dollar)
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Tidy model objects with `broom` &lt;/p&gt;

- The `broom` package to help us do a lot of things with our model output.

- `broom` can tidily extract three kinds of information. 
  - We can see *component-level* information about aspects of the model itself, such as **coefficients** and **t-statistics**. 
  - We can obtain *observation-level* information about the model's connection to the underlying data, such as **fitted values** and **residuals**. 
  - We can get *model-level* information that summarizes the fit as a whole, such as **F-statistic**, **model deviance**, or **r-squared**. 


```r
library(broom)
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Get component-level statistics with `tidy()` &lt;/p&gt;

- The `tidy()` function takes a model object and returns a data frame of component-level information.


```r
out_comp &lt;- tidy(out)
out_comp %&gt;% round_df()
```

```
# # A tibble: 7 × 5
#   term              estimate std.error statistic p.value
#   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
# 1 (Intercept)          47.8       0.34    141.         0
# 2 gdpPercap             0         0        19.2        0
# 3 pop                   0         0         3.33       0
# 4 continentAmericas    13.5       0.6      22.5        0
# 5 continentAsia         8.19      0.57     14.3        0
# 6 continentEurope      17.5       0.62     28.0        0
# 7 continentOceania     18.1       1.78     10.2        0
```




---
# Work with models
### &lt;p style="color:#00449E"&gt; Get component-level statistics with `tidy()` &lt;/p&gt;

- We can work with `tidy()` to make plots in a familiar way, and much more easily.


```r
p &lt;- ggplot(out_comp, mapping = aes(x = term,
                                    y = estimate))

p + geom_point() + coord_flip() 
```




---
# Work with models
### &lt;p style="color:#00449E"&gt; Get component-level statistics with `tidy()` &lt;/p&gt;

- We can tell `tidy()` to calculate confidence intervals for the estimates, using R's `conf.int = TRUE` option.


```r
out_conf &lt;- tidy(out, conf.int = TRUE)
out_conf %&gt;% round_df()
```

```
# # A tibble: 7 × 7
#   term              estimate std.error statistic p.value conf.low conf.high
#   &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
# 1 (Intercept)          47.8       0.34    141.         0    47.2      48.5 
# 2 gdpPercap             0         0        19.2        0     0         0   
# 3 pop                   0         0         3.33       0     0         0   
# 4 continentAmericas    13.5       0.6      22.5        0    12.3      14.6 
# 5 continentAsia         8.19      0.57     14.3        0     7.07      9.31
# 6 continentEurope      17.5       0.62     28.0        0    16.2      18.7 
# 7 continentOceania     18.1       1.78     10.2        0    14.6      21.6
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Get component-level statistics with `tidy()` &lt;/p&gt;



```r
out_conf &lt;- subset(out_conf, term != "(Intercept)")
out_conf$nicelabs &lt;- prefix_strip(out_conf$term, "continent")
```


---
# Work with models
### &lt;p style="color:#00449E"&gt; Get component-level statistics with `tidy()` &lt;/p&gt;

- We can use `geom_pointrange()` to make a figure that displays some information about our confidence in the variable estimates


```r
p &lt;- ggplot(out_conf, mapping = aes(x = reorder(nicelabs, estimate),
                                    y = estimate, ymin = conf.low, ymax = conf.high))
p + geom_pointrange() + coord_flip() + labs(x="", y="OLS Estimate")
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Get observation-level statistics with `augment()` &lt;/p&gt;

- The values returned by `augment()` are all statistics calculated at the level of the original observations. 

- Working from a call to `augment()` will return a data frame with all the original observations used in the estimation of the model, together with columns like the following:
  - `.fitted` — The fitted values of the model.
  - `.se.fit` — The standard errors of the fitted values.
  - `.resid` — The residuals.
  - `.hat` — The diagonal of the hat matrix.
  - `.sigma` — An estimate of residual standard deviation when the corresponding observation is dropped from the model.
  - `.cooksd` — Cook’s distance, a common regression diagnostic on how the observation is influential in the estimation;
  - `.std.resid` — The standardized residuals.


---
# Work with models
### &lt;p style="color:#00449E"&gt; Get observation-level statistics with `augment()` &lt;/p&gt;


```r
out_aug &lt;- augment(out)
head(out_aug) 
```

```
# # A tibble: 6 × 10
#   lifeExp gdpPercap      pop continent .fitted .resid    .hat .sigma .cooksd .std.resid
#     &lt;dbl&gt;     &lt;dbl&gt;    &lt;int&gt; &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
# 1    28.8      779.  8425333 Asia         56.4  -27.6 0.00322   8.34 0.00505      -3.31
# 2    30.3      821.  9240934 Asia         56.4  -26.1 0.00321   8.34 0.00450      -3.13
# 3    32.0      853. 10267083 Asia         56.5  -24.5 0.00320   8.35 0.00393      -2.93
# 4    34.0      836. 11537966 Asia         56.5  -22.4 0.00319   8.35 0.00330      -2.69
# 5    36.1      740. 13079460 Asia         56.4  -20.3 0.00319   8.35 0.00271      -2.44
# 6    38.4      786. 14880372 Asia         56.5  -18.0 0.00317   8.36 0.00212      -2.16
```

```r
head(out_aug) %&gt;% round_df()
```

```
# # A tibble: 6 × 10
#   lifeExp gdpPercap      pop continent .fitted .resid  .hat .sigma .cooksd .std.resid
#     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
# 1    28.8      779.  8425333 Asia         56.4  -27.6     0   8.34    0.01      -3.31
# 2    30.3      821.  9240934 Asia         56.4  -26.1     0   8.34    0         -3.13
# 3    32        853. 10267083 Asia         56.5  -24.5     0   8.35    0         -2.93
# 4    34.0      836. 11537966 Asia         56.5  -22.4     0   8.35    0         -2.69
# 5    36.1      740. 13079460 Asia         56.4  -20.3     0   8.35    0         -2.44
# 6    38.4      786. 14880372 Asia         56.5  -18.0     0   8.36    0         -2.16
```


---
# Work with models
### &lt;p style="color:#00449E"&gt; Get observation-level statistics with `augment()` &lt;/p&gt;

- The new columns created by `augment()` can be used to create some standard regression plots. 
  - We can draw the residual plot (the residuals versus the fitted values). 
  

```r
p &lt;- ggplot(data = out_aug,
            mapping = aes(x = .fitted, y = .resid))
p + geom_point()
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Get model-level statistics with `glance()` &lt;/p&gt;

- `glance()` returns the information typically presented at the bottom of a model's `summary()` output.


```r
glance(out) %&gt;% round_df()
```

```
# # A tibble: 1 × 12
#   r.squared adj.r.squ…¹ sigma stati…² p.value    df logLik    AIC    BIC devia…³ df.re…⁴  nobs
#       &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
# 1      0.58        0.58  8.37    394.       0     6 -6034. 12084. 12127. 118754.    1697  1704
# # … with abbreviated variable names ¹​adj.r.squared, ²​statistic, ³​deviance, ⁴​df.residual
```


---
# Work with models
### &lt;p style="color:#00449E"&gt; Grouped analysis and list columns &lt;/p&gt;


- Consider the linear regression model for the relationship between life expectancy and GDP by continent, for each year in the data.



```r
eu77 &lt;- gapminder %&gt;% filter(continent == "Europe", year == 1977)
fit &lt;- lm(lifeExp ~ log(gdpPercap), data = eu77)
summary(fit)
```

```
# 
# Call:
# lm(formula = lifeExp ~ log(gdpPercap), data = eu77)
# 
# Residuals:
#     Min      1Q  Median      3Q     Max 
# -7.4956 -1.0306  0.0935  1.1755  3.7125 
# 
# Coefficients:
#                Estimate Std. Error t value Pr(&gt;|t|)    
# (Intercept)      29.489      7.161   4.118 0.000306 ***
# log(gdpPercap)    4.488      0.756   5.936 2.17e-06 ***
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# 
# Residual standard error: 2.114 on 28 degrees of freedom
# Multiple R-squared:  0.5572,	Adjusted R-squared:  0.5414 
# F-statistic: 35.24 on 1 and 28 DF,  p-value: 2.173e-06
```

---
# Work with models
### &lt;p style="color:#00449E"&gt; Grouped analysis and list columns &lt;/p&gt;


- With `dplyr` and `broom` we can do the grouped analysis for every continent-year slice of the data in a compact and tidy way.


```r
out_le &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest()
out_le
```

```
# # A tibble: 60 × 3
# # Groups:   continent, year [60]
#    continent  year data             
#    &lt;fct&gt;     &lt;int&gt; &lt;list&gt;           
#  1 Asia       1952 &lt;tibble [33 × 4]&gt;
#  2 Asia       1957 &lt;tibble [33 × 4]&gt;
#  3 Asia       1962 &lt;tibble [33 × 4]&gt;
#  4 Asia       1967 &lt;tibble [33 × 4]&gt;
#  5 Asia       1972 &lt;tibble [33 × 4]&gt;
#  6 Asia       1977 &lt;tibble [33 × 4]&gt;
#  7 Asia       1982 &lt;tibble [33 × 4]&gt;
#  8 Asia       1987 &lt;tibble [33 × 4]&gt;
#  9 Asia       1992 &lt;tibble [33 × 4]&gt;
# 10 Asia       1997 &lt;tibble [33 × 4]&gt;
# # … with 50 more rows
```

- `nest()` creates a list-column of data frames.
  -  The list column, `data`, contains a small table of data corresponding to each continent-year group.



---
# Work with models
### &lt;p style="color:#00449E"&gt; Grouped analysis and list columns &lt;/p&gt;


- We can look at specific group, for example, “Europe 1977”, if we like, by filtering the data and then unnesting the list column.


```r
out_le %&gt;% filter(continent == "Europe" &amp; year == 1977) %&gt;% 
  unnest()
```

```
# # A tibble: 30 × 6
# # Groups:   continent, year [1]
#    continent  year country                lifeExp      pop gdpPercap
#    &lt;fct&gt;     &lt;int&gt; &lt;fct&gt;                    &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
#  1 Europe     1977 Albania                   68.9  2509048     3533.
#  2 Europe     1977 Austria                   72.2  7568430    19749.
#  3 Europe     1977 Belgium                   72.8  9821800    19118.
#  4 Europe     1977 Bosnia and Herzegovina    69.9  4086000     3528.
#  5 Europe     1977 Bulgaria                  70.8  8797022     7612.
#  6 Europe     1977 Croatia                   70.6  4318673    11305.
#  7 Europe     1977 Czech Republic            70.7 10161915    14800.
#  8 Europe     1977 Denmark                   74.7  5088419    20423.
#  9 Europe     1977 Finland                   72.5  4738902    15605.
# 10 Europe     1977 France                    73.8 53165019    18293.
# # … with 20 more rows
```


---
# Work with models
### &lt;p style="color:#00449E"&gt; Grouped analysis and list columns &lt;/p&gt;


- List columns are useful because we can act on them in a compact and tidy way.


```r
fit_ols &lt;- function(df) {
    lm(lifeExp ~ log(gdpPercap), data = df)
}

out_le &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest() %&gt;% 
    mutate(model = map(data, fit_ols)) 

out_le
```

```
# # A tibble: 60 × 4
# # Groups:   continent, year [60]
#    continent  year data              model 
#    &lt;fct&gt;     &lt;int&gt; &lt;list&gt;            &lt;list&gt;
#  1 Asia       1952 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  2 Asia       1957 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  3 Asia       1962 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  4 Asia       1967 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  5 Asia       1972 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  6 Asia       1977 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  7 Asia       1982 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  8 Asia       1987 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
#  9 Asia       1992 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
# 10 Asia       1997 &lt;tibble [33 × 4]&gt; &lt;lm&gt;  
# # … with 50 more rows
```

- `map()` function applies a function to each element of a vector.


---
# Work with models
### &lt;p style="color:#00449E"&gt; Grouped analysis and list columns &lt;/p&gt;

- List columns are useful because we can act on them in a compact and tidy way.


```r
fit_ols &lt;- function(df) {
    lm(lifeExp ~ log(gdpPercap), data = df)
}

out_tidy &lt;- gapminder %&gt;%
    group_by(continent, year) %&gt;%
    nest() %&gt;% 
    mutate(model = map(data, fit_ols),
           tidied = map(model, tidy)) %&gt;%
    unnest(tidied, .drop = TRUE) %&gt;%
    filter(term != "(Intercept)" &amp;
           continent != "Oceania")
```



---
# Work with models
### &lt;p style="color:#00449E"&gt; Grouped analysis and list columns &lt;/p&gt;

- We now have tidy regression output with an estimate of the association between log GDP per capita and life expectancy *for each year*, *within continents*.


```r
p &lt;- ggplot(data = out_tidy,
            mapping = aes(x = year, y = estimate,
                          ymin = estimate - 2*std.error,
                          ymax = estimate + 2*std.error,
                          group = continent, color = continent))

p + geom_pointrange(position = position_dodge(width = 1)) +
    scale_x_continuous(breaks = unique(gapminder$year)) + 
    theme(legend.position = "top") +
    labs(x = "Year", y = "Estimate", color = "Continent")
```

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"highlightLanguage": "r",
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<!--Hat-tip: https://www.garrickadenbuie.com/blog/xaringan-tip-logo-all-slides/-->
<style>
.logo {
  background-image: url(img/logo-blue.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  width: 55px;
  height: 66px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
