---
title: "The Happiness Project"
author: "Wen Jing Jiang<br><br>"
date: "May 12, 2022<br><br>"
output: 
  html_document:
    df_print: paged
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
    highlight: espresso
---
- Motivations for this project

What is happiness? How do we achieve happiness? We go through life asking questions 
like that. The concept of happiness is so ambiguous our group, Andy Lee, Dan Bosio, and I decided to study factors that contribute to happiness positively and negatively.

<br>

- Load necessary packages for the project.
```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
library(socviz)
library(lubridate)
library(geofacet)
library(ggthemes)
library(ggrepel)
library(ggridges)
library(plyr)
library(skimr)
library(tidyverse)
library(tidyr)
library(gganimate)
library(plotly)
library(stargazer)  # regression tables
library(ggstatsplot)
library(corrr)
library(kableExtra)
theme_set(theme_classic())
```

# Happiness Data

The data was collected from Gallup World Poll. Their survey consisted of questions that asked participants to rank their own life on a Cantril ladder with a scale from 1 to 10, 10 being the best ideal way of living and 0 being the worst. This data set focuses on the happiness score of each country, which ranges from 0 to 10. Each country is ranked based on that averaged happiness score for participants. The team recorded scores for these factors: economy or GDP per Capita, family or social support, health or life expectancy, and freedom to help explain the happiness score of each country and these factors are scaled from 0 to 1.85 instead of 0 to 10. 

The link to our data: <a href="https://www.kaggle.com/unsdsn/world-happiness">World Happiness Project</a>

- Load happiness data.
```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
h15 <- read.csv("2015.csv")
h15 <- h15 %>%
  dplyr::mutate(Year = 2015) %>%
  dplyr::rename(H_rank=`Happiness.Rank`, # Modify variable names
                H_score = `Happiness.Score`,
                GDP=`Economy..GDP.per.Capita.`,
                Health=`Health..Life.Expectancy.`,
                Trust=`Trust..Government.Corruption.`,
                SE=`Standard.Error`,
                dystopia_res = `Dystopia.Residual`) 

h16 <- read.csv("2016.csv")
h16 <- h16 %>%
  dplyr::mutate(Year = 2016,
      `Standard Error` = (`Upper.Confidence.Interval`-`Lower.Confidence.Interval`)/3.92) %>%
              # SE = (upper limit â€“ lower limit) / 3.92. 
              # This is for 95% CI
  dplyr::select(-c(`Upper.Confidence.Interval`,`Lower.Confidence.Interval`)) %>%
  dplyr::rename(H_rank=`Happiness.Rank`, # Modify variable names
                H_score = `Happiness.Score`,
                GDP=`Economy..GDP.per.Capita.`,
                Health=`Health..Life.Expectancy.`,
                Trust=`Trust..Government.Corruption.`,
                SE=`Standard Error`,
                dystopia_res = `Dystopia.Residual`)



# Since we don't have a variable 'Region' starting from 2017, we will create it for 
# each year
h_regions <- dplyr::select(h16, Country, Region)



# Read 2017 Data
h17 <- read_csv("2017.csv")  
h17 <- h17 %>%
  dplyr::mutate(Year = 2017,
                `Standard Error` = (`Whisker.high`-`Whisker.low`)/3.92,) %>%
  merge(h_regions,by="Country", all.x=T) %>%
  dplyr::select(-c(`Whisker.high`,`Whisker.low`)) %>%
    dplyr::rename(H_rank=`Happiness.Rank`, # Modify variable names
                H_score = Happiness.Score,
                GDP=Economy..GDP.per.Capita.,
                Health=Health..Life.Expectancy.,
                Trust=Trust..Government.Corruption.,
                SE=`Standard Error`,
                dystopia_res = Dystopia.Residual)


# Read 2018 Data
h18 <- read_csv("2018.csv")  
h18 <- h18 %>%
  dplyr::mutate(Year = 2018) %>%
  dplyr::rename(H_rank=`Overall rank`, # Modify variable names
                H_score = `Score`,
                GDP=`GDP per capita`,
                Country = `Country or region`,
                Health=`Healthy life expectancy`,
                Trust=`Perceptions of corruption`,
                Freedom = `Freedom to make life choices`,
                Family = `Social support`) %>%
  merge(h_regions,by="Country", all.x=T) %>%
  dplyr::mutate(dystopia_res = H_score - (GDP + Family + Health + Freedom + Generosity + as.numeric(Trust)))



# Read 2019 Data
h19 <- read_csv("2019.csv")  
h19 <- h19 %>%
  dplyr::mutate(Year = 2019) %>%
  dplyr::rename(H_rank=`Overall rank`, # Modify variable names
                H_score = `Score`,
                GDP=`GDP per capita`,
                Country = `Country or region`,
                Health=`Healthy life expectancy`,
                Trust=`Perceptions of corruption`,
                Freedom = `Freedom to make life choices`,
                Family = `Social support`) %>%
  merge(h_regions,by="Country", all.x=T) %>%
  dplyr::mutate(dystopia_res = H_score - 
                  (GDP + Family + Health + Freedom + Generosity + as.numeric(Trust)))

# Combine all data into all_dat
h_alldat <- tibble(rbind.fill(h15,h16,h17,h18,h19))

# Create Continent Variable
h_alldat <- h_alldat %>%
  dplyr::mutate(Country = as.factor(tolower(Country)),
                Continent = case_when(
    grepl('Europe', as.character(Region)) ~ "Europe",
    grepl('Latin', as.character(Region)) ~ "South America",
    grepl('Australia', as.character(Region)) ~ "Oceania",
    grepl('Middle East', as.character(Region)) ~ "Asia",
    grepl('Africa', as.character(Region)) ~ "Africa",
    grepl('Asia', as.character(Region)) ~ "Asia",
    grepl('North America', as.character(Region)) ~ "North America"),
    Region = as.factor(Region))

rmarkdown::paged_table(h_alldat)

```

# Summary Statistics

```{r}
h_alldat %>%
  kbl() %>%
  kable_styling()
```

# Boxplot of Happiness Scores in Different Regions

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
ggplot(data = h_alldat) + 
  geom_boxplot( aes( x = H_score, color = Region)) +
  theme(axis.text.x = element_blank(), axis.ticks = element_blank())
```

# Linear Regression Models of each Factor

## Happiness Scores and GDP

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
ggplot(dplyr::filter(h_alldat, Region != "NA"), aes(x = GDP, y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs GDP by Region\n") 
```

##Happiness Scores and Family/Social Support

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
ggplot(dplyr::filter(h_alldat, Region != "NA"), aes(x = Family, y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Family by Region\n")
```

## Happiness Scores and Health/Life Expectancy

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
ggplot(dplyr::filter(h_alldat, Region != "NA"), aes(x = Health, y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Health by Region\n")
```

## Happiness Scores and Trust in Government

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
h_alldat$Trust <- as.numeric(h_alldat$Trust)

ggplot(dplyr::filter(h_alldat, Region != "NA"), aes(x = Trust, y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Trust by Region\n")
```

## Happiness Scores and Generosity

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
ggplot(dplyr::filter(h_alldat, Region != "NA"), aes(x = Generosity, y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Generosity by Region\n")
```

## Happiness Scores and Freedom

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
ggplot(dplyr::filter(h_alldat, Region != "NA"), aes(x = Freedom, y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Freedom by Region\n")
```

# Deaths by Cause Data

This is the annual number of deaths by 33 different causes. We focused on 2015 to 
2019 data to match with the Happiness Data. We wanted to find the correlation 
between these factors and the happiness scores. As certain ways of death are more
feared and different causes of death can cause different levels of grief, there 
certainly would be causes of deaths that are most detrimental to feeling happy.

The link to our data: <a href="https://www.kaggle.com/datasets/ivanchvez/causes-of-death-our-world-in-data">Causes of Deaths</a>

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
death_dat <- read_csv('20220327 annual-number-of-deaths-by-cause.csv')

death_dat <- death_dat %>%
  filter(Year >= 2015) %>%
  rename(Country = Entity) %>%
  mutate(Country = tolower(Country)) %>%
  arrange(Year) %>%
  rename(execution = `Number of executions (Amnesty International)`,
         protein_malnutrition = `Deaths - Protein-energy malnutrition - Sex: Both - Age: All Ages (Number)`,
         meningitis = `Deaths - Meningitis - Sex: Both - Age: All Ages (Number)`,
         neoplasms = `Deaths - Neoplasms - Sex: Both - Age: All Ages (Number)`,
         fire_heat = `Deaths - Fire, heat, and hot substances - Sex: Both - Age: All Ages (Number)`,
         malaria = `Deaths - Malaria - Sex: Both - Age: All Ages (Number)`,
         drowning = `Deaths - Drowning - Sex: Both - Age: All Ages (Number)`,
         inter_violence = `Deaths - Interpersonal violence - Sex: Both - Age: All Ages (Number)`,
         hiv_aids = `Deaths - HIV/AIDS - Sex: Both - Age: All Ages (Number)`,
         drug_use = `Deaths - Drug use disorders - Sex: Both - Age: All Ages (Number)`,
         tuberculosis = `Deaths - Tuberculosis - Sex: Both - Age: All Ages (Number)`,
         road_injuries = `Deaths - Road injuries - Sex: Both - Age: All Ages (Number)`,
         maternal_disorders = `Deaths - Maternal disorders - Sex: Both - Age: All Ages (Number)`,
         lower_respiratory_infect = `Deaths - Lower respiratory infections - Sex: Both - Age: All Ages (Number)`,
         neonatal = `Deaths - Neonatal disorders - Sex: Both - Age: All Ages (Number)`,
         alcohol_use = `Deaths - Alcohol use disorders - Sex: Both - Age: All Ages (Number)`,
         nature_forces = `Deaths - Exposure to forces of nature - Sex: Both - Age: All Ages (Number)`,
         diarrhea = `Deaths - Diarrheal diseases - Sex: Both - Age: All Ages (Number)`,
         environment = `Deaths - Environmental heat and cold exposure - Sex: Both - Age: All Ages (Number)`,
         nutrient_deficient = `Deaths - Nutritional deficiencies - Sex: Both - Age: All Ages (Number)`,
         self_harm = `Deaths - Self-harm - Sex: Both - Age: All Ages (Number)`,
         conflict_terrorism = `Deaths - Conflict and terrorism - Sex: Both - Age: All Ages (Number)`,
         diabetes = `Deaths - Diabetes mellitus - Sex: Both - Age: All Ages (Number)`,
         poisioning = `Deaths - Poisonings - Sex: Both - Age: All Ages (Number)`,
         terrorism = `Terrorism (deaths)`,
         cardiovascular = `Deaths - Cardiovascular diseases - Sex: Both - Age: All Ages (Number)`,
         chronic_kidney = `Deaths - Chronic kidney disease - Sex: Both - Age: All Ages (Number)`,
         chronic_respiratory = `Deaths - Chronic respiratory diseases - Sex: Both - Age: All Ages (Number)`,
         cirrhosis = `Deaths - Cirrhosis and other chronic liver diseases - Sex: Both - Age: All Ages (Number)`,
         digestive = `Deaths - Digestive diseases - Sex: Both - Age: All Ages (Number)`,
         acute_hepatitis = `Deaths - Acute hepatitis - Sex: Both - Age: All Ages (Number)`,
         dementia = `Deaths - Alzheimer's disease and other dementias - Sex: Both - Age: All Ages (Number)`,
         parkingson = `Deaths - Parkinson's disease - Sex: Both - Age: All Ages (Number)`)

rmarkdown::paged_table(data.frame(colnames(death_dat)))
```

## Merge all data into one data frame.
# Top 10 Negative Correlation Coefficients

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
# Merge: Happiness & Death Data
h_p_dat <- merge(h_alldat, death_dat, by = c("Country","Year"))

h_p_corr <- data.matrix(h_p_dat, rownames.force = NA) %>%
    correlate() %>% 
    stretch() %>% 
    filter(x != y & x == "H_score" & 
             y != "H_rank" &
             y != "Region" &
             y != "SE") %>%
    arrange(desc(r))


# Top 10 Negative Correlation Coefficients
h_p_corr_negative10 <- h_p_corr %>%
  arrange(r) %>%
  head(10)

rmarkdown::paged_table(h_p_corr_negative10)
```

# Linear Regression Models for Top 4 Negatively Correlated Coefficients

## Happiness and Deaths by Conflict & Terrorism
```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}

ggplot(dplyr::filter(h_p_dat, Region != "NA"), aes(x = conflict_terrorism
                                                    , y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Deaths by Conflict and Terrorism by Region\n")
```

# Happiness and Deaths by Terrorism

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}

ggplot(dplyr::filter(h_p_dat, Region != "NA"), aes(x = terrorism
                                                    , y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Deaths by Terrorism by Region\n")
```

## Happiness and Deaths by Maternal Disorders

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}

ggplot(dplyr::filter(h_p_dat, Region != "NA"), aes(x = maternal_disorders
                                                    , y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Deaths by Maternal Disorders by Region\n")
```

## Happiness and Deaths by HIV/AIDS

```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}

ggplot(dplyr::filter(h_p_dat, Region != "NA"), aes(x = hiv_aids
                                                    , y=H_score, color = Region)) +
  geom_point(group=1) +
  geom_smooth(method=lm, na.rm = TRUE, fullrange= TRUE,
               aes(group=1),colour="black")+
  theme_classic()+
  labs(title = "Happiness Scores vs Deaths by HIV and AIDS by Region\n")
```



```{r, echo = TRUE, eval = TRUE, fig.height = 4, fig.align='center'}
Formula1 = H_score ~ conflict_terrorism +	terrorism	+ maternal_disorders +	hiv_aids + protein_malnutrition +	nutrient_deficient	 + meningitis	+malaria	+ neonatal + meningitis

model <- lm(Formula1, data = h_p_dat)
stargazer(model, omit = c("Constant"), type = "html")
```

#Conclusions

From the regression models, we can conclude that there are positive linear 
relationships between happiness score and these factors: GDP, Health, Family,
and Freedom. There is no evidence for strong correlation between happiness 
score and the factors trust and generosity. Having higher GDP, life expectancy, 
family and social support, and greater perception of freedom will generally 
result in higher happiness scores in each country.

From the causes of death data, we can conclude that conflict and terrorism,
terrorism, maternal disorders, and HIV/AIDS have negative linear relationships 
with happiness. 
